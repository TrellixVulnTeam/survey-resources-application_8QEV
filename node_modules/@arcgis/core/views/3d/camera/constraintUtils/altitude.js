/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{clamp as t,sign as e}from"../../../../core/mathUtils.js";import{c as r}from"../../../../chunks/vec3f64.js";import{g as n,a as o}from"../../../../chunks/vec3.js";import{ray as i}from"../../support/geometryUtils.js";import{defaultApplyOptions as s,interactionDirectionTowardsConstraintMinimization as c,hasConstraintType as a,adjustRangeForInteraction as m}from"./common.js";import{closestPointOnRay as u}from"../../support/intersectionUtils.js";function p(t,r,o=s){const a=f(t,r,o);if(0===a)return!1;const m=t.renderCoordsHelper,p=m.getAltitude(r.eye)+a,l=c(r,o.interactionDirection,y(t,r,e(a),w),g),d=n(A,r.viewForward);return m.intersectInfiniteManifold(i.wrap(r.eye,l),p,r.eye)||m.setAltitude(p,r.eye),u(r.eye,d,r.center,r.center),r.markViewDirty(),!0}function f(e,r,n=s){if(!l(e,n))return 0;const o=x(e.state.constraints.altitude,j);d(e,n,o);const i=e.renderCoordsHelper.getAltitude(r.eye),c=t(i,o.min,o.max)-i;return Math.abs(c)<=1e-6?0:c}function l(t,e){const r=t.state.constraints.altitude;return!(!t.state.isGlobal||!r)&&(2!==e.interactionType||!a(e.selection,1))}function d(t,e,r){const n=e.interactionType;if(0===n)return;const{min:o,max:i}=r,{interactionStartCamera:s,interactionFactor:c}=e,a=2===n||1===n,u=f(t,s),p=0===u?0:t.renderCoordsHelper.getAltitude(s.eye);r.min=o,r.max=i;m(u,p,a,c,.05*p,r)}function y(t,e,r,n){return t.renderCoordsHelper.worldUpAtPosition(e.eye,n),o(n,n,r),n}function x(t,e){return e.min=t.min,e.max=t.max,e}const j={min:0,max:0},g=r(),w=r(),A=r();export{p as applyAltitudeConstraint,f as getAltitudeConstraintError};
