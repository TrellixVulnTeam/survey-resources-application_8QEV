/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{isSome as e,unwrapOr as r}from"../../../core/maybe.js";import{c as t}from"../../../chunks/vec3f64.js";import{g as n,h as o,a as i,f as s,b as a,d as c,l}from"../../../chunks/vec3.js";import{getReferenceEllipsoid as d}from"../../../geometry/projectionEllipsoid.js";import{containsPoint as u}from"../../../geometry/support/aaBoundingRect.js";import{Intersector as f}from"../webgl-engine/lib/Intersector.js";function m(r,t,n,o){return e(r.renderCoordsHelper.fromRenderCoords(t.eye,M,o))&&u(n,M)}function p(e,t){return e.elevationProvider?r(e.elevationProvider.getElevation(t[0],t[1],t[2],e.renderCoordsHelper.spatialReference,"ground"),0):0}function g(e,r,t,c){const l=e.state.camera.clone();r&&(l.eye=r),t&&(l.center=t),c&&(l.up=c),v(e,l.ray,w)||n(w,l.center);const d=e.state.constraints,u=d.minimumPoiDistance;if(o(l.eye,w)<u){const r=d.collision.enabled;n(H,l.viewForward),i(H,H,u),r?s(l.eye,w,H):a(w,l.eye,H);const t=e.renderCoordsHelper,o=t.getAltitude(l.eye),c=d.collision.elevationMargin;r&&o<c&&(s(H,w,l.eye),t.setAltitude(c,l.eye),a(w,l.eye,H))}return l.center=w,l}function y(e,r,t){if(!e.state.isGlobal)return!1;const n=p(e,r),i=e.stateManager.constraintsManager.nearFarHeuristic,{far:s}=i.compute(r,t,e.dataExtent,n,C),a=s*s;return o(r,t)>a}function v(e,r,n=t()){let o=j[e.viewingMode];o||(o=new f(e.state.mode),o.options.backfacesTerrain=!e.state.isGlobal,o.options.invisibleTerrain=!0,j[e.viewingMode]=o);const{isGlobal:i}=e.state;return!(!e.sceneIntersectionHelper.intersectRay(r,o,n)||y(e,r.origin,n))||(!(!e.renderCoordsHelper.intersectManifold(r,0,n)||y(e,r.origin,n))||!!i&&b(r,n,d(e.spatialReference).radius))}function b(e,r,t){const n=c(e.origin,e.origin)-t*t,o=n>0?Math.sqrt(n)/3:1;return i(r,e.direction,o/l(e.direction)),a(r,r,e.origin),!0}const j={},M=t(),w=t(),H=t(),C={near:0,far:0};export{g as cameraOnContentAlongViewDirection,m as eyeWithinExtent,p as surfaceElevationBelowRenderLocation};
