/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{width as t,height as e,intersects as n}from"../../../../geometry/support/aaBoundingRect.js";import{Geometry as i}from"../../webgl-engine/lib/Geometry.js";import o from"../../webgl-engine/lib/GeometryUtil.js";function r(n,i,o){const r=t(n)/e(n),a={width:o,height:o};return r>1.0001?a.height=o/r:r<.9999&&(a.width=o*r),a.width=Math.round(a.width/(t(n)/t(i))),a.height=Math.round(a.height/(e(n)/e(i))),a}function a(t,e){const n=[[t[0],t[1],e],[t[2],t[1],e],[t[2],t[3],e],[t[0],t[3],e]];return o.createSquareGeometry(n)}function h(t,e,o){if(!n(t,e))return a(e,o);const r=[t[1]-e[1],Math.min(t[3],e[3])-Math.max(t[1],e[1]),e[3]-t[3],123456],h=[t[0]-e[0],Math.min(t[2],e[2])-Math.max(t[0],e[0]),e[2]-t[2],123456],u=e[2]-e[0],l=e[3]-e[1],c=h[0]>0&&h[2]>0?3:2,m=r[0]>0&&r[2]>0?3:2,g=(m+1)*(c+1),w=new Float64Array(3*g),d=new Float32Array(2*g),f=new Uint32Array(6*(m*c-1));let p=0,y=0,x=0,M=0,v=0;for(let n=0;n<4;n++){const t=r[n];if(t<=0)continue;let i=0;for(let r=0;r<4;r++){const t=h[r];t<=0||(w[y++]=e[0]+i,w[y++]=e[1]+p,w[y++]=o,d[x++]=i/u,d[x++]=p/l,r<3&&n<3&&(1!==r||1!==n)&&(f[v++]=M,f[v++]=M+1,f[v++]=M+c+1,f[v++]=M+1,f[v++]=M+c+2,f[v++]=M+c+1),M++,i+=t)}p+=t}const b=new Uint32Array(f.length);return new i([["position",{size:3,data:w,exclusive:!0}],["normal",{size:3,data:s,exclusive:!0}],["uv0",{size:2,data:d,exclusive:!0}]],[["position",f],["normal",b],["uv0",f]])}const s=[0,0,1];export{r as computeImageExportSize,a as createGeometryForExtent,h as createOuterImageGeometry};
