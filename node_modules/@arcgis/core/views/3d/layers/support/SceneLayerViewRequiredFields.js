/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../chunks/tslib.es6.js";import"../../../../core/has.js";import{unwrapOr as r}from"../../../../core/maybe.js";import s from"../../../../core/Logger.js";import"../../../../core/accessorSupport/ensureType.js";import{property as t}from"../../../../core/accessorSupport/decorators/property.js";import{subclass as i}from"../../../../core/accessorSupport/decorators/subclass.js";import"../../../../core/urlUtils.js";import"../../../../core/uuid.js";import"../../../../portal/support/resourceExtension.js";import{fixFields as o,collectLabelingFields as l,collectFilterFields as p}from"../../../../layers/support/fieldUtils.js";import{AsyncUpdateMixin as a}from"../../../../core/AsyncUpdate.js";import{HandleOwner as d}from"../../../../core/HandleOwner.js";const n=s.getLogger("esri.views.3d.layers.support.SceneLayerViewRequiredFields");let c=class extends(a(d)){constructor(e){super(e)}get requiredFields(){const{layerView:{layer:{fields:e},definitionExpressionFields:s},rendererFields:t,labelingFields:i,viewFilterFields:l}=this;return o(e,[...r(s,[]),...r(t,[]),...r(i,[]),...r(l,[])])}initialize(){const e=this.layerView.layer;this.layer=e,this.handles.add([this.autoUpdateAsync("rendererFields",(()=>{const{fields:e,renderer:r}=this.layer;return r?u((s=>r.collectRequiredFields(s,e))):null})),this.autoUpdateAsync("labelingFields",(()=>{const{layer:e}=this;return e.labelsVisible?u((r=>l(r,e))):null})),this.autoUpdateAsync("viewFilterFields",(()=>{const{layer:e,filter:r}=this.layerView;return u((s=>p(s,e,r)))}))])}};async function u(e){const r=new Set;try{return await e(r),Array.from(r).sort()}catch(s){return n.error(s),null}}e([t()],c.prototype,"layerView",void 0),e([t()],c.prototype,"layer",void 0),e([t()],c.prototype,"requiredFields",null),e([t()],c.prototype,"rendererFields",void 0),e([t()],c.prototype,"labelingFields",void 0),e([t()],c.prototype,"viewFilterFields",void 0),c=e([i("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],c);export{c as SceneLayerViewRequiredFields};
