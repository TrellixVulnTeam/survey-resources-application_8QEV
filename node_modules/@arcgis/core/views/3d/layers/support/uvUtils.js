/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{isSome as t}from"../../../../core/maybe.js";import{c as o}from"../../../../chunks/vec3f64.js";import{s,d as e,f as r,a as n,b as c,g as a,D as f,n as m,c as u}from"../../../../chunks/vec3.js";import{getReferenceEllipsoid as i}from"../../../../geometry/projectionEllipsoid.js";import{lonLatToWebMercatorComparable as I}from"../../../../geometry/projection.js";import{a as p}from"../../../../chunks/mat4f64.js";import{a as N}from"../../../../chunks/vec2f64.js";import{s as h}from"../../../../chunks/vec2.js";import{BufferViewVec3f64 as l}from"../../support/buffer/BufferView.js";import{t as V,c as T,n as b}from"../../../../chunks/plane.js";function j(t,o,s,e=1){if(s.isGeographic){const t=new Float64Array(o.typedBuffer.length),e=3*o.count;for(let r=0;r<e;r+=3)I(o.typedBuffer,r,t,r,i(s));o=l.fromTypedArray(t)}h(_,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(let c=0;c<o.count;c++)o.getVec(c,E),_[0]=Math.min(_[0],E[0]),_[1]=Math.min(_[1],E[1]);const r=_[0]%e,n=_[1]%e;A[0]=_[0]-r,A[1]=_[1]-n;for(let c=0;c<o.count;c++)o.getVec(c,E),t.setValues(c,(E[0]-A[0])/e,(E[1]-A[1])/e,A[0]/e,A[1]/e)}function M(t,o,a,f,m=1){s(F,1,0,0),s(k,0,1,0),s(Y,0,0,1),q(g,o),O(o,y)&&S(y,F,k,Y,a,g),h(_,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),h(d,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let s=0;s<o.count;s++){o.getVec(s,E);const t=e(F,E),r=e(k,E);_[0]=Math.min(_[0],t),_[1]=Math.min(_[1],r),d[0]=Math.max(d[0],t),d[1]=Math.max(d[1],r)}const u=e(Y,g);C(P,_[0],_[1],u,F,k,Y),C(v,d[0],_[1],u,F,k,Y),C(x,_[0],d[1],u,F,k,Y),r(v,v,P),n(v,v,.5),r(x,x,P),n(x,x,.5),c(P,P,v),c(P,P,x);const i=_[0]%m,I=_[1]%m;A[0]=_[0]-i,A[1]=_[1]-I;for(let s=0;s<o.count;s++){o.getVec(s,E),t.setValues(s,(e(F,E)-A[0])/m,(e(k,E)-A[1])/m,A[0]/m,A[1]/m);for(let t=0;t<3;t++)f.set(s,t,P[t]),f.set(s,t+3,v[t]),f.set(s,t+6,x[t])}}const g=o(),E=o(),y=T(),F=o(),k=o(),Y=o(),_=N(),d=N(),A=N(),P=o(),v=o(),x=o();function O(t,o){const s=t.count-1;return V(t,o,0,Math.floor(s/3),Math.floor(s*(2/3)))}function S(o,r,c,i,I,p){t(I)?(I.basisMatrixAtPosition(p,B),s(G,B[0],B[1],B[2]),s(w,B[4],B[5],B[6]),s(D,B[8],B[9],B[10])):(s(G,1,0,0),s(w,0,1,0),s(D,0,0,1));const N=b(o);e(N,D)<0&&n(N,N,-1),a(i,N);const h=e(N,w),l=e(N,G);Math.abs(h)<Math.abs(l)?(f(r,G,N,-l),m(r,r),u(c,r,N),m(c,c),n(c,c,-1)):(f(c,w,N,-h),m(c,c),u(r,c,N),m(r,r))}const B=p(),G=o(),w=o(),D=o();function q(t,o){s(z,0,0,0);for(let s=0;s<o.count-1;s++)o.getVec(s,E),c(z,z,E);n(t,z,1/(o.count-1))}const z=o();function C(t,o,e,r,n,c,a){s(t,o*n[0]+e*c[0]+r*a[0],o*n[1]+e*c[1]+r*a[1],o*n[2]+e*c[2]+r*a[2])}export{M as createMapSpaceUVCoords,j as createMapSpaceUVCoordsDraped};
