/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../../chunks/tslib.es6.js";import"../../../../../core/has.js";import{destroyMaybe as t,isSome as r,isNone as o}from"../../../../../core/maybe.js";import"../../../../../core/Logger.js";import"../../../../../core/accessorSupport/ensureType.js";import{property as i}from"../../../../../core/accessorSupport/decorators/property.js";import{subclass as s}from"../../../../../core/accessorSupport/decorators/subclass.js";import"../../../../../core/urlUtils.js";import"../../../../../core/uuid.js";import"../../../../../portal/support/resourceExtension.js";import a from"../../../../../core/Evented.js";import p from"../../../../../core/Handles.js";import{init as n}from"../../../../../core/watchUtils.js";import{InteractiveToolBase as h}from"../../../../interactive/InteractiveToolBase.js";import{isSupportedGraphic as c}from"./isSupportedGraphic.js";import{ReshapeOperation as l}from"./ReshapeOperation.js";let m=class extends(a.EventedMixin(h)){constructor(e){super(e),this._handles=new p,this._reshapeOperation=null,this._internalGeometryUpdate=!1,this.enableZ=!0,this.enableMoveGraphic=!0,this.type="reshape-3d",this.snappingManager=null}destroy(){this._handles.removeAll(),this._reshapeOperation=t(this._reshapeOperation),this._set("view",null),this._set("graphic",null)}get selectionManagementDisabled(){return!0}_updateGeometry(){const e=this.graphic.geometry;0!==c(this.graphic)||!r(e)||"polygon"!==e.type&&"polyline"!==e.type?this._reshapeOperation.inputGeometry=null:this._reshapeOperation.inputGeometry=e.clone()}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),0!==c(this.graphic))return;const e=this.watch("graphic.geometry",(()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()}),!0);this._handles.add(e,"onGraphicGeometryChange")}manipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.manipulatorSelectionChanged()}_onReshapeGeometryChanged(){o(this.graphic)||(this._internalGeometryUpdate=!0,this.graphic.geometry=this._reshapeOperation.outputGeometry.clone(),this._internalGeometryUpdate=!1)}initialize(){this._reshapeOperation=new l({tool:this}),this._handles.add([this._reshapeOperation.on("reshape",(e=>{"reshape"===e.type&&this._onReshapeGeometryChanged(),this.emit("reshape",e)})),this._reshapeOperation.on("move",(e=>{"move"===e.type&&this._onReshapeGeometryChanged(),this.emit("move",e)})),this._reshapeOperation.on("vertex-add",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",e)})),this._reshapeOperation.on("vertex-remove",(e=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",e)})),this._reshapeOperation.on("immediate-click",(e=>this.emit("immediate-click",e))),n(this,"graphic",(()=>{this._updateGraphic()}),!0)])}beforeUndo(){r(this.snappingManager)&&this.snappingManager.doneSnapping()}onInputEvent(e){"key-down"!==e.type||"Delete"!==e.key&&"Backspace"!==e.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager}}};e([i({constructOnly:!0,nonNullable:!0})],m.prototype,"view",void 0),e([i({constructOnly:!0})],m.prototype,"graphic",void 0),e([i({constructOnly:!0,nonNullable:!0})],m.prototype,"enableZ",void 0),e([i({constructOnly:!0,nonNullable:!0})],m.prototype,"enableMoveGraphic",void 0),e([i({readOnly:!0})],m.prototype,"type",void 0),e([i({constructOnly:!0})],m.prototype,"snappingManager",void 0),m=e([s("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],m);export{m as GraphicReshapeTool};
