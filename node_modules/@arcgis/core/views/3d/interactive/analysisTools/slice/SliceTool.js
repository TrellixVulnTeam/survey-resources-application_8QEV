/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../../chunks/tslib.es6.js";import"../../../../../core/has.js";import{isSome as t,isNone as i}from"../../../../../core/maybe.js";import a from"../../../../../core/Logger.js";import"../../../../../core/accessorSupport/ensureType.js";import{property as s}from"../../../../../core/accessorSupport/decorators/property.js";import{subclass as n}from"../../../../../core/accessorSupport/decorators/subclass.js";import"../../../../../core/urlUtils.js";import"../../../../../core/uuid.js";import"../../../../../portal/support/resourceExtension.js";import r from"../../../../../core/clock.js";import{addFrameTask as o}from"../../../../../core/scheduling.js";import l from"../../../../../core/Collection.js";import{createScreenPoint as h,screenPointObjectToArray as p,createScreenPointArray as u}from"../../../../../core/screenUtils.js";import{referenceSetter as d,castForReferenceSetter as c}from"../../../../../core/collectionUtils.js";import{b as _,c as f}from"../../../../../chunks/vec3f64.js";import{d as m,l as g,g as y,a as v,b as P,i as w,n as M,s as I}from"../../../../../chunks/vec3.js";import b from"../../../../../core/Handles.js";import T from"../../../../../layers/Layer.js";import{init as S}from"../../../../../core/watchUtils.js";import{i as x,r as E,p as k,m as H}from"../../../../../chunks/mat4.js";import C from"../../../../../layers/buildingSublayers/BuildingComponentSublayer.js";import{setActive as V}from"../../../../interactive/interactiveToolUtils.js";import{createScreenPointFromEvent as j}from"../../../../support/screenUtils.js";import{sv3d as L,sm4d as R,sv2d as D}from"../../../support/stack.js";import{boundedPlane as z,plane as U,ray as O}from"../../../support/geometryUtils.js";import{Intersector as G}from"../../../webgl-engine/lib/Intersector.js";import{Texture as K}from"../../../webgl-engine/lib/Texture.js";import{createManipulatorDragEventPipeline as A}from"../../../../interactive/dragEventPipeline.js";import{InteractiveToolBase as F}from"../../../../interactive/InteractiveToolBase.js";import{screenToRenderPlane as B}from"../../editingTools/dragEventPipeline3D.js";import{calculateInputRotationTransform as q}from"../../manipulatorUtils.js";import{PLANE_OUTLINE_WIDTH as $,PLANE_PREVIEW_OUTLINE_WIDTH as N,forceVerticalModifier as J,forceHorizontalModifier as Q,PREVIEW_FADE_DURATION_SECONDS as W,POINTER_MOVE_TIMER_MS as X,PLANE_OUTLINE_COLOR as Y,PLANE_BACKGROUND_COLOR as Z,PREVIEW_FADE_DOT_THRESHOLD as ee,INITIAL_DEPTH_OFFSET_FRAC as te,GRID_COLOR as ie}from"./sliceToolConfig.js";import ae from"../../../../../widgets/Slice/SlicePlane.js";import{forceHorizontalOrVertical as se,isAlwaysDrapedLayer as ne,createShiftManipulator as re,createRotateManipulator as oe,createResizeManipulator as le,createOutlineVisualElement as he,createGridVisualElement as pe,shapeToPlane as ue,planeToShape as de,createRotatePlane as ce,resizePlane as _e,calculatePlaneHalfSize as fe,createPlane as me,DidPointerMoveRecentlyFlag as ge,calculateBoundedPlaneTranslateRotate as ye,updateShiftRestartHandle as ve,updateRotateHeadingHandle as Pe,updateRotateTiltHandle as we,updateResizeHandle as Me,createShiftPlane as Ie}from"./sliceToolUtils.js";import be from"./images/heading-rotate-png.js";import Te from"./images/tilt-rotate-png.js";const Se=a.getLogger("esri.views.3d.interactive.analysisTools.slice.SliceTool");let xe=class extends F{constructor(e){super(e),this.clock=r,this.deferCreation=!0,this.cursor=null,this._planeInfo=null,this.layersMode="none",this.shiftManipulator=null,this.rotateHeadingManipulator=null,this.rotateTiltManipulator=null,this.resizeManipulators=null,this.disableEngineLayers=!1,this._handles=new b,this._viewHandles=new b,this._frameTask=null,this._prevPointerMoveTimeout=null,this._outlineVisualElement=null,this._gridVisualElement=null,this._startPlane=z.create(),this._previewPlane=null,this._activeKeyModifiers={},this._lastCursorPosition=h(),this._baseOpacity=1,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._intersector=new G(e.view.state.mode),this._intersector.options.store=0}onAttach(){this._updateLayerViews(),this.visible&&(!this.tiltEnabled&&t(this._planeInfo)&&se(this._planeInfo.plane,this.view.renderCoordsHelper,this._planeInfo.plane),this.view.slicePlane=t(this._planeInfo)?this._planeInfo.plane:null,this._updateManipulators())}initialize(){if(null==this.model)throw new Error("SliceTool requires valid model, but null was provided.");this.rotateHeadingTexture=new K(be,{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0}),this.rotateTiltTexture=new K(Te,{width:64,height:64,mipmap:!0,preMultiplyAlpha:!0}),this.view._stage&&(this.view._stage.add(this.rotateHeadingTexture),this.view._stage.add(this.rotateTiltTexture)),this.planeChanged();const e=S(this,"state",(e=>{"ready"!==e&&this.create(),"sliced"===e&&this.complete()}),!0);this._handles.add([e,this.view.state.watch("camera",(()=>this._onCameraChange())),this.excludedLayers.on("before-add",(e=>{const t=e.item;null!=t&&(t instanceof T||t instanceof C)?t instanceof T&&ne(t)?(Se.error("excludedLayers",`Layer '${t.title}, id:${t.id}' of type '${t.type}' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.`),e.preventDefault()):this.excludedLayers.includes(t)&&e.preventDefault():(Se.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),e.preventDefault())}))]);const i=e=>{this.updateManipulatorsInteractive(e),e.grabbing||(t(this._planeInfo)&&z.copy(this._planeInfo.plane,this._startPlane),this.inputState=null)};this.shiftManipulator=re(this.view),this.manipulators.add(this.shiftManipulator),this.shiftManipulator.events.on("grab-changed",(e=>{this._onShiftGrab(e),i(this.shiftManipulator)})),this._handles.add(this._createShiftDragPipeline(this.shiftManipulator)),this.rotateHeadingManipulator=oe(this.view,this.rotateHeadingTexture),this.manipulators.add(this.rotateHeadingManipulator),this.rotateHeadingManipulator.events.on("grab-changed",(e=>{this._onRotateHeadingGrab(e),i(this.rotateHeadingManipulator)})),this._handles.add(this._createRotateHeadingDragPipeline(this.rotateHeadingManipulator)),this.rotateTiltManipulator=oe(this.view,this.rotateTiltTexture),this.manipulators.add(this.rotateTiltManipulator),this.rotateTiltManipulator.events.on("grab-changed",(e=>{this._onRotateTiltGrab(e),i(this.rotateTiltManipulator)})),this._handles.add(this._createRotateTiltDragPipeline(this.rotateTiltManipulator)),this.resizeManipulators=this._resizeHandles.map(((e,t)=>{const a=le(this.view,e);return a.events.on("grab-changed",(e=>{this._onResizeGrab(e,t),i(a)})),this._handles.add(this._createResizeDragPipeline(a)),a})),this.manipulators.addMany(this.resizeManipulators),this._outlineVisualElement=he(this.view),this._gridVisualElement=pe(this.view)}destroy(){this.view._stage&&(this.view._stage.remove(this.rotateHeadingTexture),this.view._stage.remove(this.rotateTiltTexture)),this.detach(),this._handles.destroy(),this._handles=null,this._viewHandles.destroy(),this._viewHandles=null,this._removeFrameTask(),this._clearPointerMoveTimeout(),this._outlineVisualElement.destroy(),this._outlineVisualElement=null,this._gridVisualElement.destroy(),this._gridVisualElement=null}get state(){const e=!!this._planeInfo,t=!!this.inputState;return e?e&&t?"slicing":e&&!t?"sliced":"ready":"ready"}get isSupported(){return"3d"===this.get("view.type")}set model(e){if(null==e)throw new Error("SliceTool requires valid model, but null was provided.");this._handles.remove("model"),this._set("model",e),this._handles.add(this.model.watch("plane",(()=>this.planeChanged()),!0),"model")}planeChanged(){if(!this.view)return;const e=this.model.plane,a=this._planeInfo;if(i(a)&&i(e)||t(a)&&t(e)&&e.equals(a))return;let s=null;if(t(e)){const i=ue(e,this.view.renderCoordsHelper,z.create());t(i)&&(s={plane:i,heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height})}this._updateInternalSlicePlane(s)}get excludedLayers(){return this._get("excludedLayers")||new l}set excludedLayers(e){this._set("excludedLayers",d(e,this._get("excludedLayers")))}set excludeGroundSurface(e){this._set("excludeGroundSurface",e),this.view&&this._updateLayerViews()}set tiltEnabled(e){e!==this._get("tiltEnabled")&&(this._set("tiltEnabled",e),this.view&&(this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),t(this._planeInfo)&&!e&&(this._planeInfo.plane=z.copy(this._planeInfo.plane)),this._updateManipulators()))}get inputState(){return this._get("inputState")}set inputState(e){this._set("inputState",e),this._updateMaterials()}get _isTargeting(){return!this.inputState&&!this._planeInfo&&this.active}get _creatingPointerId(){return this.inputState&&"shift"===this.inputState.type?this.inputState.creatingPointerId:null}enterExcludeLayerMode(){i(this._planeInfo)||(this._set("layersMode","exclude"),V(this,!0))}exitExcludeLayerMode(){i(this._planeInfo)||(this._set("layersMode","none"),V(this,!1))}deactivate(){this._updateMouseCursor(),this._set("layersMode","none"),this._updatePreviewPlane(null)}onDetach(){this._planeInfo=null,this._updateLayerViews(),this._set("layersMode","none")}onShow(){this._updateMouseCursor(),this._updateLayerViews(),this._updateManipulators(),this._updateVisualElementVisibility();const e=this.view;e.slicePlane=t(this._planeInfo)?this._planeInfo.plane:null,0===this._viewHandles.size&&this._viewHandles.add([e.allLayerViews.on("change",(()=>this._updateLayerViews())),this.excludedLayers.on("change",(()=>this._updateLayerViews()))])}onHide(){this._updateMouseCursor(),this._updateLayerViews(),this._updateVisualElementVisibility(),this.view.slicePlane=null,this._viewHandles.removeAll(),this._clearPointerMoveTimeout()}onInputEvent(e){switch(e.type){case"pointer-drag":if(!ke(e))return;this._onPointerDrag(e)&&e.stopPropagation();break;case"pointer-move":this._onPointerMove(e),this._updateMouseCursor();break;case"pointer-up":this._onPointerUp(e)&&e.stopPropagation();break;case"immediate-click":if(!ke(e))return;this._onClickPlacePlane(e)&&(e.stopPropagation(),this._updateMouseCursor());break;case"click":if(!ke(e))return;this._onClickExcludeLayer(e)&&e.stopPropagation();break;case"drag":this.inputState&&e.stopPropagation();break;case"key-down":this._onKeyDown(e)&&e.stopPropagation();break;case"key-up":this._onKeyUp(e)&&e.stopPropagation()}}onEditableChange(){this._outlineVisualElement.width=this.editable?$:N}_updateLayerViews(){const e=t(this._planeInfo)&&this.visible,i=[],a=e=>{"layers"in e?e.layers.forEach(a):i.push(e)};this.excludedLayers.forEach(a),this.view.allLayerViews.forEach((t=>{"slicePlaneEnabled"in t&&(t.slicePlaneEnabled=e&&i.indexOf(t.layer)<0),"sublayerViews"in t&&t.sublayerViews.forEach((t=>{t.slicePlaneEnabled=e&&i.indexOf(t.sublayer)<0}))})),this.view.basemapTerrain.slicePlaneEnabled=e&&!this.excludeGroundSurface}_onPointerDrag(e){if(e.pointerId===this._creatingPointerId){const t=j(e);return this.shiftManipulator.events.emit("drag",{action:"start",pointerType:e.pointerType,start:t,screenPoint:t}),!0}return!1}_onPointerMove(e){this._lastCursorPosition.x=e.x,this._lastCursorPosition.y=e.y,this._resetPointerMoveTimeout(),"touch"!==e.pointerType&&this._updatePreviewPlane(j(e),this._activeKeyModifiers)}_onCameraChange(){this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),this._updateManipulators()}_onPointerUp(e){return!(e.pointerId!==this._creatingPointerId||!t(this._planeInfo))&&(z.copy(this._planeInfo.plane,this._startPlane),this.inputState=null,!0)}_onClickPlacePlane(e){if("exclude"===this.layersMode)return!1;if(this._isTargeting){const t=j(e),i=z.create();if(this._pickPlane(t,!1,this._activeKeyModifiers,i)){z.copy(i,this._startPlane);const a=this._calculatePickRay(t);return this.model.plane=de(i,this.view.renderCoordsHelper,this.view.spatialReference,new ae),this.inputState=Ee(a,e.pointerId,i.origin,i),!0}}return!1}_onClickExcludeLayer(e){return!("exclude"!==this.layersMode||!this.created)&&(this.view.hitTest(j(e)).then((e=>{if(e.results.length){const t=e.results[0],i=t&&t.graphic;if(i){const e=i.sourceLayer||i.layer;e&&this.excludedLayers.push(e)}}else e.ground.layer?this.excludedLayers.push(e.ground.layer):this.excludeGroundSurface=!0})),this._set("layersMode","none"),V(this,!1),!0)}_onKeyDown(e){return(e.key===J||e.key===Q)&&(this._activeKeyModifiers[e.key]=!0,t(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}_onKeyUp(e){return!(e.key!==J&&e.key!==Q||!this._activeKeyModifiers[e.key])&&(delete this._activeKeyModifiers[e.key],t(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}_onShiftGrab(e){if("start"!==e.action||i(this._planeInfo))return;const t=this._calculatePickRay(e.screenPoint);z.copy(this._planeInfo.plane,this._startPlane),this.inputState=Ee(t,null,this.shiftManipulator.renderLocation,this._planeInfo.plane)}_createShiftDragPipeline(e){return A(e,((e,i,a)=>{const s=this.inputState;if(!s||"shift"!==s.type)return;const n=t(this._planeInfo)?z.copy(this._planeInfo.plane,z.create()):null;i.next(B(this.view,s.shiftPlane)).next(this._shiftDragAdjustSensitivity(s)).next(this._shiftDragUpdatePlane(s)),a.next((()=>{t(n)&&this._updateSlicePlane(n)}))}))}_shiftDragAdjustSensitivity(e){return t=>{if(i(this._planeInfo))return null;const a=.001,s=Math.min((1-Math.abs(m(z.normal(this._planeInfo.plane),t.ray.direction)/g(t.ray.direction)))/a,1),n=-U.signedDistance(this._startPlane.plane,t.renderEnd),r=-U.signedDistance(this._startPlane.plane,e.startPoint);return e.depth=e.depth*(1-s)+n*s-r,t}}_shiftDragUpdatePlane(e){return()=>{if(i(this._planeInfo))return;const t=y(L.get(),this._startPlane.origin),a=y(L.get(),z.normal(this._startPlane));v(a,a,-e.depth),P(a,a,t),z.fromValues(a,this._planeInfo.plane.basis1,this._planeInfo.plane.basis2,this._planeInfo.plane),this._updateSlicePlane(this._planeInfo.plane)}}_onRotateHeadingGrab(e){if("start"!==e.action||i(this._planeInfo))return;const t=ce(this._planeInfo.plane,this.view.renderCoordsHelper,1,U.create()),a=this._calculatePickRay(e.screenPoint),s=f();U.intersectRay(t,a,s)&&(z.copy(this._planeInfo.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:s})}_createRotateHeadingDragPipeline(e){return A(e,((e,i,a)=>{const s=this.inputState;if(!s||"rotate"!==s.type)return;const n=t(this._planeInfo)?z.copy(this._planeInfo.plane,z.create()):null;i.next(B(this.view,s.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(s)).next(this._rotateDragUpdatePlaneFromRotate()),a.next((()=>{t(n)&&this._updateSlicePlane(n)}))}))}_onRotateTiltGrab(e){if("start"!==e.action||i(this._planeInfo))return;const t=ce(this._planeInfo.plane,this.view.renderCoordsHelper,2,U.create()),a=this._calculatePickRay(e.screenPoint),s=f();U.intersectRay(t,a,s)&&(z.copy(this._planeInfo.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:s})}_createRotateTiltDragPipeline(e){return A(e,((e,i,a)=>{const s=this.inputState;if(!s||"rotate"!==s.type)return;const n=t(this._planeInfo)?z.copy(this._planeInfo.plane,z.create()):null;i.next(B(this.view,s.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(s)).next(this._rotateDragUpdatePlaneFromRotate()),a.next((()=>{t(n)&&this._updateSlicePlane(n)}))}))}_rotateDragRenderPlaneToRotate(e){return t=>{if(i(this._planeInfo))return null;const a=U.normal(e.rotatePlane),s=q(this.inputState.startPoint,t.renderEnd,this._planeInfo.plane.origin,a);return{...t,rotateAxis:a,rotateAngle:s}}}_rotateDragUpdatePlaneFromRotate(){return e=>{if(i(this._planeInfo))return;const t=x(R.get());E(t,t,e.rotateAngle,e.rotateAxis);const a=w(L.get(),this._startPlane.basis1,t),s=w(L.get(),this._startPlane.basis2,t);z.fromValues(this._planeInfo.plane.origin,a,s,this._planeInfo.plane),this._updateSlicePlane(this._planeInfo.plane)}}_onResizeGrab(e,t){if("start"!==e.action||i(this._planeInfo))return;const a=this._calculatePickRay(e.screenPoint),s=L.get();U.intersectRay(this._planeInfo.plane.plane,a,s)&&(z.copy(this._planeInfo.plane,this._startPlane),this.inputState={type:"resize",activeHandleIdx:t,startPoint:_(s)})}_createResizeDragPipeline(e){return A(e,((e,t,a)=>{const s=this.inputState;if(!s||"resize"!==s.type||i(this._planeInfo))return;const n=z.copy(this._planeInfo.plane,z.create());t.next(B(this.view,this._planeInfo.plane.plane)).next(this._resizeDragUpdatePlane(s)),a.next((()=>{this._updateSlicePlane(n)}))}))}_resizeDragUpdatePlane(e){return t=>{if(i(this._planeInfo))return;const a=this._resizeHandles[e.activeHandleIdx];_e(a,this.inputState.startPoint,t.renderEnd,this.view._stage.camera,this._startPlane,this._planeInfo.plane),this._updateSlicePlane(this._planeInfo.plane)}}_updateSlicePlane(e){const i=de(e,this.view.renderCoordsHelper,this.view.spatialReference,new ae);let a=null;t(i)&&(a={plane:e,heading:i.heading,tilt:i.tilt,position:i.position,width:i.width,height:i.height}),this._updateInternalSlicePlane(a),this.model.plane=i}_updateInternalSlicePlane(e){const i=t(this._planeInfo);this._planeInfo=e,!this.tiltEnabled&&t(this._planeInfo)&&se(this._planeInfo.plane,this.view.renderCoordsHelper,this._planeInfo.plane),i!==t(this._planeInfo)&&this._updateLayerViews(),this.visible&&this.attached&&(this.view.slicePlane=t(this._planeInfo)?this._planeInfo.plane:null,this._updateManipulators())}_updatePreviewPlane(e,a={}){let s=this._previewPlane;if(this._previewPlane=null,i(e))return this._removeFrameTask(),void this._updateManipulators();if(!this._planeInfo&&this.active){const i=t(s)?s:z.create();if(s=t(s)?z.copy(s,He):null,this._pickPlane(e,!0,a,i)){const e=ee;let a=!1;t(s)&&(a=m(s.plane,i.plane)<e||m(M(L.get(),s.basis1),M(L.get(),i.basis1))<e),a&&(this._baseOpacity=0),this._previewPlane=i}}t(this._previewPlane)&&i(this._frameTask)&&0===this._baseOpacity?this._frameTask=o({update:({deltaTime:e})=>{this._baseOpacity=Math.min(this._baseOpacity+e/(1e3*W),1),this._updateManipulators(),1===this._baseOpacity&&this._removeFrameTask()}}):i(this._previewPlane)&&t(this._frameTask)?this._removeFrameTask():t(this._previewPlane)&&this._updateManipulators()}_removeFrameTask(){t(this._frameTask)&&(this._frameTask.remove(),this._frameTask=null)}_calculatePickRay(e){const t=O.create(),i=p(e,Ce);return O.fromScreen(this.view.state.camera,i,t),M(t.direction,t.direction),t}_pickMinResult(e){const t=p(e,D.get());return this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector),this._intersector.results.min}_pickPlane(e,t,i,a){const s=this._pickMinResult(e),n=L.get();if(!s.getIntersectionPoint(n))return!1;const r=s.getTransformedNormal(L.get()),o=this.view._stage.camera;m(r,o.viewForward)>0&&v(r,r,-1);const l=fe(n,o),h=(t?1:-1)*l*te,p=v(L.get(),r,h);P(p,p,n);const u=this.tiltEnabled?3:0,d=i[J]?2:i[Q]?1:u;return me(p,r,l,l,o,d,this.view.renderCoordsHelper,a),!0}_updateMouseCursor(){this._set("cursor",null),this._isTargeting||"exclude"===this.layersMode?this._set("cursor","crosshair"):t(this._creatingPointerId)&&this._set("cursor","grabbing")}_clearPointerMoveTimeout(){this._prevPointerMoveTimeout&&(this._prevPointerMoveTimeout.remove(),this._prevPointerMoveTimeout=null)}_resetPointerMoveTimeout(){this._clearPointerMoveTimeout(),this.shiftManipulator.state|=ge,this.rotateHeadingManipulator.state|=ge,this.rotateTiltManipulator.state|=ge,this._prevPointerMoveTimeout=this.clock.setTimeout((()=>{this.shiftManipulator.state&=~ge,this.rotateHeadingManipulator.state&=~ge,this.rotateTiltManipulator.state&=~ge}),X)}_updateManipulators(){if(this.disableEngineLayers)return;let e=null,i=!1,a=!1;t(this._planeInfo)?(e=this._planeInfo.plane,i=!0):t(this._previewPlane)&&(e=this._previewPlane,a=!0);const s=t(e)?ye(e,R.get()):null;if(this.shiftManipulator.available=i,this.rotateHeadingManipulator.available=i,this.rotateTiltManipulator.available=i&&this.tiltEnabled,this.resizeManipulators.forEach((e=>e.available=i)),i&&(ve(this.shiftManipulator,s,e,this.view._stage.camera),Pe(this.rotateHeadingManipulator,s,e,this.view.renderCoordsHelper),we(this.rotateTiltManipulator,s,e),this.resizeManipulators.forEach(((t,i)=>Me(t,this._resizeHandles[i],s,e)))),this._outlineVisualElement.width=a?N:$,t(e)){const t=I(L.get(),g(e.basis1),g(e.basis2),1),i=k(R.get(),t),a=H(i,s,i);this._outlineVisualElement.transform=a,this._gridVisualElement.transform=a,this._updateMaterials()}this._updateVisualElementVisibility()}_updateVisualElementVisibility(){if(this.disableEngineLayers)return;let e=null;t(this._planeInfo)?e=this._planeInfo.plane:t(this._previewPlane)&&(e=this._previewPlane),this._outlineVisualElement.visible=this.visible,this._gridVisualElement.visible=t(e)&&this.visible}_updateMaterials(){const e=[Y[0],Y[1],Y[2],Y[3]*this._baseOpacity];this._outlineVisualElement.color=e;const t=[Z[0],Z[1],Z[2],Z[3]*this._baseOpacity],i=this.inputState&&"resize"===this.inputState.type?ie:[0,0,0,0];this._gridVisualElement.backgroundColor=t,this._gridVisualElement.gridColor=i}updateManipulatorsInteractive(e){if(!e.grabbing)return this.shiftManipulator.interactive=!0,this.rotateHeadingManipulator.interactive=!0,this.rotateTiltManipulator.interactive=!0,void this.resizeManipulators.forEach((e=>{e.interactive=!0}));this.shiftManipulator.interactive=this.shiftManipulator===e,this.rotateHeadingManipulator.interactive=this.rotateHeadingManipulator===e,this.rotateTiltManipulator.interactive=this.rotateTiltManipulator===e,this.resizeManipulators.forEach((t=>{t.interactive=t===e}))}testData(){return{plane:t(this._planeInfo)?this._planeInfo.plane:null}}};function Ee(e,t,i,a){const s=Ie(i,z.normal(a),e.direction,U.create()),n=f();return U.intersectRay(s,e,n)?{type:"shift",creatingPointerId:t,shiftPlane:s,depth:0,startPoint:n}:null}function ke(e){return"mouse"!==e.pointerType||0===e.button}e([s()],xe.prototype,"clock",void 0),e([s({constructOnly:!0})],xe.prototype,"view",void 0),e([s({readOnly:!0})],xe.prototype,"state",null),e([s({readOnly:!0})],xe.prototype,"isSupported",null),e([s({readOnly:!0})],xe.prototype,"cursor",void 0),e([s()],xe.prototype,"model",null),e([s()],xe.prototype,"_planeInfo",void 0),e([s({readOnly:!0})],xe.prototype,"layersMode",void 0),e([s({cast:c})],xe.prototype,"excludedLayers",null),e([s({type:Boolean,value:!1})],xe.prototype,"excludeGroundSurface",null),e([s({type:Boolean,value:!1})],xe.prototype,"tiltEnabled",null),e([s({value:null})],xe.prototype,"inputState",null),xe=e([n("esri.views.3d.interactive.analysisTools.slice.SliceTool")],xe);const He=z.create(),Ce=u();var Ve=xe;export default Ve;
