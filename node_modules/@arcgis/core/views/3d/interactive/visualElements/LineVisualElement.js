/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{isSome as e,isNone as t}from"../../../../core/maybe.js";import{Z as r,c as s}from"../../../../chunks/vec3f64.js";import{s as i}from"../../../../chunks/vec3.js";import{i as o,t as n}from"../../../../chunks/mat4.js";import{a as l}from"../../../../chunks/mat4f64.js";import{g as a,c as h}from"../../../../chunks/vec4.js";import{f as p,c as d,a as f}from"../../../../chunks/vec4f32.js";import{RibbonLineMaterial as _}from"../../webgl-engine/materials/RibbonLineMaterial.js";import{createGeometry as c}from"../../layers/graphics/lineUtils.js";import{Object3DVisualElement as m}from"./Object3DVisualElement.js";class u extends m{constructor(e){super(e),this._renderOccluded=4,this._width=1,this._color=p(1,0,1,1),this._innerWidth=1,this._innerColor=null,this._stipplePattern=null,this._stippleOffColor=null,this._stippleIntegerRepeats=!1,this._writeDepthEnabled=!0,this._falloff=0,this._polygonOffset=!1,this.applyProps(e)}setGeometryFromExtent(e){const t=this.view.spatialReference,r=s(),o=s(),n=100,l=[];i(r,e[0],e[1],n),this.view.renderCoordsHelper.toRenderCoords(r,t,o),l.push([o[0],o[1],o[2]]),i(r,e[2],e[1],n),this.view.renderCoordsHelper.toRenderCoords(r,t,o),l.push([o[0],o[1],o[2]]),i(r,e[2],e[3],n),this.view.renderCoordsHelper.toRenderCoords(r,t,o),l.push([o[0],o[1],o[2]]),i(r,e[0],e[3],n),this.view.renderCoordsHelper.toRenderCoords(r,t,o),l.push([o[0],o[1],o[2]]),i(r,e[0],e[1],n),this.view.renderCoordsHelper.toRenderCoords(r,t,o),l.push([o[0],o[1],o[2]]),i(r,e[0],e[1],n),this.view.renderCoordsHelper.toRenderCoords(r,t,o),l.push([o[0],o[1],o[2]]),this.geometry=[l]}setGeometryFromFrustum(e){const t=[];e.lines.forEach((e=>{t.push([e.origin[0],e.origin[1],e.origin[2]]),t.push([e.endpoint[0],e.endpoint[1],e.endpoint[2]])})),this.geometry=[t]}setGeometryFromSegment(e){const t=e.endRenderSpace;o(g),n(g,g,t),this.transform=g;const{points:r}=e.createRenderGeometry(t,this.view.renderCoordsHelper);this.geometry=[r]}setGeometryFromSegments(e,t=r){o(g),n(g,g,t),this.transform=g,this.geometry=e.map((e=>e.createRenderGeometry(t,this.view.renderCoordsHelper).points))}get renderOccluded(){return this._renderOccluded}set renderOccluded(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}get geometry(){return this._geometry}set geometry(e){this._geometry=e,this.recreateGeometry()}get width(){return this._width}set width(e){e!==this._width&&(this._width=e,this._updateMaterial())}get color(){return this._color}set color(e){a(e,this._color)||(h(this._color,e),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(r){e(r)?!t(this._innerColor)&&a(r,this._innerColor)||(this._innerColor=h(d(),r),this._updateMaterial()):e(this._innerColor)&&(this._innerColor=null,this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(t){const r=e(t)!==e(this._stipplePattern);this._stipplePattern=t,r?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(r){(t(r)||t(this._stippleOffColor)||!a(r,this._stippleOffColor))&&(this._stippleOffColor=e(r)?f(r):null,this._updateMaterial())}get stippleIntegerRepeats(){return this._stippleIntegerRepeats}set stippleIntegerRepeats(e){this._stippleIntegerRepeats!==e&&(this._stippleIntegerRepeats=e,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}get falloff(){return this._falloff}set falloff(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}createExternalResources(){this._material=new _(this.materialParameters)}destroyExternalResources(){this._material=null}createGeometries(e){const t=this._createLineGeometries();if(0!==t.length)for(let r=0;r<t.length;++r){const s=c(t[r]);e.addGeometry(s,this._material)}}forEachExternalMaterial(e){e(this._material)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,isClosed:!1,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,stippleIntegerRepeats:this._stippleIntegerRepeats,polygonOffset:this._polygonOffset,renderOccluded:this._renderOccluded,writeDepth:this._writeDepthEnabled}}_updateMaterial(){this.attached&&this._material.setParameterValues(this.materialParameters)}_createLineGeometries(){const e=this.geometry;if(t(e)||0===e.length)return[];const r=[];return e.forEach((e=>{const t=e.length,s=new Float64Array(3*t);e.forEach(((e,t)=>{s[3*t+0]=e[0],s[3*t+1]=e[1],s[3*t+2]=e[2]}));const i={attributeData:{position:s},removeDuplicateStartEnd:0};r.push(i)})),r}}const g=l();export{u as LineVisualElement};
