/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../../../chunks/tslib.es6.js";import"../../../../../../core/has.js";import{isSome as t,isNone as r}from"../../../../../../core/maybe.js";import"../../../../../../core/Logger.js";import"../../../../../../core/accessorSupport/ensureType.js";import{property as i}from"../../../../../../core/accessorSupport/decorators/property.js";import{subclass as s}from"../../../../../../core/accessorSupport/decorators/subclass.js";import"../../../../../../core/urlUtils.js";import"../../../../../../core/uuid.js";import"../../../../../../portal/support/resourceExtension.js";import{init as o}from"../../../../../../core/watchUtils.js";import{HandleOwner as l}from"../../../../../../core/HandleOwner.js";import{distanceToTile as n}from"../../../../../interactive/snapping/featureSources/featureServiceSource/tileUtils.js";let u=class extends l{constructor(e){super(e),this.pointOfInterest=null}get tiles(){const e=this.tilesCoveringView,r=this.effectivePointOfInterest;if(t(r)){const t=e.map((e=>n(r,e)));for(let i=1;i<t.length;i++)if(t[i-1]>t[i])return e.sort(((e,t)=>n(r,e)-n(r,t))),e.slice()}return e}get tilesCoveringView(){var e,t;return this.filterTiles(null==(e=this.view.featureTiles)||null==(t=e.tiles)?void 0:t.toArray()).map(c)}get tileInfo(){var e,t;return null!=(e=null==(t=this.view.featureTiles)?void 0:t.tilingScheme.toTileInfo())?e:null}get tileSize(){var e,t;return null!=(e=null==(t=this.view.featureTiles)?void 0:t.tileSize)?e:256}get effectivePointOfInterest(){var e;const r=this.pointOfInterest;return t(r)?r:null==(e=this.view.pointsOfInterest)?void 0:e.focus.location}initialize(){this.handles.add(o(this.view,"featureTiles",(e=>{this.handles.remove(p),e&&this.handles.add(e.addClient(),p)})))}filterTiles(e){if(r(e))return[];return e.filter((e=>Math.abs(e.measures.screenRect[3]-e.measures.screenRect[1])>a&&2===e.measures.visibility))}};function c({lij:[e,t,r],extent:i}){return{id:`${e}/${t}/${r}`,level:e,row:t,col:r,extent:i}}e([i({readOnly:!0})],u.prototype,"tiles",null),e([i({readOnly:!0})],u.prototype,"tilesCoveringView",null),e([i({readOnly:!0})],u.prototype,"tileInfo",null),e([i({readOnly:!0})],u.prototype,"tileSize",null),e([i({constructOnly:!0})],u.prototype,"view",void 0),e([i()],u.prototype,"pointOfInterest",void 0),e([i()],u.prototype,"effectivePointOfInterest",null),u=e([s("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles3D")],u);const a=50,p="feature-tiles";export{u as FeatureServiceTiles3D};
