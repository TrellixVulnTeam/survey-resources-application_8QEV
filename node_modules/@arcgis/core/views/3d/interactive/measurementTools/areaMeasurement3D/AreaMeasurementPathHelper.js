/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{isSome as e}from"../../../../../core/maybe.js";import t from"../../../../../geometry/Point.js";import"../../../../../geometry.js";import i from"../../../../../core/Evented.js";import r from"../../../../../core/Handles.js";import{init as o}from"../../../../../core/watchUtils.js";import{createCoordinateHelper as n}from"../../../../interactive/coordinateHelper.js";import{EditGeometry as s,Component as m}from"../../../../interactive/editGeometry/EditGeometry.js";export{Component,Edge,EditGeometry,Vertex}from"../../../../interactive/editGeometry/EditGeometry.js";import{AppendVertex as h}from"../../../../interactive/editGeometry/operations/AppendVertex.js";import{SetVertexPosition as d}from"../../../../interactive/editGeometry/operations/SetVertexPosition.js";class l extends i{constructor(){super(),this._handles=new r,this._dirty=!0,this._model=null,this._view=null,this._version=0,this._internalGeometryChange=!1}set model(t){this._model=t,e(this._model)&&e(this._view)&&this._initialize(this._model,this._view)}get model(){return this._model}get view(){return this._view}set view(t){this._view=t,e(this._model)&&e(this._view)&&this._initialize(this._model,this._view)}get initialized(){return e(this._model)&&e(this._view)}get version(){return this._version}_initialize(e,t){this._handles.removeAll(),this._handles.add(o(e,"geometry",(()=>this._updateEditGeometryFromModelGeometry(e,t)),!0))}_updateEditGeometryFromModelGeometry(t,i){this._version++,this._internalGeometryChange||(this._handles.remove("EditGeometry"),this._editGeometry=e(t.geometry)?s.fromGeometry(t.geometry,i.viewingMode):new s(n(!0,!1,i.spatialReference,i.viewingMode)),this.emit("clear",{type:"clear"}),this._handles.add(this._editGeometry.on("change",(e=>{this._internalGeometryChange=!0,t.geometry=this.numVertices>0?this._editGeometry.toPolygon():null,this._internalGeometryChange=!1})),"EditGeometry"))}get vertices(){const e=[];return this.forEachVertex((t=>{e.push(t)})),e}get numVertices(){return this.initialized&&this._editGeometry.components.length>0?this._editGeometry.components[0].vertices.length:0}get lastPoint(){if(this.initialized&&this._editGeometry.components.length>0){const t=this._editGeometry.components[0].getLastVertex();if(e(t))return this._editGeometry.coordinateHelper.createPoint(t.pos)}return null}getVertex(e){if(!this.initialized||0===this._editGeometry.components.length||0===this._editGeometry.components[0].vertices.length)return null;const t=this._editGeometry.components[0].vertices[0];let i=t;do{if(i.index===e)return i;i=i.right.right}while(i!==t&&null!=i);return null}getVertexPositionAsPoint(e){return this._editGeometry.coordinateHelper.createPoint(e.pos)}getVertexPositionAsPointFromIndex(e){return this._editGeometry.coordinateHelper.createPoint(this.getVertex(e).pos)}forEachVertex(e){this.initialized&&this._editGeometry.components.length>0&&this._editGeometry.components[0].iterateVertices(e)}forEachVertexPosition(e){const t=this._editGeometry.coordinateHelper;this.forEachVertex(((i,r)=>{t.toPoint(i.pos,a),e(a,r)}))}clear(){e(this.model)&&(this.model.geometry=null)}add(e){if(!this.initialized)return null;0===this._editGeometry.components.length&&this._editGeometry.components.push(new m(this._editGeometry));const t=new h(this._editGeometry,this._editGeometry.components[0],this._editGeometry.coordinateHelper.fromPoint(e));return this._editGeometry.apply(t),this.emit("vertex-update",{type:"vertex-update"}),t}ensureContains(e,t=""){let i=!1;if(this._editGeometry.components.forEach((t=>{t.iterateVertices((t=>{t===e&&(i=!0)}))})),!i)throw new Error(`vertex doesnt exist ${t}`);return i}setVertexPosition(e,t){if(!this.initialized)return null;const i=new d(this._editGeometry,e,this._editGeometry.coordinateHelper.fromPoint(t));return this._editGeometry.apply(i),this.emit("vertex-update",{type:"vertex-update"}),i}}const a=new t;export{l as AreaMeasurement3DPathHelper};
