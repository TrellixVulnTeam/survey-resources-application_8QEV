/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{isSome as t}from"../../../core/maybe.js";import e from"../../../geometry/SpatialReference.js";import{g as s}from"../../../chunks/vec3.js";import{getMetersPerUnitForSR as i}from"../../../core/unitUtils.js";import{d as r}from"../../../chunks/mat4.js";import{projectPointToVector as o,projectVectorToVector as n,projectVectorToDehydratedPoint as a,projectVectorToPoint as c}from"../../../geometry/projection.js";import{isDehydratedPoint as m}from"../../../layers/graphics/dehydratedFeatures.js";import{sv3d as d}from"./stack.js";import{plane as l}from"./geometryUtils.js";import{create as h,setExtent as f,altitudeAt as u,setAltitudeAt as y,setAltitudeOfTransformation as p,normalAt as S,axisAt as g,elevate as j,intersectRayClosestSilhouette as R,intersectRay as w,createGlobal as A,createLocal as M}from"./geometryUtils/coordinateSystem.js";class _{constructor(t,e,s,i){this.viewingMode=t,this.spatialReference=e,this.unitInMeters=s,this.coordinateSystem=i,this._coordinateSystem=h(i)}set extent(t){t&&f(this.coordinateSystem,t,this.coordinateSystem)}getAltitude(t){return u(this.coordinateSystem,t)}setAltitude(t,e){y(this.coordinateSystem,e,t,e)}setAltitudeOfTransformation(t,e){p(this.coordinateSystem,e,t,e)}worldUpAtPosition(t,e){return S(this.coordinateSystem,t,e)}worldBasisAtPosition(t,e,s){return g(this.coordinateSystem,t,e,s)}basisMatrixAtPosition(t,e){const s=this.worldBasisAtPosition(t,0,d.get()),i=this.worldBasisAtPosition(t,1,d.get()),o=this.worldBasisAtPosition(t,2,d.get());return r(e,s[0],s[1],s[2],0,i[0],i[1],i[2],0,o[0],o[1],o[2],0,0,0,0,1),e}intersectManifoldClosestSilhouette(t,e,s){return j(this.coordinateSystem,e,this._coordinateSystem),R(this._coordinateSystem,t,s),s}intersectManifold(t,e,i){j(this.coordinateSystem,e,this._coordinateSystem);const r=d.get();return!!w(this._coordinateSystem,t,r)&&(s(i,r),!0)}intersectInfiniteManifold(t,e,i){if(1===this.viewingMode)return this.intersectManifold(t,e,i);j(this.coordinateSystem,e,this._coordinateSystem);const r=this._coordinateSystem.value,o=d.get();return!!l.intersectRay(r.plane,t,o)&&(s(i,o),!0)}toRenderCoords(t,e,s){return m(t)?o(t,e,this.spatialReference):n(t,e,s,this.spatialReference)}fromRenderCoords(s,i,r=null){return m(i)?(t(r)&&(i.spatialReference=r),a(s,this.spatialReference,i)):i instanceof e?c(s,this.spatialReference,i):n(s,this.spatialReference,i,r)?i:null}static createGlobal(t){return new _(1,t,1,A(t))}static createLocal(t){return new _(2,t,i(t),M())}static createMode(t,e){switch(t){case 2:return _.createLocal(e);case 1:return _.createGlobal(e)}}}export{_ as RenderCoordsHelper};
