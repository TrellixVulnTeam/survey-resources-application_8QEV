/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{deduplicate as e}from"../../../../../geometry/support/meshUtils/deduplicate.js";import{EdgeInputBufferLayout as t}from"./bufferLayouts.js";import{RegularEdgeBufferWriter as n,SilhouetteEdgeBufferWriter as r}from"./edgeBufferWriters.js";import{packInterleavedBuffer as i}from"../../../support/buffer/workerHelper.js";import{computeNeighbors as s}from"../../../support/meshProcessing.js";import{extractEdges as o}from"./edgePreprocessing.js";async function a(e){const t=u(e),n=f(t),r=[t.data.buffer];return{result:c(n,r),transferList:r}}function f(e){const t=g(e.data,e.skipDeduplicate,e.indices,e.indicesLength);return d.updateSettings(e.writerSettings),l.updateSettings(e.writerSettings),o(t,d,l)}function u(e){return{data:t.createView(e.dataBuffer),indices:"Uint32Array"===e.indicesType?new Uint32Array(e.indicesBuffer):"Uint16Array"===e.indicesType?new Uint16Array(e.indicesBuffer):void 0,indicesLength:e.indicesLength,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate}}function c(e,t){t.push(e.regular.lodInfo.lengths.buffer),t.push(e.silhouette.lodInfo.lengths.buffer);return{regular:{instancesData:i(e.regular.instancesData,t),lodInfo:{lengths:e.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:i(e.silhouette.instancesData,t),lodInfo:{lengths:e.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:e.averageEdgeLength}}function g(n,r,i,o){if(r){return{faces:i,facesLength:o,neighbors:s(i,o,n.count),vertices:n}}const a=e(n.buffer,n.stride/4,{originalIndices:i,originalIndicesLength:o}),f=s(a.indices,o,a.uniqueCount);return{faces:a.indices,facesLength:a.indices.length,neighbors:f,vertices:t.createView(a.buffer)}}const d=new n,l=new r;export{f as work,a as wrappedWork};
