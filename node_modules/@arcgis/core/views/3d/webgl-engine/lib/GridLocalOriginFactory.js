/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{isSome as t}from"../../../../core/maybe.js";import i from"../../../../geometry/SpatialReference.js";import{c as s}from"../../../../chunks/vec3f64.js";import{f as r}from"../../../../chunks/vec3.js";import{projectBuffer as o}from"../../../../geometry/projection.js";import{I as e}from"../../../../chunks/mat4f64.js";import{Geometry as n}from"./Geometry.js";import{Object3D as a}from"./Object3D.js";import{fromValues as h}from"./localOrigin.js";import{WebGLLayer as c}from"./WebGLLayer.js";import{RibbonLineMaterial as m}from"../materials/RibbonLineMaterial.js";let _=0;const d="rg_";class g{constructor(){this.ROOT_ORIGIN_ID=d+"root_"+_++,this._origins=new Map,this._gridSize=42e5}getOrigin(i){const s=this._origins.get(this.ROOT_ORIGIN_ID);if(null==s){if(t(g.testOrigin)){const t=g.testOrigin;return this._origins.set(this.ROOT_ORIGIN_ID,h(t[0],t[1],t[2],this.ROOT_ORIGIN_ID)),this.getOrigin(i)}const s=h(i[0]+Math.random()-.5,i[1]+Math.random()-.5,i[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);return this._origins.set(this.ROOT_ORIGIN_ID,s),s}r(l,i,s.vec3),l[0]=Math.abs(l[0]),l[1]=Math.abs(l[1]),l[2]=Math.abs(l[2]);const o=this._gridSize;if(l[0]<o&&l[1]<o&&l[2]<o)return s;const e=Math.round(i[0]/o),n=Math.round(i[1]/o),a=Math.round(i[2]/o),c=`${d}${e}/${n}/${a}`;let m=this._origins.get(c);return m||(m=h(e*o,n*o,a*o,c),this._origins.set(c,m)),m}_drawOriginBox(t){const s=window.view,r=s._stage;if(null==this._object){this._material=new m({width:2,color:[0,1,0,1]}),r.add(this._material);const t=new c({isPickable:!1});this._object=new a({castShadow:!1}),r.add(this._object),t.add(this._object),r.add(t)}const h=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],_=h.length,d=new Array(3*_),g=new Uint16Array(2*(_-1)),l=.5*this._gridSize;for(let i=0;i<_;i++)d[3*i+0]=t[0]+(1&h[i]?l:-l),d[3*i+1]=t[1]+(2&h[i]?l:-l),d[3*i+2]=t[2]+(4&h[i]?l:-l),i>0&&(g[2*i+0]=i-1,g[2*i+1]=i);o(d,i.WebMercator,0,d,s.spatialReference,0,_);const O=new n([["position",{size:3,data:d,exclusive:!0}]],[["position",g]],2);r.add(O),this._object.addGeometry(O,this._material,e),console.log(this._origins.size,t)}}const l=s();!function(t){t.testOrigin=null}(g||(g={}));var O=g;export default O;
