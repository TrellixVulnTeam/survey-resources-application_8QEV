/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{isSome as t,isNone as e}from"../../../../core/maybe.js";import{vertexCount as i}from"../../../webgl/Util.js";import{createQuadVAO as r}from"./glUtil3D.js";import{CompositingTechnique as o,CompositingTechniqueConfiguration as s}from"../shaders/CompositingTechnique.js";class n{constructor(t,e){this._rctx=t,this._techniqueRepository=e,this._techniques=new Set}dispose(){this._techniques.forEach((t=>this._techniqueRepository.release(t))),this._techniques.clear(),t(this._vao)&&(this._vao.dispose(),this._vao=null)}composite(t,e=0,i=1){this.compositeInternal(t,e,i,0)}compositeTransparent(t,e,r,s=1){const n=this._rctx;a.alphaMode=1,a.function=3,a.hasOpacityFactor=1!==s;const c=this._techniqueRepository.acquire(o,a);n.bindProgram(c.program),c.bindPipelineState(n),c.program.setUniform1i("colorTexture",1),n.bindTexture(t,1),c.program.setUniform1i("alphaTexture",2),n.bindTexture(e,2),c.program.setUniform1i("frontFaceTexture",3),n.bindTexture(r,3);const h=this.ensureVAO();n.bindVAO(h),n.drawArrays(5,0,i(h,"geometry")),this._techniqueRepository.release(c)}compositeSpecial(t,e){this.compositeInternal(t,0,1,e)}compositeInternal(t,e,r,s){const n=this._rctx;a.alphaMode=e,a.function=s,a.hasOpacityFactor=1!==r;const c=this._techniqueRepository.acquire(o,a);n.bindProgram(c.program),c.bindPipelineState(n),c.program.setUniform1i("tex",1),a.hasOpacityFactor&&c.program.setUniform1f("opacity",r),n.bindTexture(t,1);const h=this.ensureVAO();n.bindVAO(h),n.drawArrays(5,0,i(h,"geometry")),this._techniqueRepository.release(c)}ensureVAO(){return e(this._vao)&&(this._vao=r(this._rctx)),this._vao}}const a=new s;export default n;
