/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{isNone as t,isSome as i,unwrapOr as r}from"../../../../core/maybe.js";import{i as s}from"../../../../chunks/vec3.js";import{maxScale as a}from"../../support/mathUtils.js";import{c as n}from"../../../../chunks/mat4.js";import{I as e,a as o}from"../../../../chunks/mat4f64.js";import{a as h}from"../../../../chunks/vec4f64.js";import{computeAttachmentOriginTriangles as m}from"./geometryDataUtils.js";import{Object3DStateID as u}from"./Object3DStateID.js";import{addObject3DStateID as d,removeObject3DStateID as f}from"../materials/renderers/utils.js";class c{constructor(t,i,r=null,s=null,a,n,e,o,m){this.data=t,this.material=i,this.layerUid=r,this.graphicUid=s,this.boundingSphere=h(),this.instanceParameters={highlights:null,occludees:null,visible:!0},this.shaderTransformationDirty=!0,this.boundingInfo=a,this.material=i,this.origin=null,this.transformation=null,this.calculateShaderTransformation=e,n&&this.updateTransformation(n,o),this.castShadow=m}updateTransformation(t,i){this.transformation=t,this.shaderTransformationDirty=!0,this.computeBoundingSphere(t,i,this.boundingSphere)}shaderTransformationChanged(){this.shaderTransformationDirty=!0}computeBoundingSphere(i,r,n){t(this.boundingInfo)||(r=r||a(i),s(n,this.boundingInfo.getCenter(),i),n[3]=this.boundingInfo.getBSRadius()*r)}get hasShaderTransformation(){return i(this.calculateShaderTransformation)}get primitiveType(){return this.data.primitiveType}getShaderTransformation(){return t(this.calculateShaderTransformation)?r(this.transformation,e):(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=o()),n(this.shaderTransformation,this.calculateShaderTransformation(r(this.transformation,e))),this.shaderTransformationDirty=!1),this.shaderTransformation)}computeAttachmentOrigin(t){if(this.material.computeAttachmentOrigin)return!!this.material.computeAttachmentOrigin(this,t)&&(i(this.transformation)&&s(t,t,this.transformation),!0);const r=this.indices.get("position"),a=this.vertexAttributes.get("position");return!!m(a,r,t)&&(i(this.transformation)&&s(t,t,this.transformation),!0)}get indices(){return this.data.indices}get vertexAttributes(){return this.data.vertexAttributes}addHighlight(){const t=new u(0),i=this.instanceParameters;return i.highlights=d(i.highlights,t),t}removeHighlight(t){const i=this.instanceParameters;i.highlights=f(i.highlights,t)}}export{c as RenderGeometry};
