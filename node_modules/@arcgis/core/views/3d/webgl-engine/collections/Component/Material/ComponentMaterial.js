/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../../../chunks/tslib.es6.js";import{isSome as t}from"../../../../../../core/maybe.js";import{A as s}from"../../../../../../chunks/vec3.js";import{b as r}from"../../../../../../chunks/vec4f64.js";import{v as o,g as a,c as i}from"../../../../../../chunks/vec4.js";import{f as l}from"../../../../../../chunks/vec4f32.js";import{f as n}from"../../../../../../chunks/vec3f32.js";import{defaultMaskAlphaCutoff as h}from"../../../core/shaderLibrary/util/AlphaDiscard.glsl.js";import{a as u}from"../../../../../../chunks/ComponentShader.glsl.js";import{ComponentTechniqueConfiguration as p,ComponentTechnique as c}from"./ComponentTechnique.js";import{MaterialBase as d,parameter as m,parameterBlock as v,MaterialParameterBlock as y}from"../../../core/material/MaterialBase.js";class b extends d{constructor(){super(),this.baseColor=l(1,1,1,1),this.usePBR=!1,this.hasParametersFromSource=!1,this.mrrFactors=n(1,1,.5),this.emissiveFactor=n(0,0,0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null,this.overlayTexOffset=r(-1,-1,-1,-1),this.overlayTexScale=r(0,0,0,0),this.overlayColorInner=null,this.overlayColorOuter=null,this.overlayHighlightInner=null,this.overlayHighlightOuter=null,this.overlayNormalInner=null,this.overlayNormalOuter=null,this.objectOpacity=1,this.commonMaterialParameters=new g,this.componentParameters=new x,this.alphaCutoff=h,this.alphaDiscardMode=1,this.isIntegratedMesh=!1,this.polygonOffsetEnabled=!1,this.ellipsoidMode=1,this.sceneHasOcludees=!1,this._techniqueConfig=new p}dispose(e){this._technique&&(e.release(this._technique),this._technique=void 0),this.baseColorTexture=null,this.metallicRoughnessTexture=null,this.emissionTexture=null,this.occlusionTexture=null,this.normalTexture=null}getTechnique(e,s,r){const o=this._techniqueConfig;if(o.hasVertexColors=r.colors,o.hasNormals=r.normals,o.vertexTextureCoordinates=r.textureCoordinates,o.usePBR=this.usePBR,o.hasMetalnessAndRoughnessTexture=t(this.metallicRoughnessTexture),o.hasEmissionTexture=t(this.emissionTexture),o.hasOcclusionTexture=t(this.occlusionTexture),o.hasNormalTexture=t(this.normalTexture),o.transparencyPassType=0===s.identifier&&null!=s.transparencyPassType?s.transparencyPassType:3,o.multipassTerrainEnabled=0===s.identifier&&null!=s.multipassTerrainParams&&s.multipassTerrainParams.multipassTerrainEnabled,o.cullAboveGround=0===s.identifier&&null!=s.multipassTerrainParams&&s.multipassTerrainParams.cullAboveGround,o.ellipsoidMode=this.ellipsoidMode,this.dirty){o.componentData=this.componentParameters.type,o.cullFace=this.commonMaterialParameters.cullFace,o.doubleSidedMode=this.commonMaterialParameters.doubleSided?1:0,o.baseColorTexture=t(this.baseColorTexture),o.isSchematic=this.hasParametersFromSource&&!t(this.baseColorTexture);const e=this._computeWhichMaterialPass();o.blendingEnabled=1===e||2===e,o.alphaDiscardMode=this.alphaDiscardMode,o.integratedMeshMode=this.isIntegratedMesh?this.overlayColorInner||this.overlayColorOuter?this.overlayNormalInner||this.overlayNormalOuter?3:2:1:0,o.polygonOffsetEnabled=this.polygonOffsetEnabled,this._setClean()}return o.slicePlaneEnabled=s.slicePlaneEnabled&&this.commonMaterialParameters.slicePlaneEnabled,1===s.identifier?(o.output=3,o.vertexDiscardMode=0):2===s.identifier?(o.output=4,o.vertexDiscardMode=0):(2===this._computeWhichMaterialPass()?o.vertexDiscardMode=s.transparent?2:1:o.vertexDiscardMode=0,o.output=f(s.subPass),1===s.subPass&&(o.sceneHasOcludees=s.sceneHasOcludees),0===s.subPass?(o.receiveAmbientOcclusion=s.ambientOcclusionEnabled,o.sceneHasOcludees=s.sceneHasOcludees,o.receiveShadows=s.shadowsEnabled,o.ssrEnabled=s.ssrParams.ssrEnabled):(o.receiveAmbientOcclusion=!1,o.receiveShadows=!1)),this._technique=e.repository.acquireAndReleaseExisting(c,o,this._technique),this._technique}submit(e,s){const r=s.renderable.geometry,o=s.components,a=s.renderable.drawParameters,i=s.renderable.meta.cameraDepthSquared,l=o.geometryRanges,n=o.highlightRanges,h=o.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case 0:e.materialOpaque.submitDraw(this,r,l,a,i);break;case 1:e.materialTransparent.submitDraw(this,r,l,a,i);break;case 2:e.materialOpaque.submitDraw(this,r,l,a,i),e.materialTransparent.submitDraw(this,r,l,a,i);break;case 3:e.materialIntegratedMesh.submitDraw(this,r,l,a,i),(this.overlayHighlightInner||this.overlayHighlightOuter)&&e.highlightIntegratedMesh.submitDraw(this,r,l,a,i)}t(e.shadowMap)&&2!==this.componentParameters.castShadows&&e.shadowMap.submitDraw(this,r,l,a,i),t(e.highlight)&&t(n)&&e.highlight.submitDraw(this,r,n,a,i),t(e.highlightShadowMap)&&2!==this.componentParameters.castShadows&&t(n)&&e.highlightShadowMap.submitDraw(this,r,n,a,i),t(e.defaultShadowMap)&&2!==this.componentParameters.castShadows&&t(h)&&e.defaultShadowMap.submitDraw(this,r,h,a,i)}get attributeLocations(){return u}_computeWhichMaterialPass(){return this.isIntegratedMesh?3:this.objectOpacity<1?1:0===this.componentParameters.opaqueOverride?0:this.baseColor[3]<1||0===this.alphaDiscardMode||3===this.alphaDiscardMode?1:2===this.componentParameters.transparent?0:0===this.componentParameters.transparent?1:2}}e([m({vectorOps:o})],b.prototype,"baseColor",void 0),e([m()],b.prototype,"usePBR",void 0),e([m()],b.prototype,"hasParametersFromSource",void 0),e([m({vectorOps:s})],b.prototype,"mrrFactors",void 0),e([m({vectorOps:s})],b.prototype,"emissiveFactor",void 0),e([m({dispose:!0})],b.prototype,"baseColorTexture",void 0),e([m({dispose:!0})],b.prototype,"metallicRoughnessTexture",void 0),e([m({dispose:!0})],b.prototype,"emissionTexture",void 0),e([m({dispose:!0})],b.prototype,"occlusionTexture",void 0),e([m({dispose:!0})],b.prototype,"normalTexture",void 0),e([m({vectorOps:{equals:a,copy:i}})],b.prototype,"overlayTexOffset",void 0),e([m({vectorOps:{equals:a,copy:i}})],b.prototype,"overlayTexScale",void 0),e([m()],b.prototype,"overlayColorInner",void 0),e([m()],b.prototype,"overlayColorOuter",void 0),e([m()],b.prototype,"overlayHighlightInner",void 0),e([m()],b.prototype,"overlayHighlightOuter",void 0),e([m()],b.prototype,"overlayNormalInner",void 0),e([m()],b.prototype,"overlayNormalOuter",void 0),e([m()],b.prototype,"objectOpacity",void 0),e([v()],b.prototype,"commonMaterialParameters",void 0),e([v()],b.prototype,"componentParameters",void 0),e([m()],b.prototype,"alphaCutoff",void 0),e([m()],b.prototype,"alphaDiscardMode",void 0),e([m()],b.prototype,"isIntegratedMesh",void 0),e([m()],b.prototype,"polygonOffsetEnabled",void 0),e([m()],b.prototype,"ellipsoidMode",void 0),e([m()],b.prototype,"sceneHasOcludees",void 0);class g extends y{constructor(){super(...arguments),this.doubleSided=!1,this.cullFace=2,this.slicePlaneEnabled=!0}}e([m()],g.prototype,"doubleSided",void 0),e([m()],g.prototype,"cullFace",void 0),e([m()],g.prototype,"slicePlaneEnabled",void 0);class x extends y{constructor(){super(...arguments),this.externalColor=l(1,1,1,1),this.externalColorMixMode=1,this.castShadows=0}get transparent(){return this.externalColor[3]<1?0:2}get opaqueOverride(){return 3===this.externalColorMixMode&&1===this.externalColor[3]?0:2}get visible(){return this.externalColor[3]>0?0:2}get type(){return 0}}e([m({vectorOps:o})],x.prototype,"externalColor",void 0),e([m()],x.prototype,"externalColorMixMode",void 0),e([m()],x.prototype,"castShadows",void 0);class M extends y{constructor(){super(...arguments),this.texture=null,this.transparent=2,this.opaqueOverride=2,this.castShadows=2}get type(){return 1}}function f(e){switch(e){case 0:return 0;case 1:return 7;case 2:return 1;case 3:return 2;case 4:return 8}}e([m()],M.prototype,"texture",void 0),e([m()],M.prototype,"transparent",void 0),e([m()],M.prototype,"opaqueOverride",void 0),e([m()],M.prototype,"castShadows",void 0);export{g as CommonMaterialParameters,b as ComponentMaterial,x as ComponentParametersUniform,M as ComponentParametersVarying};
