/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../chunks/tslib.es6.js";import{a as r}from"../../../../chunks/vec4f64.js";import{ReloadableShaderModule as i}from"../core/shaderTechnique/ReloadableShaderModule.js";import{ShaderTechnique as t}from"../core/shaderTechnique/ShaderTechnique.js";import{ShaderTechniqueConfiguration as o,parameter as a}from"../core/shaderTechnique/ShaderTechniqueConfiguration.js";import n from"../../../webgl/Program.js";import{makePipelineState as s,defaultDepthWriteParams as l,defaultColorWriteParams as p}from"../../../webgl/renderState.js";import{View as d}from"../core/shaderLibrary/util/View.glsl.js";import{Slice as c}from"../core/shaderLibrary/Slice.glsl.js";import{blendingDefault as h,OITBlending as m,OITDepthWrite as u,OITPolygonOffset as g}from"../lib/OrderIndependentTransparency.js";import{bindMultipassTerrainUniforms as b}from"../core/shaderLibrary/shading/MultipassTerrainTest.glsl.js";import{ScreenSizeScaling as f}from"../core/shaderLibrary/ScreenSizeScaling.glsl.js";import{S as v}from"../../../../chunks/ShadedColorMaterial.glsl.js";class y extends t{initializeProgram(e){const r=y.shader.get(),i=this.configuration,t=r.build({output:i.output,slicePlaneEnabled:i.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,screenSizeEnabled:i.screenSizeEnabled,shadingEnabled:i.shadingEnabled,OITEnabled:0===i.transparencyPassType,multipassTerrainEnabled:i.multipassTerrainEnabled,cullAboveGround:i.cullAboveGround});return new n(e.rctx,t.generateSource("vertex"),t.generateSource("fragment"),T)}bindPass(e,r,i){const{screenSizeEnabled:t,shadingEnabled:o}=this.configuration,{color:a,shadingTint:n,shadingDirection:s}=r;d.bindProjectionMatrix(this.program,i.camera.projectionMatrix),this.program.setUniform4fv("color",a),i.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",i.camera.nearFar),this.program.setUniform2fv("inverseViewport",i.inverseViewport),b(this.program,e,i)),o&&(this.program.setUniform4fv("shadedColor",this.blendColor(S,n,a)),this.program.setUniform3fv("shadingDirection",s),this.program.setUniformMatrix4fv("viewNormal",i.camera.viewInverseTransposeMatrix)),t&&f.bindPassUniforms(this.program,r,i)}blendColor(e,r,i){const t=1-r[3],o=r[3]+i[3]*t;return 0===o?(e[3]=o,e):(e[0]=(r[0]*r[3]+i[0]*i[3]*t)/o,e[1]=(r[1]*r[3]+i[1]*i[3]*t)/o,e[2]=(r[2]*r[3]+i[2]*i[3]*t)/o,e[3]=i[3],e)}bindDraw(e){d.bindView(this.program,e),d.bindCamPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),c.bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e){const r=this.configuration,i=3===e,t=2===e,o=e=>0!==e&&{face:1===e?1028:1029,mode:2305};return s({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?h:m(e),culling:o(r.cullFace),depthTest:{func:t?513:r.shadingEnabled?515:513},depthWrite:i?r.writeDepth&&l:u(e),colorWrite:p,polygonOffset:i||t?null:g})}initializePipeline(){return this.setPipelineState(this.configuration.transparencyPassType)}}y.shader=new i(v,(()=>import("./ShadedColorMaterial.glsl.js")));class E extends o{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!0}}e([a({count:8})],E.prototype,"output",void 0),e([a({count:3})],E.prototype,"cullFace",void 0),e([a()],E.prototype,"slicePlaneEnabled",void 0),e([a()],E.prototype,"transparent",void 0),e([a()],E.prototype,"writeDepth",void 0),e([a()],E.prototype,"screenSizeEnabled",void 0),e([a()],E.prototype,"shadingEnabled",void 0),e([a({count:4})],E.prototype,"transparencyPassType",void 0),e([a()],E.prototype,"multipassTerrainEnabled",void 0),e([a()],E.prototype,"cullAboveGround",void 0);const T={position:0,normal:1,offset:2},S=r();export{y as ShadedColorMaterialTechnique,E as ShadedColorMaterialTechniqueConfiguration,T as ShadedColorMaterialVertexAttrLocations};
