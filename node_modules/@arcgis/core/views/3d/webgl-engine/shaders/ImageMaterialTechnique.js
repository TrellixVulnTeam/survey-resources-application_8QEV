/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../chunks/tslib.es6.js";import{ReloadableShaderModule as t}from"../core/shaderTechnique/ReloadableShaderModule.js";import{ShaderTechnique as r}from"../core/shaderTechnique/ShaderTechnique.js";import{ShaderTechniqueConfiguration as i,parameter as s}from"../core/shaderTechnique/ShaderTechniqueConfiguration.js";import{Default3D as a}from"../lib/DefaultVertexAttributeLocations.js";import o from"../../../webgl/Program.js";import{makePipelineState as n,defaultDepthWriteParams as l,defaultColorWriteParams as p,simpleBlendingParams as c}from"../../../webgl/renderState.js";import{View as u}from"../core/shaderLibrary/util/View.glsl.js";import{Slice as d}from"../core/shaderLibrary/Slice.glsl.js";import{OITBlending as h,OITDepthTest as m,OITDepthWrite as f,getOITPolygonOffset as b}from"../lib/OrderIndependentTransparency.js";import{bindMultipassTerrainUniforms as g}from"../core/shaderLibrary/shading/MultipassTerrainTest.glsl.js";import{stencilWriteMaskOn as y,stencilToolMaskBaseParams as P,stencilBaseAllZerosParams as T}from"../lib/StencilUtils.js";import{I as v}from"../../../../chunks/ImageMaterial.glsl.js";class j extends r{initializeProgram(e){const t=j.shader.get(),r=this.configuration,i=t.build({output:r.output,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,OITEnabled:0===r.transparencyPassType,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new o(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),a)}bindPass(e,t,r){u.bindProjectionMatrix(this.program,r.camera.projectionMatrix),this.program.setUniform1f("opacity",t.opacity),r.multipassTerrainEnabled&&(this.program.setUniform2fv("cameraNearFar",r.camera.nearFar),this.program.setUniform2fv("inverseViewport",r.inverseViewport),g(this.program,e,r))}bindDraw(e){u.bindView(this.program,e),d.bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e,t){const r=this.configuration,i=3===e,s=2===e,a=e=>0!==e&&{face:1===e?1028:1029,mode:2305};return n({blending:0!==r.output&&7!==r.output||!r.transparent?null:i?S:h(e),culling:a(r.cullFace),depthTest:{func:m(e)},depthWrite:i?r.writeDepth&&l:f(e),colorWrite:p,stencilWrite:r.sceneHasOcludees?y:null,stencilTest:r.sceneHasOcludees?t?P:T:null,polygonOffset:i||s?null:b(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}j.shader=new t(v,(()=>import("./ImageMaterial.glsl.js")));const S=c(1,771);class w extends i{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.sceneHasOcludees=!1,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!0}}e([s({count:8})],w.prototype,"output",void 0),e([s({count:3})],w.prototype,"cullFace",void 0),e([s()],w.prototype,"slicePlaneEnabled",void 0),e([s()],w.prototype,"transparent",void 0),e([s()],w.prototype,"enableOffset",void 0),e([s()],w.prototype,"writeDepth",void 0),e([s()],w.prototype,"sceneHasOcludees",void 0),e([s({count:4})],w.prototype,"transparencyPassType",void 0),e([s()],w.prototype,"multipassTerrainEnabled",void 0),e([s()],w.prototype,"cullAboveGround",void 0);export{j as ImageMaterialTechnique,w as ImageMaterialTechniqueConfiguration};
