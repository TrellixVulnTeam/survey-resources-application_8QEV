/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../chunks/tslib.es6.js";import{ReloadableShaderModule as t}from"../core/shaderTechnique/ReloadableShaderModule.js";import{ShaderTechnique as r}from"../core/shaderTechnique/ShaderTechnique.js";import{ShaderTechniqueConfiguration as i,parameter as o}from"../core/shaderTechnique/ShaderTechniqueConfiguration.js";import s from"../../../webgl/Program.js";import{makePipelineState as a,defaultDepthWriteParams as n,defaultColorWriteParams as l}from"../../../webgl/renderState.js";import{View as p}from"../core/shaderLibrary/util/View.glsl.js";import{Slice as c}from"../core/shaderLibrary/Slice.glsl.js";import{OutputHighlight as d}from"../core/shaderLibrary/output/OutputHighlight.glsl.js";import{blendingDefault as u,OITBlending as h,OITDepthTest as m,OITDepthWrite as g,getOITPolygonOffset as f}from"../lib/OrderIndependentTransparency.js";import{bindMultipassTerrainUniforms as b}from"../core/shaderLibrary/shading/MultipassTerrainTest.glsl.js";import{stencilWriteMaskOn as y,stencilToolMaskBaseParams as v,stencilBaseAllZerosParams as P}from"../lib/StencilUtils.js";import{P as T}from"../../../../chunks/Pattern.glsl.js";class S extends r{initializeProgram(e){const t=S.shader.get(),r=this.configuration,i=t.build({output:r.output,attributeColor:r.vertexColors,slicePlaneEnabled:r.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,style:r.style,patternSpacing:r.patternSpacing,lineWidth:r.lineWidth,draped:r.draped,OITEnabled:0===r.transparencyPassType,multipassTerrainEnabled:r.multipassTerrainEnabled,cullAboveGround:r.cullAboveGround});return new s(e.rctx,i.generateSource("vertex"),i.generateSource("fragment"),w)}bindPass(e,t,r){p.bindProjectionMatrix(this.program,r.camera.projectionMatrix),this.program.setUniform4fv("matColor",t.color),this.configuration.draped?(this.program.setUniform1f("worldToScreenRatio",1/r.screenToWorldRatioGlobalWM),this.program.setUniform1f("texelSize",1/r.camera.pixelRatio)):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/r.camera.perScreenPixelRatio),4===this.configuration.output&&d.bindOutputHighlight(e,this.program,r),(1===this.configuration.output||r.multipassTerrainEnabled)&&this.program.setUniform2fv("cameraNearFar",r.camera.nearFar),r.multipassTerrainEnabled&&(this.program.setUniform2fv("inverseViewport",r.inverseViewport),b(this.program,e,r))}bindDraw(e){p.bindView(this.program,e),p.bindCamPosition(this.program,e.origin,e.camera.viewInverseTransposeMatrix),c.bindUniformsWithOrigin(this.program,this.configuration,e)}setPipelineState(e,t){const r=this.configuration,i=3===e,o=2===e,s=e=>0!==e&&{face:1===e?1028:1029,mode:2305};return a({blending:0===r.output||7===r.output?r.transparent&&i?u:h(e):null,culling:s(r.cullFace),depthTest:{func:m(e)},depthWrite:i?r.writeDepth&&n:g(e),colorWrite:l,stencilWrite:r.sceneHasOcludees?y:null,stencilTest:r.sceneHasOcludees?t?v:P:null,polygonOffset:i||o?r.polygonOffset&&j:f(r.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0),this.setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(e){return e?this._occludeePipelineState:this.pipeline}}S.shader=new t(T,(()=>import("./Pattern.glsl.js")));const j={factor:1,units:1};class O extends i{constructor(){super(...arguments),this.output=0,this.cullFace=0,this.slicePlaneEnabled=!1,this.vertexColors=!1,this.transparent=!0,this.polygonOffset=!1,this.writeDepth=!0,this.sceneHasOcludees=!1,this.enableOffset=!0,this.transparencyPassType=3,this.multipassTerrainEnabled=!1,this.cullAboveGround=!0}}e([o({count:8})],O.prototype,"output",void 0),e([o({count:3})],O.prototype,"cullFace",void 0),e([o()],O.prototype,"slicePlaneEnabled",void 0),e([o()],O.prototype,"vertexColors",void 0),e([o()],O.prototype,"transparent",void 0),e([o()],O.prototype,"polygonOffset",void 0),e([o()],O.prototype,"writeDepth",void 0),e([o()],O.prototype,"sceneHasOcludees",void 0),e([o({count:6})],O.prototype,"style",void 0),e([o()],O.prototype,"patternSpacing",void 0),e([o()],O.prototype,"lineWidth",void 0),e([o()],O.prototype,"enableOffset",void 0),e([o()],O.prototype,"draped",void 0),e([o({count:4})],O.prototype,"transparencyPassType",void 0),e([o()],O.prototype,"multipassTerrainEnabled",void 0),e([o()],O.prototype,"cullAboveGround",void 0);const w={position:0,color:3,uvMapSpace:4,boundingRect:5};export{S as PatternTechnique,O as PatternTechniqueConfiguration,w as patternVertexAttributeLocations};
