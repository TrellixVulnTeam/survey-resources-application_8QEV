/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{isSome as e}from"../../core/maybe.js";import{createResolver as i}from"../../core/promiseUtils.js";import{debug as r}from"../../core/scheduling.js";import{dispatch as n}from"../../core/accessorSupport/watch.js";import{whenNotOnce as o}from"../../core/watchUtils.js";function t(e){switch(e.type){case"2d":return a(e);case"3d":if(e)return n(),r.dispatch(),o(e,"updating")}return Promise.resolve()}function a(o){const t=i();let a=performance.now();const s=function(){var i,t,a,s,l,u,c;if(n(),r.dispatch(),!o.ready||o.updating||!o.stationary||o.rendering||!0===(null==(i=o.layerViewManager)?void 0:i.updating)||!0===(null==(t=o.labelManager)?void 0:t.updating)||!0===(null==(a=o.graphicsView)?void 0:a.updating)||!0===(null==(s=o.magnifier)?void 0:s.visible)&&e(null==(l=o.magnifier)?void 0:l.position)&&(null==(u=o._magnifierView)||!u.mask||null==(c=o._magnifierView)||!c.overlay)||o.allLayerViews.some((e=>!0===e.updating)))return!0;return!!o.allLayerViews.find((function(e){const i=!e.isFulfilled(),r=e.updating&&!e.suspended;return i||r}))};function l(){if(!o.destroyed&&s())a=null,setTimeout(l,16);else{a||(a=performance.now());performance.now()-a>=100?t():setTimeout(l,16)}}return setTimeout(l,16),t.promise}export default t;
