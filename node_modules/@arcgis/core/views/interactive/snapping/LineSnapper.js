/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{unwrap as e}from"../../../core/maybe.js";import{a as t}from"../../../chunks/vec2f64.js";import{anyMapPointToScreenPoint as o,squareDistance as r}from"./snappingUtils.js";import{SnappingAlgorithm as s}from"./SnappingAlgorithm.js";import{projectPointToLine as i}from"../../support/geometry2dUtils.js";import{LineSnappingCandidate as n}from"./candidates/LineSnappingCandidate.js";class d extends s{snapNewVertex(e,t){const r=t.geometry.editGeometry.components[0],s=r.edges.length,i=[];if(s<1)return i;const n=t.coordinateHelper,d=o(e,n,t.elevationInfo,this.view),p=r.edges[s-1];let h=p;do{this.edgeExceedsShortLineThreshold(h,t)&&this._processCandidateProposal(h.left.pos,h.right.pos,e,d,t,i),h=h.left.left}while(h&&h!==p);return i}snapExistingVertex(t,r){const s=[],i=e(r.vertexHandle),n=i.component;if(n.edges.length<2)return s;const d=r.coordinateHelper,p=o(t,d,r.elevationInfo,this.view),h=i.left,a=i.right;h&&a&&this.edgeExceedsShortLineThreshold(h,r)&&this.edgeExceedsShortLineThreshold(a,r)&&this._processCandidateProposal(h.left.pos,a.right.pos,t,p,r,s);const l=n.edges[0];let c=l;do{c!==i.left&&c!==i.right&&this.edgeExceedsShortLineThreshold(c,r)&&this._processCandidateProposal(c.left.pos,c.right.pos,t,p,r,s),c=c.right.right}while(c&&c!==l);return s}_processCandidateProposal(e,s,d,p,h,a){const l=i(t(),d,e,s),c=h.coordinateHelper,g=c.fromXYZ(l,c.getZ(d,0));r(p,o(g,c,h.elevationInfo,this.view))<this.squaredProximityTreshold(h.pointer)&&a.push(new n({coordinateHelper:h.coordinateHelper,lineStart:e,lineEnd:s,targetPoint:g}))}}export{d as LineSnapper};
