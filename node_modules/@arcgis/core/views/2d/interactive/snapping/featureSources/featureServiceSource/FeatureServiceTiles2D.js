/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../../../../../../chunks/tslib.es6.js";import"../../../../../../core/has.js";import{isSome as t,isNone as r}from"../../../../../../core/maybe.js";import"../../../../../../core/Logger.js";import"../../../../../../core/accessorSupport/ensureType.js";import{property as i}from"../../../../../../core/accessorSupport/decorators/property.js";import{subclass as o}from"../../../../../../core/accessorSupport/decorators/subclass.js";import"../../../../../../core/urlUtils.js";import"../../../../../../core/uuid.js";import"../../../../../../portal/support/resourceExtension.js";import s from"../../../../../../core/Accessor.js";import{HandleOwnerMixin as l}from"../../../../../../core/HandleOwner.js";import{scaleBoundsPredicate as n}from"../../../../../support/layerViewUtils.js";import{distanceToTile as p}from"../../../../../interactive/snapping/featureSources/featureServiceSource/tileUtils.js";let a=class extends(l(s)){constructor(e){super(e),this.pointOfInterest=null}get tiles(){const e=this.tilesCoveringView,r=t(this.pointOfInterest)?this.pointOfInterest:this.view.center;return e.sort(((e,t)=>p(r,e)-p(r,t))),e}scaleEnabled(){return n(this.view.scale,this.layer.minScale||0,this.layer.maxScale||0)}get tilesCoveringView(){if(!this.view.ready||!this.view.featuresTilingScheme||!this.view.state||r(this.tileInfo))return[];if(!this.scaleEnabled)return[];const{spans:e,lodInfo:t}=this.view.featuresTilingScheme.getTileCoverage(this.view.state,0),{level:i}=t,o=[];for(const{row:r,colFrom:s,colTo:l}of e)for(let e=s;e<=l;e++){const s={id:null,level:i,row:r,col:t.normalizeCol(e)};this.tileInfo.updateTileInfo(s),o.push(s)}return o}get tileInfo(){var e,t;return null!=(e=null==(t=this.view.featuresTilingScheme)?void 0:t.tileInfo)?e:null}get tileSize(){return t(this.tileInfo)?this.tileInfo.size[0]:256}initialize(){this.handles.add(this.watch("view.state.viewpoint",(()=>this.notifyChange("tilesCoveringView")),!0))}};e([i({readOnly:!0})],a.prototype,"tiles",null),e([i({readOnly:!0})],a.prototype,"scaleEnabled",null),e([i({readOnly:!0})],a.prototype,"tilesCoveringView",null),e([i({readOnly:!0})],a.prototype,"tileInfo",null),e([i({readOnly:!0})],a.prototype,"tileSize",null),e([i({constructOnly:!0})],a.prototype,"view",void 0),e([i({constructOnly:!0})],a.prototype,"layer",void 0),e([i()],a.prototype,"pointOfInterest",void 0),a=e([o("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles2D")],a);export{a as FeatureServiceTiles2D};
