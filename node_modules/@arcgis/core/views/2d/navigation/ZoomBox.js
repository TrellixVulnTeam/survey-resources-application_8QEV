/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as t}from"../../../chunks/tslib.es6.js";import"../../../core/has.js";import"../../../core/Logger.js";import"../../../core/accessorSupport/ensureType.js";import{property as e}from"../../../core/accessorSupport/decorators/property.js";import{subclass as r}from"../../../core/accessorSupport/decorators/subclass.js";import"../../../core/urlUtils.js";import"../../../core/uuid.js";import"../../../portal/support/resourceExtension.js";import o from"../../../core/Accessor.js";import{createScreenPoint as i}from"../../../core/screenUtils.js";const s={container:"esri-zoom-box__container",overlay:"esri-zoom-box__overlay",background:"esri-zoom-box__overlay-background",box:"esri-zoom-box__outline"},a={zoom:"Shift",counter:"Ctrl"};let n=class extends o{constructor(t){super(t),this._container=null,this._overlay=null,this._backgroundShape=null,this._boxShape=null,this._box={x:0,y:0,width:0,height:0},this._redraw=this._redraw.bind(this)}destroy(){this.view=null}set view(t){this._handles&&this._handles.forEach((t=>{t.remove()})),this._handles=null,this._destroyOverlay(),this._set("view",t),t&&(t.on("drag",[a.zoom],(t=>this._handleDrag(t,1))),t.on("drag",[a.zoom,a.counter],(t=>this._handleDrag(t,-1))))}_start(){this._createContainer(),this._createOverlay(),this.navigation.begin()}_update(t,e,r,o){this._box.x=t,this._box.y=e,this._box.width=r,this._box.height=o,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))}_end(t,e,r,o,s){const a=this.view,n=a.toMap(i(t+.5*r,e+.5*o));let h=Math.max(r/a.width,o/a.height);-1===s&&(h=1/h),this._destroyOverlay(),this.navigation.end(),a.goTo({center:n,scale:a.scale*h})}_updateBox(t,e,r,o){const i=this._boxShape;i.setAttributeNS(null,"x",""+t),i.setAttributeNS(null,"y",""+e),i.setAttributeNS(null,"width",""+r),i.setAttributeNS(null,"height",""+o),i.setAttributeNS(null,"class",s.box)}_updateBackground(t,e,r,o){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(t,e,r,o,this.view.width,this.view.height))}_createContainer(){const t=document.createElement("div");t.className=s.container,this.view.root.appendChild(t),this._container=t}_createOverlay(){const t=this.view.width,e=this.view.height,r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttributeNS(null,"d","M 0 0 L "+t+" 0 L "+t+" "+e+" L 0 "+e+" Z"),r.setAttributeNS(null,"class",s.background);const o=document.createElementNS("http://www.w3.org/2000/svg","rect"),i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),i.setAttributeNS(null,"class",s.overlay),i.appendChild(r),i.appendChild(o),this._container.appendChild(i),this._backgroundShape=r,this._boxShape=o,this._overlay=i}_destroyOverlay(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null}_toSVGPath(t,e,r,o,i,s){const a=t+r,n=e+o;return"M 0 0 L "+i+" 0 L "+i+" "+s+" L 0 "+s+" ZM "+t+" "+e+" L "+t+" "+n+" L "+a+" "+n+" L "+a+" "+e+" Z"}_handleDrag(t,e){const r=t.x,o=t.y,i=t.origin.x,s=t.origin.y;let a,n,h,l;switch(r>i?(a=i,h=r-i):(a=r,h=i-r),o>s?(n=s,l=o-s):(n=o,l=s-o),t.action){case"start":this._start();break;case"update":this._update(a,n,h,l);break;case"end":this._end(a,n,h,l,e)}t.stopPropagation()}_redraw(){if(!this._rafId)return;if(this._rafId=null,!this._overlay)return;const{x:t,y:e,width:r,height:o}=this._box;this._updateBox(t,e,r,o),this._updateBackground(t,e,r,o),this._rafId=requestAnimationFrame(this._redraw)}};t([e()],n.prototype,"navigation",void 0),t([e()],n.prototype,"view",null),n=t([r("esri.views.2d.navigation.ZoomBox")],n);var h=n;export default h;
