/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import e from"../../core/Error.js";import t from"../../popup/FieldInfo.js";import n from"../../popup/ExpressionInfo.js";import i from"../../PopupTemplate.js";import{fetchMessageBundle as o}from"../../intl/messages.js";import{getArcadeForOrderedFields as s,getArcadeForPredominantCategoryAlias as r}from"../statistics/support/predominanceUtils.js";import{getContentFromFieldInfos as a,getFieldAndExpressionInfos as f,expressionFieldPrefix as d}from"./support/utils.js";async function p(t){const{layer:n,renderer:i}=t;await n.load();const o=i||n.renderer;if("dot-density"!==o.type)throw new e("dot-density-popup:invalid-parameters","renderer.type must be 'dot-density'");return{layer:n,renderer:o}}async function l(e,t){const{fieldInfos:n,expressionInfos:o}=await f({renderer:e,layer:t});return new i({content:await a(t,{fieldInfos:n,expressionInfos:o}),expressionInfos:o,fieldInfos:n})}async function m(e,o,r){const{fieldInfos:a,expressionInfos:p}=await f({renderer:e,layer:o}),l=a.filter((e=>-1===e.fieldName.indexOf(d))),m={fieldInfo:new t({fieldName:"expression/dot-density-categories-list"}),expressionInfo:new n({name:"dot-density-categories-list",title:r.listOfCategories,expression:s(l,p)})},y=new i({expressionInfos:[m.expressionInfo],fieldInfos:[m.fieldInfo],title:r.competingFields,content:`{${m.fieldInfo.fieldName}}`});return{name:"dot-density-categories-list",title:r.orderedListOfValues,value:y}}async function y(e,o,s){const{fieldInfos:a,expressionInfos:p}=await f({renderer:e,layer:o}),l=a.filter((e=>-1===e.fieldName.indexOf(d))),m={fieldInfo:new t({fieldName:"expression/dot-density-category"}),expressionInfo:new n({name:"dot-density-category",title:s.predominantCategory,expression:r(l,p)})},y=new i({expressionInfos:[m.expressionInfo,...p],fieldInfos:[m.fieldInfo,...a],content:[{type:"text",text:`<div><b><font size="3">{${m.fieldInfo.fieldName}}</font></b></div>`},{type:"media",mediaInfos:{type:"pie-chart",title:s.competingFields,value:{fields:a.map((e=>e.fieldName))}}}]});return{name:"dot-density-category-chart",title:s.predominantCategoryWithChart,value:y}}async function c(e){const[{renderer:t,layer:n},i]=await Promise.all([p(e),o("esri/smartMapping/t9n/smartMapping")]);return{primaryTemplate:{name:"dot-density",title:i.dotDensity,value:await l(t,n)},secondaryTemplates:[await m(t,n,i),await y(t,n,i)]}}export{c as getTemplates};
