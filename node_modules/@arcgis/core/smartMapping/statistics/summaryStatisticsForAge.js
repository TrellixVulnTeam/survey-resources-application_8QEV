/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{isSome as e}from"../../core/maybe.js";import a from"../../core/Error.js";import{createLayerAdapter as r,getLayerTypeLabels as t}from"../support/adapters/support/layerUtils.js";import i from"./summaryStatistics.js";import{getAgeExpressions as s,verifyDates as n,supportedAgeUnits as m}from"./support/ageUtils.js";async function o(i){if(!(i&&i.layer&&i.startTime&&i.endTime&&i.unit))throw new a("summary-statistics-for-age:missing-parameters","'layer', 'startTime', 'endTime' and 'unit' parameters are required");const s=[0,2,1,3],{layer:o,...l}=i,u=r(o,s),p={layerAdapter:u,...l};if(!u)throw new a("summary-statistics-for-age:invalid-parameters","'layer' must be one of these types: "+t(s).join(", "));const y=p.view,f=e(p.signal)?{signal:p.signal}:null;await Promise.all([y&&y.when(),u.load(f)]);const d=n(u,p.startTime,p.endTime,"summary-statistics-for-age:invalid-parameters");if(d)throw d;if(-1===m.indexOf(p.unit))throw new a("summary-statistics-for-age:invalid-parameters",`Supported units are: ${m.join(", ")}`);return p}async function l(e){const{layerAdapter:a,...r}=await o(e),{view:t,startTime:n,endTime:m,unit:l,minValue:u,maxValue:p,signal:y}=r,{valueExpression:f,statisticsQuery:d}=s({layer:a,startTime:n,endTime:m,unit:l}),c={layer:a,valueExpression:f,...d,minValue:u,maxValue:p,view:t,signal:y};return i(c)}export default l;
