/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import r from"../request.js";import{normalizeCentralMeridian as e}from"../geometry/support/normalizeUtils.js";import{parseUrl as t}from"./utils.js";import{createQueryParamsHelper as i}from"../core/queryUtils.js";import{collectGeometries as s,isInputGeometryZAware as a,fetchServiceDescription as o,dropZValuesOffInputGeometry as n}from"./networkUtils.js";import u from"../tasks/support/ServiceAreaSolveResult.js";const l=i({accumulateAttributes:{name:"accumulateAttributeNames"},attributeParameterValues:!0,defaultBreaks:!0,facilities:!0,outSpatialReference:{name:"outSR",getter:r=>r.outSpatialReference.wkid},pointBarriers:{name:"barriers"},polylineBarriers:!0,polygonBarriers:!0,restrictionAttributes:{name:"restrictionAttributeNames"},returnPointBarriers:{name:"returnBarriers"},travelMode:!0});async function f(i,f,c){const p=[],m=[],B={},y={},h=t(i);return f.facilities&&f.facilities.features&&s(f.facilities.features,m,"facilities.features",B),f.pointBarriers&&f.pointBarriers.features&&s(f.pointBarriers.features,m,"pointBarriers.features",B),f.polylineBarriers&&f.polylineBarriers.features&&s(f.polylineBarriers.features,m,"polylineBarriers.features",B),f.polygonBarriers&&f.polygonBarriers.features&&s(f.polygonBarriers.features,m,"polygonBarriers.features",B),e(m).then((r=>{for(const e in B){const t=B[e];p.push(e),y[e]=r.slice(t[0],t[1])}return a(y,p)?o(h.path).catch((()=>({dontCheck:!0}))):Promise.resolve({dontCheck:!0})})).then((e=>{("dontCheck"in e?e.dontCheck:e.hasZ)||n(y,p);for(const r in y)y[r].forEach(((e,t)=>{f.get(r)[t].geometry=e}));let t={query:{...h.query,f:"json",...l.toQueryParams(f)}};return c&&(t={...c,...t}),r(`${h.path}/solveServiceArea`,t)})).then((r=>u.fromJSON(r.data)))}export{f as solve};
