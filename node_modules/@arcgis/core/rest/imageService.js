/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{isSome as t}from"../core/maybe.js";import s from"../request.js";import{normalizeCentralMeridian as o}from"../geometry/support/normalizeUtils.js";import{parseUrl as n,encode as r,asValidOptions as e}from"./utils.js";import a from"../tasks/support/ImageIdentifyResult.js";function i(t){const s=null==t?void 0:t.time;if(s&&(null!=s.start||null!=s.end)){const o=[];null!=s.start&&o.push(s.start),null!=s.end&&-1===o.indexOf(s.end)&&o.push(s.end),t.time=o.join(",")}}async function m(s,a,m){const u=n(s),c=a.geometry?[a.geometry]:[],f=await o(c),g=a.toJSON();i(g);const l=f&&f[0];t(l)&&(g.geometry=l.toJSON());const p=r({...u.query,f:"json",...g});return e(p,m)}async function u(t,o,r){const e=await m(t,o,r),a=n(t),{data:i}=await s(`${a.path}/computeStatisticsHistograms`,e),{statistics:u}=i;return null!=u&&u.length&&u.forEach((t=>{t.avg=t.mean,t.stddev=t.standardDeviation})),{statistics:u,histograms:i.histograms}}async function c(t,o,r){const e=await m(t,o,r),a=n(t),{data:i}=await s(`${a.path}/computeHistograms`,e);return{histograms:i.histograms}}async function f(i,m,u){const c=n(i),f=m.geometry?[m.geometry]:[];return o(f).then((o=>{const n=m.toJSON(),a=o&&o[0];t(a)&&(n.geometry=JSON.stringify(a.toJSON()));const i=r({...c.query,f:"json",...n}),f=e(i,u);return s(c.path+"/identify",f)})).then((t=>a.fromJSON(t.data)))}export{c as computeHistograms,u as computeStatisticsHistograms,f as identify};
