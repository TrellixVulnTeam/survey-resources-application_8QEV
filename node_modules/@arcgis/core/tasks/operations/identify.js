/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{isSome as e}from"../../core/maybe.js";import{getJsonType as t}from"../../geometry/support/jsonUtils.js";import{getScale as r}from"../../geometry/support/scaleUtils.js";import{serializeLayerDefinitions as i,getLayersForScale as n}from"../../layers/support/layerUtils.js";const s=e=>e.spatialReference.wkid||JSON.stringify(e.spatialReference);function o(o,a){const{dpi:l,dynamicLayers:m,geometry:f,geometryPrecision:y,height:p,layerDefinitions:c,layerIds:d,layerOption:u,layerTimeOptions:g,mapExtent:x,maxAllowableOffset:O,returnFieldName:h,returnGeometry:N,returnUnformattedValues:R,returnZ:$,spatialReference:j,timeExtent:w,tolerance:E,width:J}=o.toJSON(),S=a&&e(a.geometry)?a.geometry:null,U={geometryPrecision:y,maxAllowableOffset:O,returnFieldName:h,returnGeometry:N,returnUnformattedValues:R,returnZ:$,tolerance:E},b=S&&S.toJSON()||f;if(U.imageDisplay=`${J},${p},${l}`,b&&(delete b.spatialReference,U.geometry=JSON.stringify(b),U.geometryType=t(b)),j?U.sr=j.wkid||JSON.stringify(j):b&&b.spatialReference?U.sr=s(b):x&&x.spatialReference&&(U.sr=s(x)),U.time=w?w.join(","):null,x){const{xmin:e,ymin:t,xmax:r,ymax:i}=x;U.mapExtent=`${e},${t},${r},${i}`}if(U.layers=u,d&&(U.layers+=`:${d.join(",")}`),c){const e=[];for(let t=0;t<c.length;t++){const r=c[t];e[r.id]=r.definitionExpression}U.layerDefs=i(e)}if(m&&m.length){const e=[],t={extent:x,width:J,spatialReference:x.spatialReference},i=r(t),s=n(i,m);for(let r=0;r<m.length;r++){const t=m[r],i=t.id;if(!t.subLayerIds&&d&&-1!==d.indexOf(i)&&-1!==s.indexOf(i)){const r={id:i};r.source=t.source;let n,s=null;if(c&&c.length){const e=c.filter((e=>e.id===i))[0];s=e&&e.definitionExpression}s&&(r.definitionExpression=s),g&&g[i]&&(n=g[i]),n&&(r.layerTimeOptions=n),e.push(r)}}let o=JSON.stringify(e);"[]"===o&&(o="[{}]"),U.dynamicLayers=o}return U}export{o as identifyToIdentifyRESTParameters};
