/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import t from"../../../core/Logger.js";import{Z as e,c as r}from"../../../chunks/vec3f64.js";import{g as s,t as o,i as n}from"../../../chunks/vec3.js";import{getSphericalPCPF as i}from"../../projectionEllipsoid.js";import{i as a,r as c}from"../../../chunks/mat4.js";import{projectPointToVector as f,computeLinearTransformation as m}from"../../projection.js";import{a as p}from"../../../chunks/mat3f64.js";import{a as u}from"../../../chunks/mat4f64.js";import{a as l}from"../../../chunks/quatf64.js";import{a as g}from"../../../chunks/vec4f64.js";import{f as h}from"../../../chunks/mat3.js";import{projectToECEF as j,projectNormalToECEF as x,projectTangentToECEF as k,projectFromECEF as v,projectNormalFromECEF as A,projectTangentFromECEF as b}from"./projection.js";import{s as d,m as w,g as y}from"../../../chunks/quat.js";const R=t.getLogger("esri.geometry.support.meshUtils.rotate");function F(t,e,r){if(!t.vertexAttributes||!t.vertexAttributes.position||0===e[3])return;const s=t.spatialReference,o=s.isWGS84||s.isWebMercator&&(!r||!1!==r.geographic),n=r&&r.origin||t.extent.center;o?L(t,e,n):U(t,e,n)}function q(t,e,r){return s(r,t),r[3]=e,r}function C(t,e,r){return d(E,t,t[3]),d(G,e,e[3]),w(E,G,E),r[3]=y(r,E),r}function L(t,e,r){const s=t.spatialReference,n=i(s),a=Z;f(r,a,n)||f(t.extent.center,a,n);const c=t.vertexAttributes.position,p=t.vertexAttributes.normal,u=t.vertexAttributes.tangent,l=new Float64Array(c.length),g=new Float32Array(p?p.length:0),d=new Float32Array(u?u.length:0);m(n,a,M,n),h(S,M);const w=z;o(z,e,S),w[3]=e[3],j(c,s,l),p&&x(p,c,l,s,g),u&&k(u,c,l,s,d),W(l,w,3,a),v(l,c,s),p&&(W(g,w,3),A(g,c,l,s,p)),u&&(W(d,w,4),b(d,c,l,s,u)),t.vertexAttributesChanged()}function U(t,e,r){const s=Z;if(!f(r,s,t.spatialReference)){const e=t.extent.center;s[0]=e.x,s[1]=e.y,s[2]=e.z,R.error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${t.spatialReference.wkid}). Using mesh extent.center instead`)}W(t.vertexAttributes.position,e,3,s),W(t.vertexAttributes.normal,e,3),W(t.vertexAttributes.tangent,e,4),t.vertexAttributesChanged()}function W(t,r,s,o=e){if(t){a(M),c(M,M,r[3],r);for(let e=0;e<t.length;e+=s){for(let r=0;r<3;r++)$[r]=t[e+r]-o[r];n($,$,M);for(let r=0;r<3;r++)t[e+r]=$[r]+o[r]}}}const $=r(),z=g(),E=l(),G=l(),M=u(),S=p(),Z=r();export{q as axisAngleFrom,C as axisAngleMultiply,F as rotate};
