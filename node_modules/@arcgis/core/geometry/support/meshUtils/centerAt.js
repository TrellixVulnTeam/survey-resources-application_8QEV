/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import e from"../../../core/Logger.js";import{c as t}from"../../../chunks/vec3f64.js";import{getSphericalPCPF as r}from"../../projectionEllipsoid.js";import{a as i,m as o,b as n}from"../../../chunks/mat4.js";import{projectPointToVector as s,computeLinearTransformation as a}from"../../projection.js";import{a as c}from"../../../chunks/mat4f64.js";import{projectToECEF as p,projectNormalToECEF as f,transformBufferInPlace as l,projectFromECEF as m,projectNormalFromECEF as d}from"./projection.js";const u=e.getLogger("esri.geometry.support.meshUtils.centerAt");function g(e,t,r){if(!e.vertexAttributes||!e.vertexAttributes.position)return;const i=e.spatialReference,o=i.isWGS84||i.isWebMercator&&(!r||!1!==r.geographic),n=r&&r.origin||e.extent.center;o?h(e,t,n):j(e,t,n)}function h(e,t,c){const g=e.spatialReference,h=r(g),j=w,k=x;if(!s(t,k,h))return void u.error(`Failed to project centerAt location (wkid:${t.spatialReference.wkid}) to ECEF`);s(c,j,h)||s(e.extent.center,j,h);const v=e.vertexAttributes.position,R=e.vertexAttributes.normal,F=new Float64Array(v.length),$=new Float32Array(R?R.length:0);p(v,g,F),R&&f(R,v,F,g,$),a(h,j,A,h),a(h,k,b,h),i(A,A),o(b,b,A),l(F,b),i(b,b),n(b,b),R&&l($,b,!0),m(F,v,g),R&&d($,v,F,g,R),e.vertexAttributesChanged()}function j(e,t,r){const i=w,o=x;if(s(t,o,e.spatialReference)){if(!s(r,i,e.spatialReference)){const t=e.extent.center;i[0]=t.x,i[1]=t.y,i[2]=t.z,u.error(`Failed to project specified origin (wkid:${r.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}). Using mesh extent.center instead`)}k(e.vertexAttributes.position,o,i),e.vertexAttributesChanged()}else u.error(`Failed to project centerAt location (wkid:${t.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid})`)}function k(e,t,r){if(e)for(let i=0;i<e.length;i+=3)for(let o=0;o<3;o++)e[i+o]+=t[o]-r[o]}const x=t(),w=t(),A=c(),b=c();export{g as centerAt};
