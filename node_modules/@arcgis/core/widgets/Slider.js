/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../core/has.js";import{isSome as t}from"../core/maybe.js";import i from"../core/Logger.js";import{property as n}from"../core/accessorSupport/decorators/property.js";import{aliasOf as s}from"../core/accessorSupport/decorators/aliasOf.js";import{cast as o}from"../core/accessorSupport/decorators/cast.js";import{deprecatedProperty as r}from"../core/deprecate.js";import{subclass as a}from"../core/accessorSupport/decorators/subclass.js";import"../core/urlUtils.js";import"../core/uuid.js";import"../portal/support/resourceExtension.js";import{eventKey as l}from"../core/events.js";import{substitute as h}from"../intl/substitute.js";import"../intl.js";import{storeNode as d}from"./support/widgetUtils.js";import{messageBundle as u}from"./support/decorators/messageBundle.js";import{j as c}from"../chunks/index.js";import m from"./Widget.js";import _ from"./Slider/SliderViewModel.js";const p={base:"esri-slider",reversed:"esri-slider--reversed",horizontalLayout:"esri-slider--horizontal",verticalLayout:"esri-slider--vertical",contentElement:"esri-slider__content",extraContentElement:"esri-slider__extra-content",trackElement:"esri-slider__track",ticksContainerElement:"esri-slider__ticks",tickElement:"esri-slider__tick",tickLabelElement:"esri-slider__tick-label",maxElement:"esri-slider__max",minElement:"esri-slider__min",maxElementInteractive:"esri-slider__max--interactive",minElementInteractive:"esri-slider__min--interactive",rangeInput:"esri-slider__range-input",anchorElement:"esri-slider__anchor",movingAnchorElement:"esri-slider__anchor--moving",lastMovedAnchorElement:"esri-slider__anchor--moved",anchorElementIndexPrefix:"esri-slider__anchor-",segmentElement:"esri-slider__segment",segmentElementIndexPrefix:"esri-slider__segment-",segmentElementInteractive:"esri-slider__segment--interactive",thumbElement:"esri-slider__thumb",labelElement:"esri-slider__label",labelElementInteractive:"esri-slider__label--interactive",labelInput:"esri-slider__label-input",esriWidget:"esri-widget",widgetIcon:"esri-icon-edit",disabled:"esri-disabled",hidden:"esri-hidden"},v={showInput:"Enter",hideInput1:"Enter",hideInput2:"Escape",hideInput3:"Tab",moveAnchorUp:"ArrowUp",moveAnchorDown:"ArrowDown",moveAnchorLeft:"ArrowLeft",moveAnchorRight:"ArrowRight",moveAnchorToMax:"End",moveAnchorToMin:"Home"},g="esri.widgets.Slider",b=i.getLogger("esri.widgets.Slider"),f={labels:!1,rangeLabels:!1};let x=class extends m{constructor(e,t){super(e,t),this._activeLabelInputIndex=null,this._anchorElements=[],this._baseNode=null,this._dragged=!1,this._dragStartInfo=null,this._focusedAnchorIndex=null,this._isMinInputActive=!1,this._isMaxInputActive=!1,this._labelElements=[],this._lastMovedHandleIndex=null,this._observer=null,this._positionPrecision=5,this._segmentDragStartInfo=null,this._segmentElements=[],this._thumbElements=[],this._tickElements=[],this._trackHeight=null,this._trackWidth=null,this._zIndices=null,this._zIndexOffset=3,this.disabled=!1,this.extraNodes=[],this.draggableSegmentsEnabled=!0,this.inputCreatedFunction=null,this.inputFormatFunction=null,this.inputParseFunction=null,this.label=void 0,this.labelInputsEnabled=!1,this.labelFormatFunction=null,this.labels=null,this.max=null,this.messages=null,this.min=null,this.precision=4,this.rangeLabelInputsEnabled=!1,this.snapOnClickEnabled=!0,this.steps=null,this.thumbsConstrained=!0,this.thumbCreatedFunction=null,this.tickConfigs=null,this.trackElement=null,this.values=null,this.viewModel=new _,this.visibleElements={...f},this._observer=new ResizeObserver((()=>this.scheduleRender())),this._onAnchorPointerDown=this._onAnchorPointerDown.bind(this),this._onAnchorPointerMove=this._onAnchorPointerMove.bind(this),this._onAnchorPointerUp=this._onAnchorPointerUp.bind(this),this._onLabelPointerDown=this._onLabelPointerDown.bind(this),this._onLabelPointerUp=this._onLabelPointerUp.bind(this),this._onSegmentPointerDown=this._onSegmentPointerDown.bind(this),this._onSegmentPointerMove=this._onSegmentPointerMove.bind(this),this._onSegmentPointerUp=this._onSegmentPointerUp.bind(this),this._onTrackPointerDown=this._onTrackPointerDown.bind(this)}destroy(){document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove),document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove)}set labelsVisible(e){r(b,"labelsVisible",{replacement:"visibleElements.labels",version:"4.15"}),this.visibleElements={...this.visibleElements,labels:e}}set layout(e){-1===["vertical","vertical-reversed","horizontal","horizontal-reversed"].indexOf(e)&&(e="horizontal"),this._set("layout",e)}set rangeLabelsVisible(e){r(b,"rangeLabelsVisible",{replacement:"visibleElements.rangeLabels",version:"4.15"}),this.visibleElements={...this.visibleElements,rangeLabels:e}}get state(){const{_activeLabelInputIndex:e,_isMaxInputActive:i,_isMinInputActive:n,_dragStartInfo:s,_segmentDragStartInfo:o,viewModel:r}=this,a=t(s)||t(o);return!(null===e&&!i&&!n)?"editing":a?"dragging":r.state}castVisibleElements(e){return{...f,...e}}render(){const{label:e}=this,t=this.classes(p.base,p.esriWidget,this._isHorizontalLayout()?p.horizontalLayout:p.verticalLayout,this._isReversedLayout()?p.reversed:null,this._isDisabled()?p.disabled:null);return this._storeTrackDimensions(),c("div",{afterCreate:this._afterBaseNodeCreate,bind:this,"aria-label":e,class:t,"touch-action":"none"},this.renderContent())}toNextStep(e){this._toStep(e,1)}toPreviousStep(e){this._toStep(e,-1)}renderContent(){const{max:e,min:i}=this;if(t(i)&&t(e)&&!(i>e))return[this.renderMin(),this.renderSliderContainer(),this.renderMax()]}renderSliderContainer(){return c("div",{key:"slider-container",bind:this,class:p.contentElement},this.renderTrackElement(),this.renderTicksContainer(),this.renderExtraContentElements())}renderTrackElement(){return c("div",{afterCreate:this._afterTrackCreate,bind:this,class:p.trackElement,"data-node-ref":"trackElement","touch-action":"none"},this.renderSegmentElements(),this.renderAnchorElements())}renderSegmentElements(){if(!this.trackElement||!this.values||!this.values.length)return;const e=this.values.length+1,t=[];for(let i=0;i<e;i++)t.push(this.renderSegmentElement(i));return t}renderSegmentElement(e){const{_trackHeight:i,_trackWidth:n,draggableSegmentsEnabled:s,id:o,state:r,values:a}=this,l=this._isHorizontalLayout(),h=l?n:i,d=e===a.length?null:e,u=0===e?null:e-1,m=t(d),_=t(u);let v,g;const b=[...a].sort(((e,t)=>e-t));this._isReversedLayout()?(v=_?this._positionFromValue(b[u]):l?h:0,g=m?this._positionFromValue(b[d]):l?0:h):(v=m?this._positionFromValue(b[d]):l?h:0,g=_?this._positionFromValue(b[u]):l?0:h);const f=this._applyPrecisionToPosition(100*g/h),x=(v-g)/h,E=l?`transform: translate(${f}%, 0px) scale(${x}, 1);`:`transform: translate(0px, ${f}%) scale(1, ${x});`,I=this.classes(p.segmentElement,p.segmentElementIndexPrefix+e,s&&m&&_&&"disabled"!==r?p.segmentElementInteractive:null);return c("div",{afterCreate:this._afterSegmentCreate,afterRemoved:this._afterSegmentRemoved,bind:this,class:I,"data-max-thumb-index":d,"data-min-thumb-index":u,"data-segment-index":e,key:`${o}-segment-${e}`,style:E,"touch-action":"none"})}renderAnchorElements(){const{trackElement:e,values:t}=this;if(t&&t.length)return this._zIndices=t.map(((e,i)=>{const n=this._positionFromValue(e),s=this._positionToPercent(n),o=(this._isHorizontalLayout()?s>50:s<50)?-1:1;return this._zIndexOffset+(t.length+o*i)})),e&&t&&t.length?t.map(((e,t)=>this.renderAnchorElement(e,t))):null}renderAnchorElement(e,i){const n=this._positionFromValue(e),s=this._valueFromPosition(n);if(!t(s)||isNaN(s))return;const{_dragStartInfo:o,_lastMovedHandleIndex:r,id:a,layout:l,values:d,visibleElements:{labels:u}}=this,m=o&&o.index===i,_=r===i,v=this.classes(p.anchorElement,p.anchorElementIndexPrefix+i,m?p.movingAnchorElement:null,_?p.lastMovedAnchorElement:null),g=this.labels.values[i],b=this._getStyleForAnchor(e,i,m||_),{min:f,max:x}=this.viewModel.getBoundsForValueAtIndex(i),{messages:E}=this,I=2===d.length?h(0===i?E.rangeMinimum:E.rangeMaximum,{value:e}):g,P=1===d.length?null:0===i?`${a}-handle-${i+1}`:i===d.length-1?`${a}-handle-${i-1}`:`${a}-handle-${i-1} ${a}-handle-${i+1}`;return c("div",{afterCreate:this._afterAnchorCreate,afterUpdate:this._afterAnchorUpdate,afterRemoved:this._afterAnchorRemoved,"aria-controls":P,"aria-label":E.sliderValue,"aria-labelledby":u?`${a}-label-${i}`:null,"aria-orientation":l,"aria-valuemax":x.toString(),"aria-valuemin":f.toString(),"aria-valuenow":e.toString(),"aria-valuetext":I,bind:this,class:v,"data-thumb-index":i,"data-value":e,id:`${a}-handle-${i}`,key:`${a}-handle-${i}`,onkeydown:this._onAnchorKeyDown,"touch-action":"none",role:"slider",style:b,tabIndex:0},c("span",{afterCreate:this._afterThumbCreate,afterRemoved:this._afterThumbRemoved,bind:this,class:p.thumbElement,"data-thumb-index":i,"touch-action":"none"}),this.renderThumbLabel(i))}renderThumbLabel(e){const{id:t,labels:i,labelInputsEnabled:n,state:s}=this,o=this.visibleElements.labels,r=i.values[e],a=this.classes(p.labelElement,o?null:p.hidden,n&&"disabled"!==s?p.labelElementInteractive:null);return c("span",{afterCreate:this._afterLabelCreate,afterRemoved:this._afterLabelRemoved,"aria-hidden":(!o).toString(),bind:this,class:a,"data-thumb-index":e,key:`${t}-label-${e}`,id:`${t}-label-${e}`,role:n?"button":null,"touch-action":"none"},this._activeLabelInputIndex===e?this.renderValueInput(e):r)}renderValueInput(e){const t=this.values[e];return c("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.sliderValue,bind:this,class:p.labelInput,"data-input-type":"thumb","data-input-index":e,required:!0,tabIndex:0,type:"text",value:this._formatInputValue(t,"value",e),onblur:this._onLabelInputBlur,onkeydown:this._onInputKeyDown})}renderMax(){const{_isMaxInputActive:e,labels:t,rangeLabelInputsEnabled:i,state:n}=this,s=this.visibleElements.rangeLabels,o=this.classes(p.maxElement,s?null:p.hidden,i&&"disabled"!==n?p.maxElementInteractive:null);return c("div",{"aria-hidden":(!s).toString(),bind:this,class:o,onclick:this._onMaxLabelClick,onkeydown:this._onMaxLabelKeyDown,role:i?"button":null,tabIndex:i?0:null},e?this.renderMaxInput():t.max)}renderMin(){const{_isMinInputActive:e,labels:t,rangeLabelInputsEnabled:i,state:n}=this,s=this.visibleElements.rangeLabels,o=this.classes(p.minElement,s?null:p.hidden,i&&"disabled"!==n?p.minElementInteractive:null);return c("div",{"aria-hidden":(!s).toString(),bind:this,class:o,onclick:this._onMinLabelClick,onkeydown:this._onMinLabelKeyDown,role:i?"button":null,tabIndex:i?0:null},e?this.renderMinInput():t.min)}renderMaxInput(){return c("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.maximumValue,bind:this,class:p.rangeInput,"data-input-type":"max",required:!0,tabIndex:0,type:"text",value:this._formatInputValue(this.max,"max"),onblur:this._onMaxInputBlur,onkeydown:this._onInputKeyDown})}renderMinInput(){return c("input",{afterCreate:this._afterInputCreate,"aria-label":this.messages.minimumValue,bind:this,class:p.rangeInput,"data-input-type":"min",required:!0,tabIndex:0,type:"text",value:this._formatInputValue(this.min,"min"),onblur:this._onMinInputBlur,onkeydown:this._onInputKeyDown})}renderExtraContentElements(){return c("div",{bind:this,class:p.extraContentElement},this.extraNodes)}renderTicksContainer(){if(this.tickConfigs&&this.trackElement&&(0!==this._trackHeight||0!==this._trackWidth))return this.tickConfigs.map(((e,t)=>c("div",{key:"ticks-container",class:this.classes(p.ticksContainerElement)},this.renderTicks(e,t))))}renderTicks(e,t){const{mode:i,values:n}=e;if(this._tickElements[t]=[],"position"===i){const i=Array.isArray(n)?n:[n];return this._calculateTickPositions(i).map(((i,n)=>this.renderTickGroup(e,n,t,i)))}if("percent"===i&&Array.isArray(n)){const{max:i,min:s}=this,o=i-s,r=n.map((e=>this._applyPrecisionToPosition(e/100*o+s)));return this._calculateTickPositions(r).map(((i,n)=>this.renderTickGroup(e,n,t,i)))}const s=Array.isArray(n)&&n.length?n[0]:isNaN(n)?null:n,o=this._getTickCounts(s,e);return this._calculateEquidistantTickPositions(o).map(((i,n)=>this.renderTickGroup(e,n,t,i)))}renderTickGroup(e,i,n,s){const o="position"===e.mode?Array.isArray(e.values)?e.values[i]:e.values:this._valueFromPosition(s);if(t(o)&&!isNaN(o))return c("div",{afterCreate:this._afterTickGroupCreate,bind:this,"data-config":e,"data-position":s,"data-tick-config-index":n,"data-tick-group-index":i,"data-value":o,key:`tick-group-${i}`},this.renderTickLine(e,i,n,o),e.labelsVisible?this.renderTickLabel(e,i,n,o):null)}renderTickLine(e,t,i,n){return c("div",{afterCreate:this._afterTickLineCreate,"aria-valuenow":n.toString(),bind:this,class:p.tickElement,"data-tick-config-index":i,"data-tick-group-index":t,"data-value":n,key:`tick-label-${t}`,style:this._getPositionStyleForElement(n)})}renderTickLabel(e,t,i,n){const s=e.labelFormatFunction?e.labelFormatFunction(n,"tick",t):this.viewModel.getLabelForValue(n,"tick",t);return c("div",{afterCreate:this._afterTickLabelCreate,"aria-label":s,"aria-valuenow":n.toString(),"aria-valuetext":s,bind:this,class:p.tickLabelElement,"data-tick-config-index":i,"data-tick-group-index":t,"data-value":n,key:`tick-label-${t}`,style:`transform: translate(-50%); ${this._getPositionStyleForElement(n)}`},s)}_afterBaseNodeCreate(e){this._baseNode&&this._observer.unobserve(this._baseNode),this._baseNode=e,this._observer.observe(this._baseNode)}_afterTrackCreate(e){d.call(this,e),e.addEventListener("pointerdown",this._onTrackPointerDown),this.scheduleRender()}_afterSegmentCreate(e){this._segmentElements.push(e),e.addEventListener("pointerdown",this._onSegmentPointerDown)}_afterSegmentRemoved(e){const t=this._segmentElements.indexOf(e,0);t>-1&&this._segmentElements.splice(t,1),e.removeEventListener("pointerdown",this._onSegmentPointerDown)}_afterAnchorCreate(e){if(this._anchorElements.push(e),e.addEventListener("pointerdown",this._onAnchorPointerDown),this.thumbCreatedFunction){const t=e["data-thumb-index"],i=e["data-value"],n=this._thumbElements[t]||null,s=this._labelElements[t]||null;this.thumbCreatedFunction(t,i,n,s)}}_afterAnchorUpdate(e){if(t(this._focusedAnchorIndex)){e["data-thumb-index"]===this._focusedAnchorIndex&&(e.focus(),this._focusedAnchorIndex=null)}}_afterAnchorRemoved(e){const t=this._anchorElements.indexOf(e,0);t>-1&&this._anchorElements.splice(t,1),e.removeEventListener("pointerdown",this._onAnchorPointerDown)}_afterThumbCreate(e){this._thumbElements.push(e)}_afterThumbRemoved(e){const t=this._thumbElements.indexOf(e,0);t>-1&&this._thumbElements.splice(t,1)}_afterLabelCreate(e){this._labelElements.push(e),e.addEventListener("pointerdown",this._onLabelPointerDown),e.addEventListener("pointerup",this._onLabelPointerUp)}_afterLabelRemoved(e){const t=this._labelElements.indexOf(e,0);t>-1&&this._labelElements.splice(t,1),e.removeEventListener("pointerdown",this._onLabelPointerDown),e.removeEventListener("pointerup",this._onLabelPointerUp)}_afterInputCreate(e){if(e.focus(),e.select(),this.inputCreatedFunction){const t=e.getAttribute("data-input-type"),i="thumb"===t?e["data-input-index"]:null;this.inputCreatedFunction(e,t,i)}}_afterTickLineCreate(e){const t=e["data-tick-config-index"],i=e["data-tick-group-index"],n=this._tickElements[t];n[i]?n[i].line=e:n[i]={line:e,label:null}}_afterTickLabelCreate(e){const t=e["data-tick-config-index"],i=e["data-tick-group-index"],n=this._tickElements[t];n[i]?n[i].label=e:n[i]={label:e,line:null}}_afterTickGroupCreate(e){const t=e["data-config"];if(t&&t.tickCreatedFunction){const i=e["data-tick-config-index"],n=e["data-tick-group-index"],s=e["data-value"],o=this._tickElements[i][n];if(o){const e=o.line||null,i=o.label||null;t.tickCreatedFunction(s,e,i)}}}_onAnchorKeyDown(e){if(this._isDisabled()||"editing"===this.state)return;const{target:i}=e,n=l(e),{_anchorElements:s,values:o}=this,r=i["data-thumb-index"],a=s[r],h=o[r],d=this._isHorizontalLayout(),u=[v.moveAnchorUp,v.moveAnchorDown,v.moveAnchorLeft,v.moveAnchorRight];if(n===v.showInput&&this.labelInputsEnabled)this._activeLabelInputIndex=r,this.notifyChange("state");else if(u.indexOf(n)>-1){e.preventDefault();const{steps:i}=this,s=n===v.moveAnchorUp||n===v.moveAnchorRight?1:-1;if(t(i))this._toStep(r,this._isReversedLayout()?-1*s:s);else{const{precision:e}=this,t=this._getPositionOfElement(a),i=this._valueFromPosition(t),n=this._isHorizontalLayout()?s:-1*s;let o;o=0===e?this._positionFromValue(i+n):1===e?this._positionFromValue(i+.1*n):t+n,this._toPosition(r,o)}const o=this.values[r];h!==o&&this._emitThumbChangeEvent({index:r,oldValue:h,value:o})}else if(n===v.moveAnchorToMax||n===v.moveAnchorToMin){e.preventDefault();const{min:t,max:i}=this._getAnchorBoundsInPixels(r),s=d?n===v.moveAnchorToMax?i:t:n===v.moveAnchorToMin?i:t;this._toPosition(r,s);const o=this.values[r];h!==o&&this._emitThumbChangeEvent({index:r,oldValue:h,value:o})}}_onAnchorPointerDown(e){if(this._isDisabled())return;const{target:t,clientX:i,clientY:n}=e,s=t["data-thumb-index"];void 0!==s&&(e.preventDefault(),this._anchorElements[s]&&this._anchorElements[s].focus(),this._storeTrackDimensions(),this._dragStartInfo={clientX:i,clientY:n,index:s,position:this._getPositionOfElement(this._anchorElements[s])},this.notifyChange("state"),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))}_onAnchorPointerMove(e){if("editing"===this.state||!this._dragStartInfo)return;e.preventDefault();const{values:t,_anchorElements:i,_dragged:n,_dragStartInfo:s,_dragStartInfo:{index:o,position:r}}=this,{clientX:a,clientY:l}=e,h=n?"drag":"start",d=i[o],u=this._getPositionOfElement(d),c=this._applyPrecisionToPosition(this._isHorizontalLayout()?r+a-s.clientX:r+l-s.clientY);if(u===c)return;const m=t[o];this._dragged=!0,this._toPosition(o,c);const _=this.values[o];n?m!==_&&this._emitThumbDragEvent({index:o,state:h,value:_}):this._emitThumbDragEvent({index:o,state:h,value:m})}_onAnchorPointerUp(e){if(document.removeEventListener("pointerup",this._onAnchorPointerUp),document.removeEventListener("pointermove",this._onAnchorPointerMove),!this._dragStartInfo)return;e.preventDefault();const{index:t}=this._dragStartInfo,i=this._dragged;this._dragged=!1,this._dragStartInfo=null,this._lastMovedHandleIndex=t,i?(this.notifyChange("state"),this._emitThumbDragEvent({index:t,state:"stop",value:this.values[t]})):this.scheduleRender()}_onTrackPointerDown(e){const{_dragStartInfo:i,snapOnClickEnabled:n,state:s,values:o}=this;if(this._isDisabled()||"editing"===s||i||!n||!o.length)return;const{steps:r}=this,{clientX:a,clientY:l}=e,h=this._getCursorPositionFromEvent(e),d=this._valueFromPosition(h),u=this._getIndexOfNearestValue(d);if(!t(u))return;const c=o[u],m=t(r)?this._calculateNearestStepPosition(h):h;this._toPosition(u,m),this._dragged=!0,this._dragStartInfo={clientX:a,clientY:l,index:u,position:m},this._focusedAnchorIndex=u,this.notifyChange("state"),this._emitThumbDragEvent({index:u,state:"start",value:c});const _=this.values[u];c!==_&&this._emitThumbDragEvent({index:u,state:"drag",value:_}),document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove)}_onSegmentPointerDown(e){e.preventDefault();const{draggableSegmentsEnabled:i}=this,n=e.target,s=n["data-segment-index"],o=n["data-min-thumb-index"],r=n["data-max-thumb-index"];!this._isDisabled()&&i&&t(o)&&t(r)&&(e.stopPropagation(),this._storeTrackDimensions(),this._segmentDragStartInfo={cursorPosition:this._getCursorPositionFromEvent(e),index:s,details:this._normalizeSegmentDetails({min:this._getAnchorDetails(o),max:this._getAnchorDetails(r)})},this.notifyChange("state"),this._emitSegmentDragEvent({index:s,state:"start",thumbIndices:[o,r]}),document.addEventListener("pointerup",this._onSegmentPointerUp),document.addEventListener("pointermove",this._onSegmentPointerMove))}_onSegmentPointerMove(e){if(!this._segmentDragStartInfo)return;e.preventDefault();const{_trackHeight:t,_trackWidth:i,_segmentDragStartInfo:{index:n,cursorPosition:s,details:{min:o,max:r}}}=this,{index:a,position:l,value:h}=o,{index:d,position:u,value:c}=r;this._dragged=!0;const m=this._getCursorPositionFromEvent(e);if(m===s)return;const _=this._positionToPercent(s),p=this._positionToPercent(m)-_,v=this._positionToPercent(l)+p,g=this._positionToPercent(u)+p,{min:b}=this._getAnchorBoundsAsPercents(a),{max:f}=this._getAnchorBoundsAsPercents(d);let x=!1,E=!1;if(v<b?x=!0:g>f&&(E=!0),x){const{min:e,max:t}=this.viewModel.getBoundsForValueAtIndex(a),i=this._isPositionInverted()?t:e,n=i,s=c+(i-h);return void this._updateAnchorValues([a,d],[n,s])}if(E){const{min:e,max:t}=this.viewModel.getBoundsForValueAtIndex(d),i=this._isPositionInverted()?e:t,n=i,s=h+(i-c);return void this._updateAnchorValues([a,d],[s,n])}const I=this._isHorizontalLayout()?i:t,P=g/100*I,y=v/100*I,k=this.values,A=[k[a],k[d]],L=this._getValueForAnchorAtPosition(a,y),S=this._getValueForAnchorAtPosition(d,P);this._updateAnchorValues([a,d],[L,S]);[this.values[a],this.values[d]].every(((e,t)=>e===A[t]))||this._emitSegmentDragEvent({index:n,state:"drag",thumbIndices:[a,d]})}_onSegmentPointerUp(e){if(e.preventDefault(),document.removeEventListener("pointerup",this._onSegmentPointerUp),document.removeEventListener("pointermove",this._onSegmentPointerMove),!this._segmentDragStartInfo)return;const{max:t,min:i,values:n}=this,{index:s,details:{min:{index:o},max:{index:r}}}=this._segmentDragStartInfo,a=t-i,l=n[o],h=n[r];this._lastMovedHandleIndex=l===h?l>a/2?o:r:null,this._dragged=!1,this._segmentDragStartInfo=null,this.notifyChange("state"),this._emitSegmentDragEvent({index:s,state:"stop",thumbIndices:[o,r]})}_storeTrackDimensions(){if(this.trackElement){const e=this._getDimensions(this.trackElement);this._trackHeight=e.height,this._trackWidth=e.width}}_onLabelPointerDown(){this._isDisabled()||(this._dragged=!1,document.addEventListener("pointerup",this._onAnchorPointerUp),document.addEventListener("pointermove",this._onAnchorPointerMove))}_onLabelPointerMove(){this._isDisabled()||(this._dragged=!0)}_onLabelPointerUp(e){if(this._isDisabled())return;const i=e.target["data-thumb-index"];this.labelInputsEnabled&&!this._dragged&&t(i)&&(this._activeLabelInputIndex=i),this._dragged=!1,this.notifyChange("state"),document.removeEventListener("pointerup",this._onLabelPointerUp),document.removeEventListener("pointermove",this._onLabelPointerMove)}_onLabelInputBlur(e){const{_activeLabelInputIndex:t,values:i,viewModel:n}=this,s=e.target.value;if(this._activeLabelInputIndex=null,this.notifyChange("state"),!s)return;const o=this._parseInputValue(s,"value",t),r=i[t],{min:a,max:l}=this.viewModel.getBoundsForValueAtIndex(t);if(o<a||o>l)return;n.setValue(t,o);const h=this.values[t];r!==h&&this._emitThumbChangeEvent({index:t,oldValue:r,value:h})}_onInputKeyDown(e){if(this._isDisabled())return;const{target:i}=e,n=l(e),{hideInput1:s,hideInput2:o,hideInput3:r}=v,{_activeLabelInputIndex:a,_anchorElements:h}=this,d=i;if(n===s||n===o||n===r){e.stopPropagation();const i=a;d.blur(),t(i)?h[i].focus():d.parentElement.focus()}}_onMaxLabelClick(){!this._isDisabled()&&this.rangeLabelInputsEnabled&&(this._isMaxInputActive=!0,this.notifyChange("state"))}_onMaxLabelKeyDown(e){this._isDisabled()||l(e)!==v.showInput||(this._isMaxInputActive=!0,this.notifyChange("state"))}_onMaxInputBlur(e){const t=e.target.value;if(this._isMaxInputActive=!1,this.notifyChange("state"),!t)return;const i=this.max,n=this._parseInputValue(t,"max");n<=this.min||(this.viewModel.set("max",n),this.max!==i&&this._emitMaxChangeEvent({oldValue:i,value:this.max}))}_onMinLabelClick(){!this._isDisabled()&&this.rangeLabelInputsEnabled&&(this._isMinInputActive=!0,this.notifyChange("state"))}_onMinLabelKeyDown(e){this._isDisabled()||l(e)!==v.showInput||(this._isMinInputActive=!0,this.notifyChange("state"))}_onMinInputBlur(){const e=event.target.value;if(this._isMinInputActive=!1,this.notifyChange("state"),!e)return;const t=this.min,i=this._parseInputValue(e,"min");i>=this.max||(this.viewModel.set("min",i),this.min!==t&&this._emitMinChangeEvent({oldValue:t,value:this.min}))}_isDisabled(){return this.disabled||"disabled"===this.state}_positionFromValue(e){const{max:t,min:i}=this,n=t-i;if(0===n)return 0;const{_trackHeight:s,_trackWidth:o}=this,r=this._isHorizontalLayout();let a=r?parseFloat((o*(e-i)/n).toFixed(2)):parseFloat((s*(t-e)/n).toFixed(2));return this._isReversedLayout()&&(a=r?o-a:s-a),a}_valueFromPosition(e){const{_trackHeight:t,_trackWidth:i,max:n,min:s,precision:o}=this,r=n-s;let a=this._isHorizontalLayout()?e*r/i+s:r*(1e3-e/t*1e3)/1e3+s;return this._isReversedLayout()&&(a=n+s-a),parseFloat(a.toFixed(o))}_positionToPercent(e){const{_trackHeight:t,_trackWidth:i}=this,n=100*e/(this._isHorizontalLayout()?i:t);return this._applyPrecisionToPosition(n)}_applyPrecisionToPosition(e){return parseFloat(e.toFixed(this._positionPrecision))}_isPositionInverted(){const{layout:e}=this;return"horizontal-reversed"===e||"vertical"===e}_isHorizontalLayout(){return this.layout.indexOf("horizontal")>-1}_isReversedLayout(){return this.layout.indexOf("reversed")>-1}_normalizeSegmentDetails(e){if(this._isPositionInverted()){const{min:t,max:i}=e;return{min:i,max:t}}return e}_parseInputValue(e,t,i){return this.inputParseFunction?this.inputParseFunction(e,t,i):this.viewModel.defaultInputParseFunction(e)}_formatInputValue(e,t,i){return this.inputFormatFunction?this.inputFormatFunction(e,t,i):this.viewModel.defaultInputFormatFunction(e)}_getAnchorDetails(e){return{index:e,position:this._getPositionOfElement(this._anchorElements[e]),value:this.values[e]}}_updateAnchorStyle(e,t){const i=this._anchorElements[e];i&&(this._isHorizontalLayout()?i.style.left=`${t}`:i.style.top=`${t}`)}_getStyleForAnchor(e,t,i){const n=this._getPositionStyleForElement(e);if(1===this.values.length)return`${n}`;const s=this._zIndices[t];return`${n}; z-index: ${i?this._zIndexOffset+s:s}`}_getPositionStyleForElement(e){const t=this._positionFromValue(e),i=this._positionToPercent(t);return`${this._isHorizontalLayout()?"left":"top"}: ${i+"%"}`}_getPositionOfElement(e){const t=this._getDimensions(e.offsetParent),i=this._getDimensions(e);return this._isHorizontalLayout()?this._applyPrecisionToPosition(i.left-t.left):this._applyPrecisionToPosition(i.top-t.top)}_updateAnchorValues(e,t){e.forEach(((e,i)=>this._toValue(e,t[i])))}_toValue(e,i){if(t(this.steps)){i=this._getStepValues()[this._getIndexOfNearestStepValue(i)]}this._updateAnchorStyle(e,this._getPositionStyleForElement(i)),this.viewModel.setValue(e,i)}_toPosition(e,i){const n=t(this.steps)?this._getStepValueForAnchorAtPosition(e,i):this._getValueForAnchorAtPosition(e,i);this._updateAnchorStyle(e,this._getPositionStyleForElement(n)),this.viewModel.setValue(e,n)}_getValueForAnchorAtPosition(e,t){const{min:i,max:n}=this._getAnchorBoundsInPixels(e),{min:s,max:o}=this.viewModel.getBoundsForValueAtIndex(e);let r,a,l=null;return this._isPositionInverted()?(r=s,a=o):(r=o,a=s),l=t>n?r:t<i?a:this._valueFromPosition(t),l>o?l=o:l<s&&(l=s),l}_getStepValueForAnchorAtPosition(e,t){const i=this._getStepValues(),n=this._calculateNearestStepPosition(t),s=this._getValueForAnchorAtPosition(e,n);return i[this._getIndexOfNearestStepValue(s)]}_getAnchorBoundsAsPercents(e){const{min:t,max:i}=this._getAnchorBoundsInPixels(e);return{min:this._positionToPercent(t),max:this._positionToPercent(i)}}_getAnchorBoundsInPixels(e){const{_anchorElements:t,_trackHeight:i,_trackWidth:n,thumbsConstrained:s}=this,o=t[e-1],r=t[e+1],a=this._isHorizontalLayout()?n:i;return s?this._isPositionInverted()?{max:o?this._getPositionOfElement(o):a,min:r?this._getPositionOfElement(r):0}:{max:r?this._getPositionOfElement(r):a,min:o?this._getPositionOfElement(o):0}:{max:a,min:0}}_getIndexOfNearestValue(e){return this.values.indexOf(this.values.reduce(((t,i)=>Math.abs(i-e)<Math.abs(t-e)?i:t)))}_getCursorPositionFromEvent(e){const t=this._getDimensions(this.trackElement);return this._isHorizontalLayout()?e.clientX-t.left:e.clientY-t.top}_getStepValues(){const{steps:e}=this;if(Array.isArray(e))return e;const{max:t,min:i}=this,n=Math.ceil((t-i)/e),s=[];for(let o=0;o<=n;o++){const n=i+e*o;s.push(n>t?t:n)}return s}_toStep(e,t){const{values:i,viewModel:n}=this,s=i[e],o=this._getStepValues(),r=o.indexOf(s);let a=null;if(r>-1){const i=o[r+t],n=this._positionFromValue(i);a=this._getStepValueForAnchorAtPosition(e,n)}else{a=o[this._getIndexOfNearestStepValue(s)+t]}n.setValue(e,a)}_getIndexOfNearestStepValue(e){const{steps:i}=this;if(!t(i))return null;const n=this._getStepValues(),s=n.reduce(((t,i)=>Math.abs(i-e)<Math.abs(t-e)?i:t));return n.indexOf(s)}_calculateNearestStepPosition(e){const t=this._valueFromPosition(e),i=this._getIndexOfNearestStepValue(t),n=this._getStepValues();return this._positionFromValue(n[i])}_getTickCounts(e,t){const{mode:i}=t;return"count"===i||"position"===i?e||0:"percent"===i&&100/e||0}_calculateTickPositions(e){return e.map((e=>this._positionFromValue(e)))}_calculateEquidistantTickPositions(e){const{_trackWidth:t,_trackHeight:i}=this,n=this._isHorizontalLayout()?t:i,s=n/(e-1),o=[];if(1===e)return[n/2];for(let r=0;r<e;r++){const e=r*s;e<=n&&o.push(e)}return o}_getDimensions(e){try{return e.getBoundingClientRect()}catch(t){if("object"==typeof t&&null!==t)return{top:0,bottom:0,left:0,width:0,height:0,right:0};throw t}}_emitMaxChangeEvent(e){this.emit("max-change",{...e,type:"max-change"})}_emitMinChangeEvent(e){this.emit("min-change",{...e,type:"min-change"})}_emitThumbChangeEvent(e){this.emit("thumb-change",{...e,type:"thumb-change"})}_emitThumbDragEvent(e){this.emit("thumb-drag",{...e,type:"thumb-drag"})}_emitSegmentDragEvent(e){this.emit("segment-drag",{...e,type:"segment-drag"})}};e([n()],x.prototype,"disabled",void 0),e([n()],x.prototype,"extraNodes",void 0),e([n()],x.prototype,"draggableSegmentsEnabled",void 0),e([n()],x.prototype,"inputCreatedFunction",void 0),e([s("viewModel.inputFormatFunction")],x.prototype,"inputFormatFunction",void 0),e([s("viewModel.inputParseFunction")],x.prototype,"inputParseFunction",void 0),e([n({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],x.prototype,"label",void 0),e([n()],x.prototype,"labelInputsEnabled",void 0),e([s("viewModel.labelFormatFunction")],x.prototype,"labelFormatFunction",void 0),e([s("viewModel.labels")],x.prototype,"labels",void 0),e([n()],x.prototype,"labelsVisible",null),e([n({value:"horizontal"})],x.prototype,"layout",null),e([s("viewModel.max")],x.prototype,"max",void 0),e([n(),u("esri/widgets/Slider/t9n/Slider")],x.prototype,"messages",void 0),e([s("viewModel.min")],x.prototype,"min",void 0),e([s("viewModel.precision")],x.prototype,"precision",void 0),e([n()],x.prototype,"rangeLabelInputsEnabled",void 0),e([n()],x.prototype,"rangeLabelsVisible",null),e([n()],x.prototype,"snapOnClickEnabled",void 0),e([n({readOnly:!0})],x.prototype,"state",null),e([n()],x.prototype,"steps",void 0),e([s("viewModel.thumbsConstrained")],x.prototype,"thumbsConstrained",void 0),e([n()],x.prototype,"thumbCreatedFunction",void 0),e([n()],x.prototype,"tickConfigs",void 0),e([n()],x.prototype,"trackElement",void 0),e([s("viewModel.values")],x.prototype,"values",void 0),e([n()],x.prototype,"viewModel",void 0),e([n()],x.prototype,"visibleElements",void 0),e([o("visibleElements")],x.prototype,"castVisibleElements",null),x=e([a(g)],x);var E=x;export default E;
