/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../core/has.js";import{isSome as i}from"../core/maybe.js";import t from"../core/Logger.js";import{property as s}from"../core/accessorSupport/decorators/property.js";import{aliasOf as o}from"../core/accessorSupport/decorators/aliasOf.js";import{cast as a}from"../core/accessorSupport/decorators/cast.js";import{subclass as r}from"../core/accessorSupport/decorators/subclass.js";import"../core/urlUtils.js";import"../core/uuid.js";import"../portal/support/resourceExtension.js";import{init as l}from"../core/watchUtils.js";import"./support/widgetUtils.js";import{messageBundle as d}from"./support/decorators/messageBundle.js";import{j as n}from"../chunks/index.js";import c from"./Widget.js";import{formatSliderLabel as h,getGMTOffsets as p,ORDERED_SEASONS as m}from"./Daylight/daylightUtils.js";import g from"./Daylight/DaylightViewModel.js";import w from"./Daylight/support/SliderWithDropdown.js";import u from"./support/DatePicker.js";const v={base:"esri-daylight",widgetIcon:"esri-icon-environment-settings",button:"esri-button",checkbox:"esri-daylight__checkbox",checked:"esri-icon-checkbox-checked",dayContainer:"esri-daylight__container esri-daylight__day-container",dateContainer:"esri-daylight__container esri-daylight__date-container",header:"esri-widget__heading",interactive:"esri-interactive",label:" esri-widget__anchor",labelledTick:"esri-daylight__container__labelled-tick",pause:"esri-icon-pause",play:"esri-icon-play",playPauseButton:"esri-daylight__play-pause-button",select:"esri-select",seasonPicker:"esri-daylight__season-picker",shadow:"esri-daylight__shadow-container",shadowOff:"esri-slider--shadow-off",shadowOn:"esri-slider--shadow-on",tick:"esri-daylight__container__tick",unchecked:"esri-icon-checkbox-unchecked",widget:"esri-widget",sliderDateOn:"esri-slider--date-on",sliderDateOff:"esri-slider--date-off",panelError:"esri-daylight__panel--error"},y={playButtons:!0,shadowsToggle:!0,datePicker:!0,timezone:!0},b=t.getLogger("esri.widgets.Daylight"),_="date";let S=class extends c{constructor(e,i){var t;super(e,i),this.iconClass=v.widgetIcon,this.label=void 0,this.playSpeedMultiplier=1,this.timeSliderSteps=5,this.view=null,this.viewModel=new g,this.visibleElements={...y},this.dateOrSeason=_,this._timeSlider=new w({viewModel:this.viewModel.timeSliderViewModel,labelFormatFunction:h,inputFormatFunction:h,min:0,max:1439,steps:null!=(t=this.timeSliderSteps)?t:5,values:[0],labelInputsEnabled:!1,visibleElements:{labels:!0},tickConfigs:[{mode:"position",values:[0,360,720,1080,1439],labelsVisible:!0,tickCreatedFunction:this._onPrimaryTickCreated.bind(this)},{mode:"position",values:[120,240,480,600,840,960,1200,1320],tickCreatedFunction:this._onSecondaryTickCreated.bind(this)}],items:[]}),this._datePicker=new u({viewModel:this.viewModel.datePickerViewModel,commitOnMonthChange:!0})}get gmtOffsets(){return this.messages?p(this.messages):null}castVisibleElements(e){return{...y,...e}}postInitialize(){this.viewModel.isSupported&&this.own(l(this.viewModel,"datePickerViewModel",(e=>{this._datePicker.viewModel=e})),l(this.viewModel,"timeSliderViewModel",(e=>{this._timeSlider.viewModel=e})),l(this,"messages",(()=>{this._timeSlider.buttonTooltip=this.messages.chooseTimezone})),l(this,"visibleElements",(()=>{this._timeSlider.showDropDown=this.visibleElements.timezone})),l(this,"gmtOffsets",(e=>{i(e)&&(this._timeSlider.items=e)})),l(this,["viewModel.utcOffset","gmtOffsets"],(()=>this._onUTCOffsetChange())))}destroy(){this._datePicker.destroy(),this._timeSlider.destroy()}render(){return this.viewModel.isSupported?n("div",{class:this.classes(v.base,v.widget)},n("h3",{class:v.header},this.messages.title),this.renderTimeOptions(),this.visibleElements.datePicker?"date"===this.dateOrSeason?this.renderDateOptions():this.renderSeasonOptions():null,this.visibleElements.shadowsToggle?this.renderShadowOptions():null):n("div",{class:this.classes(v.base,v.widget)},n("div",{key:"daylight__unsupported",class:v.panelError},n("p",null,this.messages.unsupported)))}renderTimeOptions(){const e={[v.play]:!this.viewModel.dayPlaying,[v.pause]:this.viewModel.dayPlaying},i={[v.shadowOn]:this.viewModel.directShadowsEnabled,[v.shadowOff]:!this.viewModel.directShadowsEnabled},t={[v.sliderDateOn]:this.visibleElements.datePicker,[v.sliderDateOff]:!this.visibleElements.datePicker};return n("div",{class:this.classes(v.dayContainer,i,t),key:"daylight-time-options"},this._timeSlider.render(),this.visibleElements.playButtons?n("button",{bind:this.viewModel,onclick:this.viewModel.toggleDayPlaying,"aria-label":this.messages.playDay,title:this.messages.playDay,type:"button",class:this.classes(v.button,v.playPauseButton,e)},n("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},n("path",{d:"M6 3.745L11.255 8 6 12.255z"}))):null)}renderDateOptions(){const e={[v.play]:!this.viewModel.yearPlaying,[v.pause]:this.viewModel.yearPlaying};return n("div",{class:v.dateContainer,key:"daylight-date-options"},this._datePicker.render(),this.visibleElements.playButtons?n("button",{bind:this.viewModel,onclick:this.viewModel.toggleYearPlaying,"aria-label":this.messages.playYear,title:this.messages.playYear,type:"button",class:this.classes(v.button,v.playPauseButton,e)},n("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16"},n("path",{d:"M6 3.745L11.255 8 6 12.255z"}))):null)}renderShadowOptions(){const e=`${this.id}__shadowButton`,i={[v.checked]:this.viewModel.directShadowsEnabled,[v.unchecked]:!this.viewModel.directShadowsEnabled};return n("div",{class:v.shadow,key:"daylight-shadow-options"},n("button",{bind:this.viewModel,onclick:this.viewModel.toggleDirectShadows,name:e,class:this.classes(v.button,v.checkbox,i),"aria-label":this.messages.directShadow,title:this.messages.directShadow,type:"button"}),n("label",{bind:this.viewModel,onclick:this.viewModel.toggleDirectShadows,for:e,class:this.classes(v.label,v.interactive),"aria-label":this.messages.directShadow,title:this.messages.directShadow},this.messages.directShadow))}renderSeasonOptions(){return n("select",{bind:this,onchange:this._onSeasonChange,class:this.classes(v.select,v.seasonPicker),value:this.viewModel.currentSeason,"aria-label":this.messages.season},m.map((e=>n("option",{value:e},this.messages[e]))))}_onSeasonChange(e){const i=e.target;this.viewModel.currentSeason=i.value}_onUTCOffsetChange(){var e;const t=this.viewModel.utcOffset,s=null==(e=this._timeSlider.currentItem)?void 0:e.abbr,o=this.gmtOffsets;if(!i(o)||s===t)return;const a=o.findIndex((({abbr:e})=>e===t));a>-1&&(this._timeSlider.currentIndex=a)}_onPrimaryTickCreated(e,i,t){i.className+=" esri-interactive esri-widget__anchor "+v.tick+" "+v.labelledTick,t.className+=" esri-interactive esri-widget__anchor";const s=()=>{this.viewModel.timeSliderPosition=e};i.onclick=s,t.onclick=s;const o=t.innerText;-1!==o.indexOf(" ")&&(t.innerHTML=o.replace(/(.*) (.*)/,'$1<br><div class="esri-label__ampm">$2</div>'))}_onSecondaryTickCreated(e,i){i.className+=" esri-interactive esri-widget__anchor "+v.tick,i.onclick=()=>{this.viewModel.timeSliderPosition=e}}};e([s({readOnly:!0})],S.prototype,"gmtOffsets",null),e([s(),d("esri/widgets/Daylight/t9n/Daylight")],S.prototype,"messages",void 0),e([s()],S.prototype,"iconClass",void 0),e([s({aliasOf:{source:"messages.title",overridable:!0}})],S.prototype,"label",void 0),e([o("viewModel.playSpeedMultiplier")],S.prototype,"playSpeedMultiplier",void 0),e([o("_timeSlider.steps")],S.prototype,"timeSliderSteps",void 0),e([o("viewModel.view")],S.prototype,"view",void 0),e([s({type:g})],S.prototype,"viewModel",void 0),e([s()],S.prototype,"visibleElements",void 0),e([a("visibleElements")],S.prototype,"castVisibleElements",null),e([s({cast:e=>"season"===e||"date"===e?e:(b.warn(`"${e}" is not a valid option. Acceptable values are only "date" or "season". Defaulting to "${_}".`),_)})],S.prototype,"dateOrSeason",void 0),e([s()],S.prototype,"_timeSlider",void 0),e([s()],S.prototype,"_datePicker",void 0),S=e([r("esri.widgets.Daylight")],S);var f=S;export default f;
