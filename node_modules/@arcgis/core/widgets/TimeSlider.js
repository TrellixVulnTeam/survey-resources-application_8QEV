/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../core/has.js";import{neverReached as t}from"../core/compilerUtils.js";import"../core/Logger.js";import"../core/accessorSupport/ensureType.js";import{property as i}from"../core/accessorSupport/decorators/property.js";import{aliasOf as s}from"../core/accessorSupport/decorators/aliasOf.js";import{subclass as o}from"../core/accessorSupport/decorators/subclass.js";import r from"../core/Error.js";import"../core/urlUtils.js";import"../core/uuid.js";import"../portal/support/resourceExtension.js";import{equals as a}from"../core/arrayUtils.js";import{on as n}from"../core/events.js";import l from"../core/Collection.js";import{formatDate as m,convertDateFormatToIntlOptions as u}from"../intl/date.js";import{clamp as d}from"../core/mathUtils.js";import{truncateDate as c,offsetDate as v}from"../layers/support/timeUtils.js";import p from"../TimeInterval.js";import{init as h}from"../core/watchUtils.js";import{throttle as w}from"../core/throttle.js";import"./support/widgetUtils.js";import{accessibleHandler as f}from"./support/decorators/accessibleHandler.js";import{messageBundle as y}from"./support/decorators/messageBundle.js";import{j as b}from"../chunks/index.js";import _ from"./Widget.js";import g from"./Slider.js";import x from"./TimeSlider/TimeSliderViewModel.js";const j={widgetIcon:"esri-icon-time-clock",esriWidget:"esri-widget",esriWidgetButton:"esri-widget--button",esriButtonDisabled:"esri-button--disabled",esriDisabled:"esri-disabled",timeSlider:"esri-time-slider",timeSliderMode:"esri-time-slider__mode--",timeSliderLayout:"esri-time-slider__layout--",timeSliderRow:"esri-time-slider__row",animation:"esri-time-slider__animation",animationButton:"esri-time-slider__animation-button",animationPlay:"esri-icon-play",animationPause:"esri-icon-pause",timeExtent:"esri-time-slider__time-extent",timeExtentGroup:"esri-time-slider__time-extent-group",timeExtentDate:"esri-time-slider__time-extent-date",timeExtentTime:"esri-time-slider__time-extent-time",timeExtentSeparator:"esri-time-slider__time-extent-separator",min:"esri-time-slider__min",minDate:"esri-time-slider__min-date",slider:"esri-time-slider__slider",sliderMajorTick:"majorTick",sliderMinorTick:"minorTick",max:"esri-time-slider__max",maxDate:"esri-time-slider__max-date",previous:"esri-time-slider__previous",previousButton:"esri-time-slider__previous-button",previousIcon:"esri-icon-reverse",next:"esri-time-slider__next",nextButton:"esri-time-slider__next-button",nextIcon:"esri-icon-forward"},k=3,T=100,S=858,E=new l([{minor:new p({value:100,unit:"milliseconds"}),major:new p({value:1,unit:"seconds"}),format:{second:"numeric"}},{minor:new p({value:500,unit:"milliseconds"}),major:new p({value:5,unit:"seconds"}),format:{second:"numeric"}},{minor:new p({value:1,unit:"seconds"}),major:new p({value:20,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new p({value:2,unit:"seconds"}),major:new p({value:30,unit:"seconds"}),format:{minute:"numeric",second:"numeric"}},{minor:new p({value:10,unit:"seconds"}),major:new p({value:1,unit:"minutes"}),format:{minute:"numeric"}},{minor:new p({value:15,unit:"seconds"}),major:new p({value:5,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new p({value:1,unit:"minutes"}),major:new p({value:20,unit:"minutes"}),format:{hour:"numeric",minute:"numeric"}},{minor:new p({value:5,unit:"minutes"}),major:new p({value:2,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new p({value:15,unit:"minutes"}),major:new p({value:6,unit:"hours"}),format:{hour:"numeric",minute:"numeric"}},{minor:new p({value:1,unit:"hours"}),major:new p({value:1,unit:"days"}),format:{day:"numeric",month:"short"}},{minor:new p({value:6,unit:"hours"}),major:new p({value:1,unit:"weeks"}),format:{day:"numeric",month:"short"}},{minor:new p({value:1,unit:"days"}),major:new p({value:1,unit:"months"}),format:{month:"long"}},{minor:new p({value:2,unit:"days"}),major:new p({value:1,unit:"months"}),format:{month:"short"}},{minor:new p({value:3,unit:"days"}),major:new p({value:1,unit:"months"}),format:{month:"short"}},{minor:new p({value:4,unit:"days"}),major:new p({value:3,unit:"months"}),format:{month:"short",year:"numeric"}},{minor:new p({value:1,unit:"weeks"}),major:new p({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new p({value:1,unit:"months"}),major:new p({value:1,unit:"years"}),format:{year:"numeric"}},{minor:new p({value:2,unit:"months"}),major:new p({value:2,unit:"years"}),format:{year:"numeric"}},{minor:new p({value:1,unit:"years"}),major:new p({value:1,unit:"decades"}),format:{year:"numeric"}},{minor:new p({value:2,unit:"years"}),major:new p({value:5,unit:"decades"}),format:{year:"numeric"}},{minor:new p({value:5,unit:"decades"}),major:new p({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new p({value:1,unit:"centuries"}),major:new p({value:10,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new p({value:2,unit:"centuries"}),major:new p({value:20,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new p({value:5,unit:"centuries"}),major:new p({value:50,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new p({value:10,unit:"centuries"}),major:new p({value:100,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new p({value:20,unit:"centuries"}),major:new p({value:200,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new p({value:50,unit:"centuries"}),major:new p({value:500,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new p({value:100,unit:"centuries"}),major:new p({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new p({value:200,unit:"centuries"}),major:new p({value:1e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new p({value:500,unit:"centuries"}),major:new p({value:5e3,unit:"centuries"}),format:{era:"short",year:"numeric"}},{minor:new p({value:1e3,unit:"centuries"}),major:new p({value:1e4,unit:"centuries"}),format:{era:"short",year:"numeric"}}]);let M=class extends _{constructor(e,t){super(e,t),this._slider=new g({precision:0,visibleElements:{rangeLabels:!1},rangeLabelInputsEnabled:!1}),this._tickFormat=null,this.disabled=!1,this.effectiveStops=null,this.fullTimeExtent=null,this.iconClass=j.widgetIcon,this.label=void 0,this.labelFormatFunction=null,this.loop=!1,this.messages=null,this.messagesCommon=null,this.mode="time-window",this.playRate=1e3,this.stops={count:10},this.tickConfigs=null,this.timeExtent=null,this.timeVisible=!1,this.values=null,this.view=null,this.viewModel=new x}initialize(){this.own([this._slider.watch("values",(e=>{var t;const i=null==(t=this.values)?void 0:t.map((e=>e.getTime()));a(e,i)||this.set("values",e.map((e=>new Date(e))))})),n(window,"resize",w((()=>this.scheduleRender()),T)),h(this,"effectiveStops",(()=>this._updateSliderSteps()))]),this._validateTimeExtent()}destroy(){this._slider.destroy(),this._tickFormat=null}get interactive(){return!this.disabled&&this.viewModel&&"disabled"!==this.viewModel.state}set layout(e){-1===["auto","compact","wide"].indexOf(e)&&(e="auto"),this._set("layout",e)}next(){}play(){}previous(){}stop(){return null}render(){var e;const{_slider:t,domNode:i,effectiveStops:s,fullTimeExtent:o,interactive:r,messagesCommon:n,mode:l,tickConfigs:u,timeVisible:d,values:c,viewModel:v}=this;if(null!=o){const{start:e,end:i}=o;if(null!=e&&null!=i){const s=e.getTime(),o=i.getTime(),r=t.min!==s||t.max!==o;if(r&&(t.min=s,t.max=o),null!=u)t.tickConfigs!==u&&(t.tickConfigs=u);else{var p,h;const e=(o-s)/(null!=(p=null==(h=t.trackElement)?void 0:h.offsetWidth)?p:400),i=E.find((t=>t.minor.toMilliseconds()>k*e)),a=this._tickFormat!==i&&null!=i;if(a&&(this._tickFormat=i),r||a){const e={mode:"position",values:this._getTickPositions(i.minor),labelsVisible:!1,tickCreatedFunction:(e,t)=>{t.classList.add(j.sliderMinorTick)}},s={mode:"position",values:this._getTickPositions(i.major),labelsVisible:!0,tickCreatedFunction:(e,t)=>{t.classList.add(j.sliderMajorTick)},labelFormatFunction:e=>m(e,i.format)};t.tickConfigs=[e,s]}}}}const w=null==c?void 0:c.map((e=>e.getTime()));a(t.values,w)||(t.values=w),t.disabled=!r;const f=null==o?void 0:o.start,y=null==o?void 0:o.end,_=null!=(e=null==c?void 0:c.length)?e:0,g=_&&this._formatDate(c[0]),x=_&&d&&this._formatTime(c[0]),T=_>1&&"time-window"===l&&this._formatDate(c[1]),M=_>1&&"time-window"===l&&d&&this._formatTime(c[1]),{state:D}=v,C="ready"===D,F="playing"===D,B=!r||0===s.length,L="auto"===this.layout?i.clientWidth<S?"compact":"wide":this.layout,W=b("div",{class:j.animation},b("button",{"aria-disabled":B?"true":"false","aria-label":F?n.control.stop:n.control.play,bind:this,class:this.classes(j.esriWidgetButton,j.animationButton,B&&j.esriButtonDisabled),disabled:B,title:F?n.control.stop:n.control.play,onclick:this._playOrStopClick,type:"button"},b("div",{class:this.classes((C||B)&&j.animationPlay,F&&j.animationPause)}))),U=this.labelFormatFunction?b("div",{key:"extent",bind:this,class:j.timeExtentDate,"data-type":"extent","data-layout":L,"data-date":c,afterCreate:this._createLabel,afterUpdate:this._createLabel}):[g&&b("div",{key:"start-date-group",class:j.timeExtentGroup},b("div",{key:"start-date",class:j.timeExtentDate},g),x&&b("div",{key:"start-time",class:j.timeExtentTime},x)),T&&b("div",{key:"separator",class:j.timeExtentSeparator},"â€“"),g&&b("div",{key:"end-date-group",class:j.timeExtentGroup},b("div",{key:"end-date",class:j.timeExtentDate},T),M&&b("div",{key:"end-time",class:j.timeExtentTime},M))],R=b("div",{class:this.classes(j.timeExtent,!r&&j.esriButtonDisabled)},[U]),I=this.labelFormatFunction?b("div",{key:"min-date",bind:this,class:j.minDate,"data-date":f,"data-type":"min","data-layout":L,afterCreate:this._createLabel,afterUpdate:this._createLabel}):[f&&b("div",{key:"min-date",class:j.minDate},this._formatDate(f)),f&&d&&b("div",{key:"min-time"},this._formatTime(f))],V=b("div",{class:this.classes(j.min,!r&&j.esriButtonDisabled)},[I]),O=b("div",{class:j.slider},t.render()),P=this.labelFormatFunction?b("div",{key:"max-date",bind:this,class:j.maxDate,"data-date":y,"data-type":"max","data-layout":L,afterCreate:this._createLabel,afterUpdate:this._createLabel}):[y&&b("div",{key:"max-date",class:j.maxDate},this._formatDate(y)),y&&d&&b("div",{key:"max-time"},this._formatTime(y))],A=b("div",{class:this.classes(j.max,!r&&j.esriButtonDisabled)},[P]),$=b("div",{class:j.previous},b("button",{"aria-disabled":B?"true":"false","aria-label":n.pagination.previous,bind:this,class:this.classes(j.esriWidgetButton,j.previousButton,(F||B)&&j.esriButtonDisabled),disabled:B,title:n.pagination.previous,onclick:this._previousClick,type:"button"},b("div",{class:j.previousIcon}))),G=b("div",{class:j.next},b("button",{"aria-disabled":B?"true":"false","aria-label":n.pagination.next,bind:this,class:this.classes(j.esriWidgetButton,j.nextButton,(F||B)&&j.esriButtonDisabled),disabled:B,title:n.pagination.next,onclick:this._nextClick,type:"button"},b("div",{class:j.nextIcon})));return b("div",{class:this.classes(j.timeSlider,j.esriWidget,`${j.timeSliderMode}${l}`,`${j.timeSliderLayout}${L}`,!r&&j.esriDisabled)},"wide"===L&&b("div",{class:j.timeSliderRow},[W,R,V,O,A,$,G]),"compact"===L&&[b("div",{key:"time-slider-row-1",class:j.timeSliderRow},[R]),b("div",{key:"time-slider-row-2",class:j.timeSliderRow},[O]),b("div",{key:"time-slider-row-3",class:j.timeSliderRow},[V,$,W,G,A])])}updateWebDocument(e){var t;null==(t=this.viewModel)||t.updateWebDocument(e)}_createLabel(e){const t=e.getAttribute("data-type"),i=e.getAttribute("data-layout"),s=e["data-date"];this.labelFormatFunction(s,t,e,i)}_getTickPositions(e){const{fullTimeExtent:t}=this,{start:i,end:s}=t,o=[],{value:r,unit:a}=e;let n=c(i,a);for(;n.getTime()<=s.getTime();)n.getTime()>=i.getTime()&&o.push(n.getTime()),n=v(n,r,a);return o}_formatDate(e){return m(e,u("short-date"))}_formatTime(e){return m(e,u("long-time"))}_updateSliderSteps(){this._slider.steps=this.effectiveStops&&this.effectiveStops.length>0?this.effectiveStops.map((e=>e.getTime())):null}_validateTimeExtent(){if(this.fullTimeExtent&&this.mode&&this.values){if(!Array.isArray(this.values))throw new r("time-slider:invalid-values","Values must be an array of dates.");if(0===this.values.length||this.values.some((e=>!(e instanceof Date))))throw new r("time-slider:invalid-values","Values must be an array of dates.");switch(this.values=this.values.map((e=>{const t=e.getTime(),i=d(t,this.fullTimeExtent.start.getTime(),this.fullTimeExtent.end.getTime());return new Date(i)})),this.mode){case"instant":case"cumulative-from-start":case"cumulative-from-end":this.values.length>1&&this.values.splice(1);break;case"time-window":1===this.values.length?this.values.push(this.fullTimeExtent.end):this.values.length>2&&this.values.splice(2),this.values.sort(((e,t)=>e.getTime()-t.getTime()));break;default:t(this.mode)}}}_playOrStopClick(){switch(this.viewModel.state){case"ready":this.viewModel.play();break;case"playing":this.viewModel.stop();break;case"disabled":break;default:t(this.viewModel.state)}}_previousClick(){this.viewModel.previous()}_nextClick(){this.viewModel.next()}};e([i()],M.prototype,"disabled",void 0),e([s("viewModel.effectiveStops")],M.prototype,"effectiveStops",void 0),e([s("viewModel.fullTimeExtent")],M.prototype,"fullTimeExtent",void 0),e([i()],M.prototype,"iconClass",void 0),e([i({readOnly:!0})],M.prototype,"interactive",null),e([i({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],M.prototype,"label",void 0),e([i()],M.prototype,"labelFormatFunction",void 0),e([i({value:"auto"})],M.prototype,"layout",null),e([s("viewModel.loop")],M.prototype,"loop",void 0),e([i(),y("esri/widgets/TimeSlider/t9n/TimeSlider")],M.prototype,"messages",void 0),e([i(),y("esri/t9n/common")],M.prototype,"messagesCommon",void 0),e([s("viewModel.mode")],M.prototype,"mode",void 0),e([s("viewModel.playRate")],M.prototype,"playRate",void 0),e([s("viewModel.stops")],M.prototype,"stops",void 0),e([i()],M.prototype,"tickConfigs",void 0),e([s("viewModel.timeExtent")],M.prototype,"timeExtent",void 0),e([i({nonNullable:!0})],M.prototype,"timeVisible",void 0),e([s("viewModel.values")],M.prototype,"values",void 0),e([s("viewModel.view")],M.prototype,"view",void 0),e([i({type:x})],M.prototype,"viewModel",void 0),e([s("viewModel.next")],M.prototype,"next",null),e([s("viewModel.play")],M.prototype,"play",null),e([s("viewModel.previous")],M.prototype,"previous",null),e([s("viewModel.stop")],M.prototype,"stop",null),e([f()],M.prototype,"_playOrStopClick",null),e([f()],M.prototype,"_previousClick",null),e([f()],M.prototype,"_nextClick",null),M=e([o("esri.widgets.TimeSlider")],M);var D=M;export default D;
