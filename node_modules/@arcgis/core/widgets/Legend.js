/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../core/has.js";import"../core/Logger.js";import{property as s}from"../core/accessorSupport/decorators/property.js";import{aliasOf as t}from"../core/accessorSupport/decorators/aliasOf.js";import{cast as r}from"../core/accessorSupport/decorators/cast.js";import{subclass as i}from"../core/accessorSupport/decorators/subclass.js";import"../core/urlUtils.js";import"../core/uuid.js";import"../portal/support/resourceExtension.js";import o from"../core/Handles.js";import{on as n,init as a}from"../core/watchUtils.js";import"./support/widgetUtils.js";import{messageBundle as d}from"./support/decorators/messageBundle.js";import{j as l}from"../chunks/index.js";import c from"./Widget.js";import p from"./Legend/LegendViewModel.js";import h from"./Legend/styles/Card.js";import y from"./Legend/styles/Classic.js";const v={base:"esri-legend",widget:"esri-widget",panel:"esri-widget--panel",widgetIcon:"esri-icon-layer-list"};let f=class extends c{constructor(e,s){super(e,s),this._handles=new o,this.activeLayerInfos=null,this.basemapLegendVisible=!1,this.groundLegendVisible=!1,this.keepCacheOnDestroy=!1,this.respectLayerVisibility=!0,this.iconClass=v.widgetIcon,this.label=void 0,this.layerInfos=null,this.messages=null,this.style=new y,this.view=null,this.viewModel=new p}initialize(){this.own(n(this,"activeLayerInfos","change",(()=>this._refreshActiveLayerInfos(this.activeLayerInfos))),a(this,"style",((e,s)=>{s&&e!==s&&s.destroy(),e&&(e.activeLayerInfos=this.activeLayerInfos,"card"===e.type&&(e.view=this.view))})))}destroy(){this._handles.destroy(),this._handles=null}castStyle(e){if(e instanceof h||e instanceof y)return e;if("string"==typeof e)return"card"===e?new h:new y;if(e&&"string"==typeof e.type){const s={...e};delete s.type;return new("card"===e.type?h:y)(s)}return new y}render(){return l("div",{class:this.classes(v.base,v.widget,this.style instanceof y?v.panel:null)},this.style.render())}_refreshActiveLayerInfos(e){this._handles.removeAll(),e.forEach((e=>this._renderOnActiveLayerInfoChange(e))),this.scheduleRender()}_renderOnActiveLayerInfoChange(e){const s=a(e,"version",(()=>this.scheduleRender()));this._handles.add(s,`version_${e.layer.uid}`);const t=n(e,"children","change",(()=>{e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}));this._handles.add(t,`children_${e.layer.uid}`),e.children.forEach((e=>this._renderOnActiveLayerInfoChange(e)))}};e([t("viewModel.activeLayerInfos")],f.prototype,"activeLayerInfos",void 0),e([t("viewModel.basemapLegendVisible")],f.prototype,"basemapLegendVisible",void 0),e([t("viewModel.groundLegendVisible")],f.prototype,"groundLegendVisible",void 0),e([t("viewModel.keepCacheOnDestroy")],f.prototype,"keepCacheOnDestroy",void 0),e([t("viewModel.respectLayerVisibility")],f.prototype,"respectLayerVisibility",void 0),e([s()],f.prototype,"iconClass",void 0),e([s({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],f.prototype,"label",void 0),e([t("viewModel.layerInfos")],f.prototype,"layerInfos",void 0),e([s(),d("esri/widgets/Legend/t9n/Legend")],f.prototype,"messages",void 0),e([s()],f.prototype,"style",void 0),e([r("style")],f.prototype,"castStyle",null),e([t("viewModel.view")],f.prototype,"view",void 0),e([s()],f.prototype,"viewModel",void 0),f=e([i("esri.widgets.Legend")],f);var g=f;export default g;
