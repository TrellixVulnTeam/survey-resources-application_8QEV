/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as t}from"../../../chunks/tslib.es6.js";import"../../../core/has.js";import"../../../core/Logger.js";import"../../../core/accessorSupport/ensureType.js";import{property as e}from"../../../core/accessorSupport/decorators/property.js";import{subclass as o}from"../../../core/accessorSupport/decorators/subclass.js";import"../../../core/urlUtils.js";import"../../../core/uuid.js";import"../../../portal/support/resourceExtension.js";import r from"../../../core/Evented.js";import{watch as n}from"../../../core/watchUtils.js";import{HandleOwnerMixin as i}from"../../../core/HandleOwner.js";import{renderingSanitizer as s}from"../../support/widgetUtils.js";import l from"./support/ButtonMenu.js";const d={sortAscIcon:"esri-icon-arrow-up",sortDescIcon:"esri-icon-arrow-down",menuContainer:"esri-column__menu-container",menuIcon:"esri-icon-handle-horizontal",sorter:"esri-column__sorter"},u={keyboardSort1:"Enter",keyboardSort2:"Spacebar"};let a=class extends(i(r.EventedAccessor)){constructor(t){super(t),this._menuContainer=null,this.activeRowIndex=null,this.autoWidth=!1,this.cellValueFormatFunction=({value:t})=>s.sanitize(t),this.flexGrow=1,this.footerRenderFunction=null,this.frozen=!1,this.grid=null,this.header=null,this.headerRenderFunction=t=>{const{root:e}=t,{header:o,headerMenuEnabled:r,path:n,sortable:i}=this;if(this.removeCellContent(e),i)return this.headerSorterRenderFunction(t),void(r&&this.headerMenuRenderFunction(t));r&&this.headerMenuRenderFunction(t);const s=o||n;e.innerHTML!==s&&(e.innerHTML=s)},this.headerMenuRenderFunction=({root:t})=>{var e,o;(null==(e=this.menu)||null==(o=e.items)?void 0:o.length)&&t.appendChild(this._menuContainer)},this.headerSorterRenderFunction=({root:t})=>{var e;const{header:o,path:r,sortElement:n}=this,i=o||r;if(!n)return void(t.innerHTML=i);n.innerHTML!==i&&n.setAttribute("innerHTML",i),t.appendChild(n);const s=null==(e=this.grid)?void 0:e.getSlotElementByName(t.slot),l=null==s?void 0:s.parentElement;l&&!l.onkeydown&&(l.onkeydown=({key:t})=>{t!==u.keyboardSort1&&t!==u.keyboardSort2||n.click()})},this.hidden=!1,this.headerMenuEnabled=!0,this.menu=null,this.menuConfig=null,this.messages=null,this.messagesCommon=null,this.renderFunction=({root:t,column:e,rowData:o})=>{const r=this.getCellValue(e,o),n=this.cellValueFormatFunction({column:e,rowData:o,value:r});t.innerHTML!==n&&(t.innerHTML=n)},this.resizable=!0,this.sortable=!0,this.sortElement=null,this.textAlign="start",this.width=200}initialize(){const{messages:t,path:e}=this;this._set("sortElement",this.createSortElement()),this.sortElement.setAttribute("path",e),this._menuContainer=document.createElement("div"),this._menuContainer.classList.add(d.menuContainer),this.menu=new l({label:null==t?void 0:t.options,iconClass:d.menuIcon,...this.menuConfig}),this.menu.container=this._menuContainer,this.menu.set("items",this.getMenuItems()),this.handles.add([n(this,"hidden",(()=>{var t;return null==(t=this.menu)?void 0:t.set("open",!1)}))])}destroy(){var t;null==(t=this.menu)||t.destroy()}set direction(t){this.sortable&&(this.sortElement&&(t?this.sortElement.direction!==t&&this.sortElement.setAttribute("direction",t):this.sortElement.removeAttribute("direction")),this._set("direction",t))}get direction(){return this._get("direction")||null}set path(t){this.sortElement&&this.sortElement.path!==t&&this.sortElement.setAttribute("path",t),this._set("path",t)}getMenuItems(){const{menuConfig:t,sortable:e}=this,o=null==t?void 0:t.items,r=this.getSortMenuItems(),n=[];return e&&n.push(...r),(null==o?void 0:o.length)&&n.push(...o),n.length?n:null}getSortMenuItems(){const{messages:t}=this;return[{selected:"asc"===this.direction,iconClass:d.sortAscIcon,label:null==t?void 0:t.sortAsc,autoCloseMenu:!0,clickFunction:()=>this.set("direction","asc"!==this.direction?"asc":null)},{selected:"desc"===this.direction,iconClass:d.sortDescIcon,label:null==t?void 0:t.sortDesc,autoCloseMenu:!0,clickFunction:()=>this.set("direction","desc"!==this.direction?"desc":null)}]}getCellValue(t,e){var o;return null!=(o=null==e?void 0:e.item[null==t?void 0:t.path])?o:""}createSortElement(){const{direction:t,header:e,path:o}=this,r=e||o,n=document.createElement("vaadin-grid-sorter");return n.classList.add(d.sorter),n.setAttribute("path",o),t&&n.setAttribute("direction",t),n.innerHTML=r,n.setAttribute("title",r),n}removeCellContent(t){if(t)for(;t.firstChild;)try{t.removeChild(t.firstChild)}catch(e){}}};t([e()],a.prototype,"activeRowIndex",void 0),t([e()],a.prototype,"autoWidth",void 0),t([e()],a.prototype,"cellValueFormatFunction",void 0),t([e()],a.prototype,"direction",null),t([e()],a.prototype,"flexGrow",void 0),t([e()],a.prototype,"footerRenderFunction",void 0),t([e()],a.prototype,"frozen",void 0),t([e()],a.prototype,"grid",void 0),t([e()],a.prototype,"header",void 0),t([e()],a.prototype,"headerRenderFunction",void 0),t([e()],a.prototype,"headerMenuRenderFunction",void 0),t([e()],a.prototype,"headerSorterRenderFunction",void 0),t([e()],a.prototype,"hidden",void 0),t([e()],a.prototype,"headerMenuEnabled",void 0),t([e()],a.prototype,"menu",void 0),t([e()],a.prototype,"menuConfig",void 0),t([e()],a.prototype,"messages",void 0),t([e()],a.prototype,"messagesCommon",void 0),t([e()],a.prototype,"path",null),t([e()],a.prototype,"renderFunction",void 0),t([e()],a.prototype,"resizable",void 0),t([e()],a.prototype,"sortable",void 0),t([e({readOnly:!0})],a.prototype,"sortElement",void 0),t([e()],a.prototype,"textAlign",void 0),t([e()],a.prototype,"width",void 0),a=t([o("esri.widgets.FeatureTable.Grid.Column")],a);var c=a;export default c;
