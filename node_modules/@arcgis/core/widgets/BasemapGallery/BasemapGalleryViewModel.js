/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as t}from"../../chunks/tslib.es6.js";import"../../core/has.js";import"../../core/Logger.js";import{property as e}from"../../core/accessorSupport/decorators/property.js";import{cast as s}from"../../core/accessorSupport/decorators/cast.js";import{subclass as o}from"../../core/accessorSupport/decorators/subclass.js";import"../../core/urlUtils.js";import"../../core/uuid.js";import"../../portal/support/resourceExtension.js";import i from"../../core/Collection.js";import r from"../../core/Loadable.js";import a from"../../core/Handles.js";import{contentEquals as p}from"../../support/basemapUtils.js";import{watch as c,on as n}from"../../core/watchUtils.js";import{default3DCompatibility as l,default2DCompatibility as m}from"./support/basemapCompatibilityUtils.js";import u from"./support/BasemapGalleryItem.js";import d from"./support/LocalBasemapsSource.js";import h from"./support/PortalBasemapsSource.js";const y=i.ofType(u);function b(t){return t&&"esri.portal.Portal"===t.declaredClass}function f(t){return t&&!(t instanceof h)&&(!!t.portal||!!t.query)}function v(t){return t&&"basemaps"in t&&"state"in t&&"refresh"in t}let w=class extends r{constructor(t){super(t),this._handles=new a,this.activeBasemap=null,this.items=new y,this.source=new h,this.view=null}initialize(){const t=()=>this._recreateItems();this._handles.add([c(this,["compatibilityFunction","state"],(()=>this._updateItems())),n(this,"source.basemaps","change",t,t)])}destroy(){this._handles.destroy(),this._handles=null}get compatibilityFunction(){if(void 0===this._get("compatibilityFunction")){return"3d"===this.get("view.type")?l:m}return this._get("compatibilityFunction")}set compatibilityFunction(t){this._set("compatibilityFunction",t)}castSource(t){return Array.isArray(t)||i.isCollection(t)?new d({basemaps:t}):b(t)?new h({portal:t}):f(t)?new h(t):v(t)?t:null}get state(){return this.get("view.ready")&&this.source?"ready":"disabled"}basemapEquals(t,e){return p(t,e)}refresh(){this._recreateItems()}load(t){return this.addResolvingPromise(r.isLoadable(this.source)?this.source.load(t):Promise.resolve()),Promise.resolve(this)}_recreateItems(){const t=this.get("source.basemaps"),{view:e,compatibilityFunction:s}=this;this.items.removeAll().forEach((t=>t.destroy())),this.items.addMany(t.map((t=>new u({basemap:t,compatibilityFunction:s,view:e}))))}_updateItems(){this.items.forEach((t=>{t.compatibilityFunction=this.compatibilityFunction,t.view=this.view}))}};t([e({aliasOf:"view.map.basemap"})],w.prototype,"activeBasemap",void 0),t([e()],w.prototype,"compatibilityFunction",null),t([e({readOnly:!0,type:y})],w.prototype,"items",void 0),t([e()],w.prototype,"source",void 0),t([s("source")],w.prototype,"castSource",null),t([e({readOnly:!0})],w.prototype,"state",null),t([e()],w.prototype,"view",void 0),w=t([o("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],w);var j=w;export default j;
