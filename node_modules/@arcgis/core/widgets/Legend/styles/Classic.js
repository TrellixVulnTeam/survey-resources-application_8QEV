/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import"../../../core/has.js";import"../../../core/Logger.js";import"../../../core/accessorSupport/ensureType.js";import{property as r}from"../../../core/accessorSupport/decorators/property.js";import{subclass as l}from"../../../core/accessorSupport/decorators/subclass.js";import"../../../core/urlUtils.js";import"../../../core/uuid.js";import"../../../portal/support/resourceExtension.js";import{formatNumber as a}from"../../../intl/number.js";import"../../../intl.js";import"../../support/widgetUtils.js";import{messageBundle as s}from"../../support/decorators/messageBundle.js";import{j as i}from"../../../chunks/index.js";import t from"../../Widget.js";import{renderRelationshipRamp as n}from"./support/relationshipUtils.js";import{getUnivariateAboveAndBelowRampElements as o,getUnivariateColorRampSize as p,getUnivariateColorRampPreview as d,getUnivariateColorRampMargin as m,getUnivariateColorSizeRampElements as y}from"./support/univariateUtils.js";import{getTitle as c,isRendererTitle as g,attachToNode as v,isImageryStretchedLegend as h}from"../support/styleUtils.js";const b={service:"esri-legend__service",label:"esri-legend__service-label",layer:"esri-legend__layer",groupLayer:"esri-legend__group-layer",groupLayerChild:"esri-legend__group-layer-child",layerTable:"esri-legend__layer-table",layerTableSizeRamp:"esri-legend__layer-table--size-ramp",layerChildTable:"esri-legend__layer-child-table",layerCaption:"esri-legend__layer-caption",layerBody:"esri-legend__layer-body",layerRow:"esri-legend__layer-row",layerCell:"esri-legend__layer-cell",layerInfo:"esri-legend__layer-cell esri-legend__layer-cell--info",imageryLayerStretchedImage:"esri-legend__imagery-layer-image--stretched",imageryLayerCellStretched:"esri-legend__imagery-layer-cell--stretched",imageryLayerInfoStretched:"esri-legend__imagery-layer-info--stretched",symbolContainer:"esri-legend__layer-cell esri-legend__layer-cell--symbols",symbol:"esri-legend__symbol",rampContainer:"esri-legend__ramps",sizeRamp:"esri-legend__size-ramp",colorRamp:"esri-legend__color-ramp",opacityRamp:"esri-legend__opacity-ramp",borderlessRamp:"esri-legend__borderless-ramp",rampTick:"esri-legend__ramp-tick",rampFirstTick:"esri-legend__ramp-tick-first",rampLastTick:"esri-legend__ramp-tick-last",rampLabelsContainer:"esri-legend__ramp-labels",rampLabel:"esri-legend__ramp-label",univariateAboveAndBelowSymbol:"esri-univariate-above-and-below-ramp__symbol",univariateAboveAndBelowLabel:"esri-univariate-above-and-below-ramp__label",message:"esri-legend__message",header:"esri-widget__heading",hidden:"esri-hidden"},_="esri-legend__",u=24,f={display:"flex",alignItems:"flex-start"},L={marginLeft:"3px"},w={display:"table-cell",verticalAlign:"middle"};let C=class extends t{constructor(e,r){super(e,r),this.activeLayerInfos=null,this.messages=null,this.type="classic"}render(){const e=this.activeLayerInfos,r=e&&e.toArray().map((e=>this._renderLegendForLayer(e))).filter((e=>!!e));return i("div",null,r&&r.length?r:i("div",{class:b.message},this.messages.noLegend))}_renderLegendForLayer(e){if(!e.ready)return null;const r=!!e.children.length,l=`${_}${e.layer.uid}-version-${e.version}`,a=e.title?i("h3",{class:this.classes(b.header,b.label)},e.title):null;if(r){const r=e.children.map((e=>this._renderLegendForLayer(e))).toArray();return i("div",{key:l,class:this.classes(b.service,b.groupLayer)},a,r)}{const r=e.legendElements;if(r&&!r.length)return null;const s=r.map((r=>this._renderLegendForElement(r,e.layer))).filter((e=>!!e));if(!s.length)return null;const t={[b.groupLayerChild]:!!e.parent};return i("div",{key:l,class:this.classes(b.service,t),tabIndex:0},a,i("div",{class:b.layer},s))}}_renderLegendForElement(e,r,l){const a="color-ramp"===e.type,s="opacity-ramp"===e.type,t="size-ramp"===e.type;let o=null;if("symbol-table"===e.type||t){const l=e.infos.map((l=>this._renderLegendForElementInfo(l,r,t,e.legendType))).filter((e=>!!e));l.length&&(o=i("div",{class:b.layerBody},l))}else"color-ramp"===e.type||"opacity-ramp"===e.type||"heatmap-ramp"===e.type||"stretch-ramp"===e.type?o=this._renderLegendForRamp(e,r.opacity):"relationship-ramp"===e.type?o=n(e,this.id,r.opacity):"univariate-above-and-below-ramp"===e.type?o=this._renderUnivariateAboveAndBelowRamp(e,r.opacity):"univariate-color-size-ramp"===e.type&&(o=this._renderUnivariateColorSizeRamp(e,r.opacity));if(!o)return null;const p=e.title;let d=null;if("string"==typeof p)d=p;else if(p){const e=c(this.messages,p,a||s);d=g(p,a||s)&&p.title?`${p.title} (${e})`:e}const m=l?b.layerChildTable:b.layerTable,y=d?i("div",{class:b.layerCaption},d):null,v={[b.layerTableSizeRamp]:t||!l};return i("div",{class:this.classes(m,v)},y,o)}_renderUnivariateAboveAndBelowRamp(e,r){const{sizeRampElement:l,colorRampElement:a}=o(e,r),s=p(l,"above",!0),t=p(l,"below",!0),n=12,y=d(a,{width:n,height:s,rampAlignment:"vertical",opacity:r,type:"above"}),c=d(a,{width:n,height:t,rampAlignment:"vertical",opacity:r,type:"below"}),g=m(l),h=l.infos.map((e=>e.label)),_=h.map(((e,r)=>{const l=2===r;return 0===r?i("div",{key:r,class:e?y?b.univariateAboveAndBelowLabel:b.rampLabel:null},e):l?i("div",null):null})),u=h.length-1,C=Math.floor(h.length/2),R=h.map(((e,r)=>r===C||r===u?i("div",{key:r,class:e?y?b.univariateAboveAndBelowLabel:b.rampLabel:null},e):null)),A={display:"table-cell",verticalAlign:"middle"},S={marginTop:`${g}px`},j={height:`${s}px`},I={height:`${t}px`};return i("div",{key:"univariate-above-and-below-ramp-preview",styles:f},i("div",{class:b.layerBody},l.infos.map(((e,r)=>i("div",{class:this.classes(b.layerRow,b.sizeRamp)},i("div",{class:b.symbol,styles:A,bind:e.preview,afterCreate:v}),y||r%2!=0?null:i("div",{class:b.layerInfo},h[r]))))),y?i("div",{styles:S,key:"color-ramp-preview"},i("div",{styles:L},i("div",{styles:w},i("div",{class:b.rampContainer,bind:y,afterCreate:v})),i("div",{styles:w},i("div",{class:b.rampLabelsContainer,styles:j},_))),i("div",{styles:L},i("div",{styles:w},i("div",{class:b.rampContainer,bind:c,afterCreate:v})),i("div",{styles:w},i("div",{class:b.rampLabelsContainer,styles:I},R)))):null)}_renderUnivariateColorSizeRamp(e,r){const{sizeRampElement:l,colorRampElement:a}=y(e),s=m(l),t=12,n=p(l,"full",!1),o=d(a,{width:t,height:n,rampAlignment:"vertical",opacity:r,type:"full"}),c=l.infos.length-1,g=l.infos.map(((e,r)=>0===r||r===c?i("div",{key:r,class:e.label?a?b.univariateAboveAndBelowLabel:b.rampLabel:null},e.label):null)),h={display:"table-cell",verticalAlign:"middle"},_={marginTop:`${s}px`},u={height:`${n}px`};return i("div",{key:"univariate-above-and-below-ramp-preview",styles:f},i("div",{class:b.layerBody},l.infos.map((e=>i("div",{class:this.classes(b.layerRow,b.sizeRamp)},i("div",{class:b.symbol,styles:h,bind:e.preview,afterCreate:v}))))),i("div",{styles:_,key:"color-ramp-preview"},i("div",{styles:L},i("div",{styles:w},i("div",{class:b.rampContainer,bind:o,afterCreate:v})),i("div",{styles:w},i("div",{class:b.rampLabelsContainer,styles:u},g)))))}_renderLegendForRamp(e,r){const l=e.infos,a="opacity-ramp"===e.type,s="heatmap-ramp"===e.type,t="stretch-ramp"===e.type,n=e.preview,o=a?b.opacityRamp:"";n.className=`${b.colorRamp} ${o}`,null!=r&&(n.style.opacity=r.toString());const p=l.map((e=>i("div",{class:e.label?b.rampLabel:null},s?this.messages[e.label]:t?this._getStretchStopLabel(e):e.label))),d={width:`${u}px`},m={height:n.style.height};return i("div",{class:b.layerRow},i("div",{class:b.symbolContainer,styles:d},i("div",{class:b.rampContainer,bind:n,afterCreate:v})),i("div",{class:b.layerInfo},i("div",{class:b.rampLabelsContainer,styles:m},p)))}_getStretchStopLabel(e){return e.label?this.messages[e.label]+": "+a(e.value,{style:"decimal",notation:e.value.toString().indexOf("e")>-1?"scientific":"standard"}):""}_renderLegendForElementInfo(e,r,l,a){if(e.type)return this._renderLegendForElement(e,r,!0);let s=null;const t=h(r,a);if(e.preview?s=i("div",{class:b.symbol,bind:e.preview,afterCreate:v}):e.src&&(s=this._renderImage(e,r,t)),!s)return null;const n={[b.imageryLayerInfoStretched]:t},o={[b.imageryLayerInfoStretched]:t,[b.sizeRamp]:!t&&l};return i("div",{class:b.layerRow},i("div",{class:this.classes(b.symbolContainer,o)},s),i("div",{class:this.classes(b.layerInfo,n)},c(this.messages,e.label,!1)||""))}_renderImage(e,r,l){const{label:a,src:s,opacity:t}=e,n={[b.imageryLayerStretchedImage]:l,[b.symbol]:!l},o={opacity:`${null!=t?t:r.opacity}`};return i("img",{alt:c(this.messages,a,!1),src:s,border:0,width:e.width,height:e.height,class:this.classes(n),styles:o})}};e([r()],C.prototype,"activeLayerInfos",void 0),e([r(),s("esri/widgets/Legend/t9n/Legend")],C.prototype,"messages",void 0),e([r({readOnly:!0})],C.prototype,"type",void 0),C=e([l("esri.widgets.Legend.styles.Classic")],C);var R=C;export default R;
