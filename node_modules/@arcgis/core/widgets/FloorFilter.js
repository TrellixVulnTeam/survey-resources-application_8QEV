/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../core/has.js";import"../core/Logger.js";import"../core/accessorSupport/ensureType.js";import{property as t}from"../core/accessorSupport/decorators/property.js";import{aliasOf as i}from"../core/accessorSupport/decorators/aliasOf.js";import{subclass as s}from"../core/accessorSupport/decorators/subclass.js";import"../core/urlUtils.js";import"../core/uuid.js";import"../portal/support/resourceExtension.js";import{isRTL as l}from"./support/widgetUtils.js";import{messageBundle as o}from"./support/decorators/messageBundle.js";import{j as r}from"../chunks/index.js";import n from"./Widget.js";import a from"./FloorFilter/FloorFilterViewModel.js";const c={esriWidget:"esri-widget",esriWidgetButton:"esri-widget--button",esriWidgetButtonActive:"esri-widget--button-active",esriButtonDisabled:"esri-button--disabled",esriDisabled:"esri-disabled",esriIcon:"esri-icon",esriInteractive:"esri-interactive",esriWidgetContentEmpty:"esri-widget__content--empty",floorFilter:"esri-floor-filter",floorFilterLayout:"esri-floor-filter__layout--",floorFilterPosition:"esri-floor-filter__position--",buttonContainer:"esri-floor-filter__button-container",buttonContainerLevels:"esri-floor-filter__button-container--levels",buttonInfo:"esri-floor-filter__button-info",buttonLabel:"esri-floor-filter__button-label",browseButton:"esri-floor-filter__browse-button",closeLevelsButton:"esri-floor-filter__close-levels-button",zoomButton:"esri-floor-filter__zoom-button",zoomButtonLevels:"esri-floor-filter__zoom-button--levels",minimizeToggleButton:"esri-floor-filter__minimize-toggle-button",levelsContainer:"esri-floor-filter__levels-container",levelButton:"esri-floor-filter__level-button",levelButtonActive:"esri-floor-filter__level-button--active",separator:"esri-floor-filter__separator",filterMenu:"esri-floor-filter__filter-menu",filterMenuHeader:"esri-floor-filter__filter-menu-header",filterMenuHeaderTextGroup:"esri-floor-filter__filter-menu-header-text-group",filterMenuHeaderText:"esri-floor-filter__filter-menu-header-text",filterMenuHeaderSubtext:"esri-floor-filter__filter-menu-header-subtext",filterMenuHeaderBack:"esri-floor-filter__filter-menu-header-back",filterMenuSearch:"esri-floor-filter__filter-menu-search",filterMenuSearchInput:"esri-floor-filter__filter-menu-search-input",filterMenuItems:"esri-floor-filter__filter-menu-items",filterMenuItemName:"esri-floor-filter__filter-menu-item-name",filterMenuSelectedItem:"esri-floor-filter__filter-menu-item-name--selected",filterMenuSite:"esri-floor-filter__filter-menu-site",filterMenuFacility:"esri-floor-filter__filter-menu-facility",selectedItemCircle:"esri-floor-filter__selected-item-circle",urbanIcon:"esri-icon-urban-model",zoomToIcon:"esri-icon-zoom-to-object",collapseIconRight:"esri-icon-collapse",collapseIconLeft:"esri-icon-expand",expandIconRight:"esri-icon-expand",expandIconLeft:"esri-icon-collapse",closeIcon:"esri-icon-close",searchIcon:"esri-icon-search",rightIcon:"esri-icon-right",leftIcon:"esri-icon-left"};let d=class extends n{constructor(e,t){super(e,t),this._baseNode=null,this.enabled=null,this.longNames=null,this.minimized=null,this.pinnedLevels=null,this.site=null,this.facility=null,this.level=null,this.view=null,this.viewModel=new a,this.messages=null,this.messagesCommon=null,this.goToOverride=null,this._resizeObserver=new ResizeObserver((()=>this.scheduleRender()))}destroy(){this._resizeObserver.disconnect()}updateWebDocument(){}render(){var e;const{longNames:t}=this,i=t&&this.viewModel.isNormalMode?"expanded":"collapsed",s=this.renderButtons(),o=this.renderFilterMenu(),n=r("div",{class:this.classes(c.separator)}),a=this._getComponentPosition(),d=this._getPosition(a),u="top-right"===a||"bottom-right"===a,h="top-left"===a||"bottom-left"===a,v=l(),f=v&&h||!v&&u?o:s,m=v&&h||!v&&u?s:o;return r("div",{afterCreate:this._afterBaseNodeCreate,key:"floor-filter-menu",class:this.classes(c.floorFilter,c.esriWidget,`${c.floorFilterLayout}${i}`,`${c.floorFilterPosition}${d}`)},f,(null==(e=this.viewModel)?void 0:e.filterMenuOpen)&&n,m)}renderButtons(){const e=this._getComponentPosition(),t=[];return"top"===this._getPosition(e)?(t.push(this.renderBrowseButton()),t.push(this.renderLevelButtons()),t.push(this.renderCloseLevelsButton()),t.push(this.renderZoomButton()),t.push(this.renderCollapseToggleButton())):(t.push(this.renderCollapseToggleButton()),t.push(this.renderZoomButton()),t.push(this.renderCloseLevelsButton()),t.push(this.renderLevelButtons()),t.push(this.renderBrowseButton())),r("div",{key:"button-container",class:this.classes(c.esriWidget,c.buttonContainer)},t)}renderBrowseButton(){var e;const{longNames:t,messages:i}=this;return r("button",{key:"browse-button",title:i.buttons.browse,bind:this,class:this.classes(c.esriWidget,c.esriWidgetButton,c.esriInteractive,("loading"===this.viewModel.state||"disabled"===this.viewModel.state)&&c.esriButtonDisabled,c.browseButton,(null==(e=this.viewModel)?void 0:e.filterMenuOpen)&&c.esriWidgetButtonActive),"aria-expanded":this.viewModel.filterMenuOpen.toString(),"aria-label":i.buttons.browse,onclick:this._toggleFilterMenu},r("div",{class:this.classes(c.buttonInfo)},r("span",{class:this.classes(c.esriIcon,c.urbanIcon)}),r("span",{class:this.classes(c.buttonLabel)},t&&this.viewModel.isNormalMode&&i.buttons.browse)))}renderLevelButtons(){var e,t,i,s;if(null==(e=this.viewModel)||null==(t=e.filterFeatures)||null==(i=t.levels)||!i.levelsInfo||!this.facility)return null;const{facility:l,messagesCommon:o}=this,n=(null==(s=this.viewModel)?void 0:s.getFacilityLevels(l)).map((e=>this.renderLevelButton(e)));if(!n.length)return null;if(this._isWebScene(this.view.map)&&(null==n?void 0:n.length)>1){const e={id:`all--${l}`,facilityId:l,shortName:o.all,longName:o.all,levelNumber:null,verticalOrder:null},t=this.renderLevelButton(e);n.push(t)}return r("ul",{key:"levels-button-container",class:this.classes(c.levelsContainer)},n)}renderLevelButton(e){const{longNames:t}=this,{shortName:i,longName:s,id:l}=e,o=`levels--${l}`,n=this.level===l,a=t&&this.viewModel.isNormalMode?s:i;return this.viewModel.isNormalMode||n||this.viewModel.levelsExpanded?r("li",{key:o},r("button",{"data-id":l,bind:this,class:this.classes(c.esriWidgetButton,n?c.esriWidgetButtonActive:null,c.esriInteractive,c.levelButton),onclick:this._levelSelected},a)):null}renderCloseLevelsButton(){if(!this.level||this.viewModel.isNormalMode||!this.viewModel.levelsExpanded)return null;const{messagesCommon:e}=this;return r("button",{key:"close-levels-button",title:e.close,bind:this,class:this.classes(c.esriWidget,c.esriWidgetButton,c.esriInteractive,c.closeLevelsButton),"aria-label":e.close,onclick:this._closeLevels},r("div",{class:this.classes(c.buttonInfo)},r("span",{class:this.classes(c.esriIcon,c.closeIcon)})))}renderZoomButton(){var e,t,i,s,l;const{longNames:o,messages:n,facility:a,site:d}=this,u=null==(e=this.viewModel)?void 0:e.filterMenuType,h=null==(t=this.viewModel)?void 0:t.filterMenuOpen,v=null==(i=this.viewModel)?void 0:i.getSite(d),f=null==(s=this.viewModel)?void 0:s.getFacility(a),m="site"===u&&h?!v:!f;return r("button",{key:"zoom-button",title:n.buttons.zoomTo,bind:this,class:this.classes(c.esriWidget,c.esriWidgetButton,m&&c.esriButtonDisabled,c.esriInteractive,(null==(l=this.viewModel)?void 0:l.getFacilityLevels(a).length)>0?c.zoomButtonLevels:c.zoomButton),"aria-label":n.buttons.zoomTo,onclick:this._zoomToClicked},r("div",{class:this.classes(c.buttonInfo)},r("span",{class:this.classes(c.esriIcon,c.zoomToIcon)}),r("span",{class:this.classes(c.buttonLabel)},o&&this.viewModel.isNormalMode&&n.buttons.zoomTo)))}renderCollapseToggleButton(){const{longNames:e,messagesCommon:t}=this,i=e?c.collapseIconRight:c.expandIconRight,s=this.classes(c.esriIcon,i),l=e?t.collapse:t.expand;return r("button",{key:"minimize-toggle-button",title:l,bind:this,class:this.classes(c.esriWidget,c.esriWidgetButton,c.esriInteractive,c.minimizeToggleButton),"aria-label":l,onclick:this._toggleCollapsed},r("div",{class:this.classes(c.buttonInfo)},r("span",{class:s}),r("span",{class:this.classes(c.buttonLabel)},e&&this.viewModel.isNormalMode&&t.collapse)))}renderFilterMenu(){var e,t,i;return null!=(e=this.viewModel)&&e.filterMenuOpen?"site"===(null==(t=this.viewModel)?void 0:t.filterMenuType)?this.renderSiteFilterMenu():"facility"===(null==(i=this.viewModel)?void 0:i.filterMenuType)?this.renderFacilityFilterMenu():null:null}renderSiteFilterMenu(){var e,t;const{messages:i,messagesCommon:s}=this,l=this.site?null==(e=this.viewModel)||null==(t=e.getSite(this.site))?void 0:t.name:i.selector.selectSite,o=r("div",{key:"filter-menu-site-header",class:this.classes(`${c.filterMenuHeader}`)},r("div",{class:this.classes(c.filterMenuHeaderTextGroup)},r("h2",{class:this.classes(c.filterMenuHeaderText)},l)),r("button",{bind:this,title:s.close,class:this.classes(c.esriIcon,c.closeIcon),onclick:this._closeClicked})),n=this.renderSearchInput(),a=this.renderSiteItems();return r("div",{key:"filter-menu-site",class:this.classes(c.filterMenu)},o,n,a)}renderFacilityFilterMenu(){var e,t,i,s;const{messages:o,messagesCommon:n,site:a}=this,d=null==(e=this.viewModel)||null==(t=e.getSite(a))?void 0:t.name,u=this.facility&&(null==(i=this.viewModel)||null==(s=i.getFacility(this.facility))?void 0:s.name)||o.selector.selectFacility,h=this.viewModel.hasMultipleSites?r("button",{bind:this,title:n.back,class:this.classes(c.filterMenuHeaderBack),onclick:this._backClicked},r("span",{class:this.classes(l()?c.rightIcon:c.leftIcon)})):null,v=this.viewModel.hasMultipleSites?r("h3",{class:this.classes(c.filterMenuHeaderSubtext)},d):null,f=r("div",{key:"filter-menu-site-header",class:this.classes(c.filterMenuHeader)},h,r("div",{class:this.classes(c.filterMenuHeaderTextGroup)},r("h2",{class:this.classes(c.filterMenuHeaderText)},u),v),r("button",{bind:this,title:n.close,class:this.classes(c.esriIcon,c.closeIcon),onclick:this._closeClicked})),m=this.renderSearchInput(),p=this.renderFacilityItems();return r("div",{key:"filter-menu-facility",class:this.classes(c.filterMenu)},f,m,p)}renderSearchInput(){const{messagesCommon:e}=this;return r("div",{key:"filter-menu-search",class:this.classes(c.filterMenuSearch)},r("span",{class:this.classes(c.esriIcon,c.searchIcon)}),r("input",{bind:this,key:"filter-menu-search__input",class:this.classes(c.filterMenuSearchInput),placeholder:e.search,oninput:this._onSearchChange,onpaste:this._onSearchChange}))}renderBlueCircle(){return r("span",{key:"floor-filter__selected-item-circle",class:this.classes(c.selectedItemCircle)})}renderSiteItems(){var e,t,i,s;if(null==(e=this.viewModel)||null==(t=e.filterFeatures)||null==(i=t.sites)||!i.sitesInfo)return null;const{messages:l}=this,o=this.viewModel.filterFeatures.sites.sitesInfo,n=this.viewModel.filterSites(o).map((e=>this.renderSiteItem(e))),a=0===n.length&&(null==(s=this.viewModel)?void 0:s.searchTerm)&&r("div",{class:this.classes(c.esriWidgetContentEmpty)},l.noResults);return r("ul",{key:"filter-menu-items--sites",class:this.classes(c.filterMenuItems)},n,a)}renderSiteItem(e){const{name:t,id:i}=e,s=`filter-menu-site--${i}`,o=this.site===i;return r("li",{key:s},r("button",{"data-id":i,bind:this,class:this.classes(c.filterMenuSite),onclick:this._siteSelected},o&&this.renderBlueCircle(),r("span",{class:this.classes(o?c.filterMenuSelectedItem:c.filterMenuItemName)},t),r("span",{class:this.classes(l()?c.leftIcon:c.rightIcon)})))}renderFacilityItems(){var e,t,i,s;if(null==(e=this.viewModel)||null==(t=e.filterFeatures)||null==(i=t.facilities)||!i.facilitiesInfo)return null;const{messages:l}=this,o=this.viewModel.filterFeatures.facilities.facilitiesInfo,n=this.viewModel.filterFacilities(o).map((e=>this.renderFacilityItem(e))),a=0===n.length&&(null==(s=this.viewModel)?void 0:s.searchTerm)&&r("div",{class:this.classes(c.esriWidgetContentEmpty)},l.noResults);return r("ul",{key:"filter-menu-items--facilities",class:this.classes(c.filterMenuItems)},n,a)}renderFacilityItem(e){const{name:t,id:i}=e,s=`filter-menu-facility--${i}`,l=this.facility===i;return r("li",{key:s},r("button",{"data-id":i,bind:this,class:this.classes(c.filterMenuFacility),onclick:this._facilitySelected},l&&this.renderBlueCircle(),r("span",{class:this.classes(l?c.filterMenuSelectedItem:c.filterMenuItemName)},t)))}_afterBaseNodeCreate(e){var t,i;this._baseNode&&(null==(i=this._resizeObserver)||i.unobserve(this._baseNode));this._baseNode=e,null==(t=this._resizeObserver)||t.observe(this._baseNode)}_toggleCollapsed(){this.longNames=!this.longNames}_toggleFilterMenu(){var e,t;const i=null!=(e=null==(t=this.viewModel)?void 0:t.filterMenuOpen)&&e;this.viewModel.filterMenuOpen=!i}_setFilterMenuType(e){this.viewModel.filterMenuType=e}_zoomToClicked(){var e,t;if(this.site&&"site"===(null==(e=this.viewModel)?void 0:e.filterMenuType)&&null!=(t=this.viewModel)&&t.filterMenuOpen){var i;const e=null==(i=this.viewModel)?void 0:i.getSite(this.site);this.viewModel.goTo(e)}else if(this.facility){var s;const e=null==(s=this.viewModel)?void 0:s.getFacility(this.facility);this.viewModel.goTo(e)}else if(this.site){var l;const e=null==(l=this.viewModel)?void 0:l.getSite(this.site);this.viewModel.goTo(e)}}_onSearchChange(e){var t;const i=e.target;""===i.value?this.viewModel.searchTerm=null:i.value&&(null==(t=this.viewModel)?void 0:t.searchTerm)!==i.value&&(this.viewModel.searchTerm=i.value.toLowerCase().trim())}_closeClicked(){this.viewModel.searchTerm=null,this.viewModel.filterMenuOpen=!1}_backClicked(){this.viewModel.filterMenuType="site",this.viewModel.searchTerm=null}_siteSelected(e){const t=e.currentTarget.getAttribute("data-id"),i=this.viewModel.getSite(t);let s=!1;this.site!==t&&(this.facility=void 0,this.level=void 0,s=!0,this.viewModel.levelsExpanded=!1),this.site=t,this.viewModel.searchTerm=null,this._setFilterMenuType("facility"),this.viewModel.goTo(i),s&&this.viewModel.setFloors(null)}_facilitySelected(e){const t=e.currentTarget.getAttribute("data-id"),i=this.viewModel.getFacility(t);let s=!1;if(this.facility!==t){if("base-floors"===this.viewModel.filterMode){var l;const e=null==(l=this.viewModel)?void 0:l.getBaseLevel(i);this.level=e?e.id:void 0}else this.level=void 0;s=!0,this.viewModel.levelsExpanded=!1}if(this.facility=t,this.viewModel.goTo(i),s){const e=this.viewModel.getLevel(this.level);this.viewModel.setFloors(e)}if(!this.viewModel.isNormalMode){const e=this.viewModel.getFacilityLevels(t);(null==e?void 0:e.length)>1&&(this.viewModel.levelsExpanded=!0)}}_levelSelected(e){const t=e.currentTarget.getAttribute("data-id");this.level=t}_closeLevels(){this.viewModel.levelsExpanded=!1}_isWebScene(e){return"esri.WebScene"===e.declaredClass}_getComponentPosition(){var e,t;return null==(e=this.view)||null==(t=e.ui)?void 0:t.getPosition(this.container)}_getPosition(e){switch(e){case"bottom-right":case"bottom-left":return"bottom";default:return"top"}}};e([i("viewModel.enabled")],d.prototype,"enabled",void 0),e([i("viewModel.longNames")],d.prototype,"longNames",void 0),e([i("viewModel.minimized")],d.prototype,"minimized",void 0),e([i("viewModel.pinnedLevels")],d.prototype,"pinnedLevels",void 0),e([i("viewModel.site")],d.prototype,"site",void 0),e([i("viewModel.facility")],d.prototype,"facility",void 0),e([i("viewModel.level")],d.prototype,"level",void 0),e([i("viewModel.view")],d.prototype,"view",void 0),e([t({type:a})],d.prototype,"viewModel",void 0),e([t(),o("esri/widgets/FloorFilter/t9n/FloorFilter")],d.prototype,"messages",void 0),e([t(),o("esri/t9n/common")],d.prototype,"messagesCommon",void 0),e([i("viewModel.goToOverride")],d.prototype,"goToOverride",void 0),e([i("viewModel.updateWebDocument")],d.prototype,"updateWebDocument",null),d=e([s("esri.widgets.FloorFilter")],d);var u=d;export default u;
