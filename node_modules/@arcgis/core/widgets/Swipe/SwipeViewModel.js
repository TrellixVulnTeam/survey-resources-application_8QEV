/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as i}from"../../chunks/tslib.es6.js";import"../../core/has.js";import{typeCast as t}from"../../core/compilerUtils.js";import"../../core/Logger.js";import"../../core/accessorSupport/ensureType.js";import{property as e}from"../../core/accessorSupport/decorators/property.js";import{subclass as r}from"../../core/accessorSupport/decorators/subclass.js";import"../../core/urlUtils.js";import"../../core/uuid.js";import"../../portal/support/resourceExtension.js";import s from"../../core/Accessor.js";import o from"../../core/Collection.js";import l from"../../core/Handles.js";import n from"../../layers/Layer.js";import{init as p,on as a}from"../../core/watchUtils.js";import c from"../../views/layers/support/ClipRect.js";const h=o.ofType(n);function y(i,t){const e=10**t;return Math.round(i*e)/e}const d={left:0,right:0,top:0,bottom:0};let g=class extends s{constructor(i){super(i),this._handles=new l,this._leadingClips=new Map,this._trailingClips=new Map,this.direction="horizontal",this.leadingLayers=new h,this.max=100,this.min=0,this.precision=4,this.step=.5,this.stepMultiplier=10,this.trailingLayers=new h,this.view=null}initialize(){this._handles.add([p(this,["view","view.ready","position","direction"],(()=>this._clipLayers())),a(this,"leadingLayers","change",(()=>this._clipLeadingLayers())),a(this,"trailingLayers","change",(()=>this._clipTrailingLayers()))])}destroy(){this._removeExistingClips(),this._handles.destroy(),this._handles=null}get position(){return 25}set position(i){const{precision:t,min:e,max:r}=this;this._set("position",y(Math.max(Math.min(i,r),e),t))}get state(){const{view:i}=this;return i&&i.ready?"ready":"disabled"}_clipLayers(){this._clipLeadingLayers(),this._clipTrailingLayers()}_clipLeadingLayers(){this._removeClips("leading");const{leadingLayers:i}=this;i.forEach((i=>this._clipLayer({layer:i,type:"leading"})))}_clipTrailingLayers(){this._removeClips("trailing");const{trailingLayers:i}=this;i.forEach((i=>this._clipLayer({layer:i,type:"trailing"})))}async _getLayerView(i){const{view:e}=this;if(!i||!e)return null;const r=await t(e)().whenLayerView(i);return"clips"in r?r:null}_getVerticalClipRect(i){const{position:t}=this;return"leading"===i?new c({...d,bottom:100-t+"%"}):"trailing"===i?new c({...d,top:`${t}%`}):null}_getHorizontalClipRect(i){const{position:t}=this;return"leading"===i?new c({...d,right:100-t+"%"}):"trailing"===i?new c({...d,left:`${t}%`}):null}_getClipRect(i){const{direction:t}=this;return"vertical"===t?this._getVerticalClipRect(i):"horizontal"===t?this._getHorizontalClipRect(i):null}async _clipLayer(i){const{_leadingClips:t,_trailingClips:e}=this,{layer:r,type:s}=i,o="trailing"===s?e:"leading"===s?t:null,l=await this._getLayerView(r);if(!(l&&"clips"in l&&o&&l.hasOwnProperty("clips")))return;const n=o.get(l);n&&l.clips.remove(n);const p=this._getClipRect(s);p&&(o.set(l,p),l.clips.add(p))}_removeClips(i){const{_leadingClips:t,_trailingClips:e}=this,r="trailing"===i?e:"leading"===i?t:null;r&&(r.forEach(((i,t)=>{t&&t.hasOwnProperty("clips")&&t.clips.remove(i)})),r.clear())}_removeExistingClips(){this._removeClips("leading"),this._removeClips("trailing")}};i([e()],g.prototype,"direction",void 0),i([e({type:h})],g.prototype,"leadingLayers",void 0),i([e({readOnly:!0})],g.prototype,"max",void 0),i([e({readOnly:!0})],g.prototype,"min",void 0),i([e()],g.prototype,"position",null),i([e()],g.prototype,"precision",void 0),i([e({readOnly:!0})],g.prototype,"state",null),i([e()],g.prototype,"step",void 0),i([e()],g.prototype,"stepMultiplier",void 0),i([e({type:h})],g.prototype,"trailingLayers",void 0),i([e()],g.prototype,"view",void 0),g=i([r("esri.widgets.Swipe.SwipeViewModel")],g);var m=g;export default m;
