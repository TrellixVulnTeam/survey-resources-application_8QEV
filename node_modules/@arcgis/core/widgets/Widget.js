/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../core/has.js";import t from"../core/Logger.js";import{property as r}from"../core/accessorSupport/decorators/property.js";import{cast as s}from"../core/accessorSupport/decorators/cast.js";import{deprecated as i}from"../core/deprecate.js";import{subclass as o}from"../core/accessorSupport/decorators/subclass.js";import"../core/urlUtils.js";import{generateUUID as n}from"../core/uuid.js";import"../portal/support/resourceExtension.js";import{runTracked as a}from"../core/accessorSupport/tracking.js";import{debounce as l,throwIfNotAbortError as d,eachAlways as c}from"../core/promiseUtils.js";import{SimpleTrackingTarget as h}from"../core/accessorSupport/tracking/SimpleTrackingTarget.js";import p from"../core/Evented.js";import{onLocaleChange as m}from"../intl/locale.js";import{fetchMessageBundle as g}from"../intl/messages.js";import"../intl.js";import{EsriPromiseMixin as u}from"../core/Promise.js";import _ from"../core/Handles.js";import{init as y,whenOnce as j}from"../core/watchUtils.js";import{byId as f}from"../core/domUtils.js";import{getThemeName as w,classes as v}from"./support/widgetUtils.js";import"../libs/maquette/projection.js";import{createProjector as k}from"../libs/maquette/projector.js";const b=t.getLogger("esri.widgets.Widget");let H=0;const N={widgetIcon:"esri-icon-checkbox-unchecked"},C=k();let R=!1,T=class extends(u(p.EventedAccessor)){constructor(e,t){super(e,t),this._attached=!1,this._internalHandles=new _,this._projector=C,this.domNode=null,this.iconClass=N.widgetIcon,this.label=this.declaredClass.split(".").pop(),this.visible=!0,this._loadLocale=l((async()=>{if(this._messageBundleProps&&this._messageBundleProps.length){const e=await c(this._messageBundleProps.map((async({bundlePath:e,propertyName:t})=>{this[t]=await g(e)})));for(const t of e)t.error&&b.error("widget-intl:locale-error",this.declaredClass,t.error)}await this.loadLocale()}));const r=["light","dark"],s=w()||"light";r.includes(s)||i(b,"The following themes are deprecated: light-blue, dark-blue, light-green, dark-green, light-purple, dark-purple, light-red, and dark-red.",{version:"4.19",warnOnce:!0,see:"https://developers.arcgis.com/javascript/latest/styling/"});const o="esri-widget-uid-"+n(),d=this.render.bind(this);let p=!1;this._trackingTarget=new h((()=>this.scheduleRender()));const m=()=>{if(!p||this.destroyed)return null;const e=d();return e.properties?e.properties.key||(e.properties.key=o):e.properties={key:o},e};this.render=()=>{if(R)return m();let e;this._trackingTarget.clear(),R=!0;try{e=a(this._trackingTarget,m)}finally{R=!1}return e},this.addResolvingPromise(this._resourcesFetch=this.beforeFirstRender().then((()=>{p=!0,this._postInitialize()})))}normalizeCtorArgs(e,t){const r={...e};return t&&(r.container=t),r}postInitialize(){}beforeFirstRender(){return this._loadLocale().catch(d)}async loadLocale(){}destroy(){this.destroyed||(this._trackingTarget.destroy(),this._trackingTarget=null,this.viewModel&&(this.viewModel.destroy(),this.viewModel=null),this._detach(this.container),this._set("container",null),this._internalHandles.destroy(),this._emitter.clear(),this.render=()=>null,this._projector=null)}set container(e){this._get("container")||this._set("container",e)}castContainer(e){return f(e)}get id(){return this._get("id")||this.get("container.id")||Date.now().toString(16)+"-widget-"+H++}set id(e){e&&this._set("id",e)}get renderable(){return this._resourcesFetch}render(){throw new Error("not implemented")}scheduleRender(){this.destroyed||this._projector.scheduleRender()}classes(...e){return v.apply(this,e)}own(e){arguments.length>1&&(e=Array.prototype.slice.call(arguments)),this._internalHandles.add(e)}renderNow(){this._projector.renderNow()}_postInitialize(){var e;this.destroyed||(this.scheduleRender(),null!=(e=this._delegatedEventNames)&&e.length&&this._internalHandles.add(y(this,"viewModel",((e,t)=>{t&&this._internalHandles.remove("delegated-events"),e&&this._internalHandles.add(this._delegatedEventNames.map((t=>e.on(t,(e=>{this.emit(t,e)})))),"delegated-events")}))),this.postInitialize(),this._internalHandles.add(m((async()=>{await this._loadLocale().catch(d),this.scheduleRender()}))),this._internalHandles.add(j(this,"container",(async e=>{this.destroyed||this._attach(e)}))))}_attach(e){e&&(this._projector.merge(e,this.render),this._attached=!0)}_detach(e){e&&this._attached&&(this._projector.detach(this.render),e.parentNode&&e.parentNode.removeChild(e),this._attached=!1)}};e([r({value:null})],T.prototype,"container",null),e([s("container")],T.prototype,"castContainer",null),e([r({aliasOf:"container"})],T.prototype,"domNode",void 0),e([r()],T.prototype,"iconClass",void 0),e([r()],T.prototype,"id",null),e([r()],T.prototype,"label",void 0),e([r()],T.prototype,"renderable",null),e([r()],T.prototype,"viewModel",void 0),e([r()],T.prototype,"visible",void 0),T=e([o("esri.widgets.Widget")],T);var L=T;export default L;
