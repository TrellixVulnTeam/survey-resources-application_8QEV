/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import"../../../core/has.js";import{isSome as t,applySome as o,destroyMaybe as s}from"../../../core/maybe.js";import"../../../core/Logger.js";import"../../../core/accessorSupport/ensureType.js";import{handlesGroup as r}from"../../../core/handleUtils.js";import{property as i}from"../../../core/accessorSupport/decorators/property.js";import{subclass as n}from"../../../core/accessorSupport/decorators/subclass.js";import"../../../core/urlUtils.js";import"../../../core/uuid.js";import"../../../portal/support/resourceExtension.js";import{on as p}from"../../../core/events.js";import{isMeasurementSystem as a}from"../../../core/unitUtils.js";import"../../support/widgetUtils.js";import{messageBundle as c}from"../../support/decorators/messageBundle.js";import{j as l}from"../../../chunks/index.js";import u from"../../Widget.js";import h from"../../support/Popover.js";import{SETTINGS_CSS as _}from"../css.js";let m=class extends u{constructor(e,t){super(e,t),this._messagesUnits=null,this._popover=null,this._buttonElement=null,this._clickOutsideHandle=null,this._requestFocusOnCreate=!1}destroy(){this._destroyPopover()}render(){const e=t(this._popover)&&this._popover.open?this._messages.hideSettings:this._messages.showSettings;return l("button",{class:_.base,title:e,bind:this,afterCreate:this._initializePopover,onclick:this._togglePopover,"aria-label":e})}_initializePopover(e){this._destroyPopover(),this._buttonElement=e,this._popover=new h({owner:this,placement:"bottom-end",offset:[0,0],anchorElement:e,renderContentFunction:()=>this._renderPopoverContent()})}_destroyPopover(){o(this._clickOutsideHandle,(e=>e.remove())),s(this._popover)}_renderPopoverContent(){const e=this._messagesUnits,{unit:t,unitOptions:o}=this;return l("div",{class:_.popoverContent,bind:this,onkeydown:this._onPopoverKeyDown,afterCreate:this._onPopoverContentAfterCreate},l("label",{class:_.selectLabel},this._messages.unitSelectLabel),l("select",{class:_.select,value:t,bind:this,onchange:this._onUnitChange,afterCreate:this._onUnitSelectAfterCreate},o.map((t=>l("option",{key:t,value:t},a(t)?e.systems[t]:e.units[t].pluralCapitalized)))))}_onUnitChange(e){const t=e.target;this.onUnitChange(t.value),this._closePopover()}_onUnitSelectAfterCreate(e){this._requestFocusOnCreate&&(this._requestFocusOnCreate=!1,e.focus())}_onPopoverKeyDown(e){switch(e.key){case"Enter":case"Escape":e.stopPropagation(),e.preventDefault(),this._closePopover()}}_togglePopover(e){t(this._popover)&&this._popover.open?this._closePopover():this._openPopover()}_openPopover(){o(this._popover,(e=>e.open=!0)),this._requestFocusOnCreate=!0}_closePopover({focusOnButton:e=!0}={}){o(this._popover,(e=>e.open=!1)),o(this._clickOutsideHandle,(e=>e.remove())),e&&o(this._buttonElement,(e=>e.focus()))}_onPopoverContentAfterCreate(e){o(this._clickOutsideHandle,(e=>e.remove())),this._clickOutsideHandle=r([p(e,"click",(e=>e.stopPropagation())),p(window,"click",(()=>this._closePopover({focusOnButton:!1})))])}};e([i()],m.prototype,"unit",void 0),e([i()],m.prototype,"unitOptions",void 0),e([i()],m.prototype,"onUnitChange",void 0),e([i(),c("esri/widgets/ElevationProfile/t9n/ElevationProfile")],m.prototype,"_messages",void 0),e([i(),c("esri/core/t9n/Units")],m.prototype,"_messagesUnits",void 0),m=e([n("esri.widgets.ElevationProfile.SettingsButton")],m);export{m as SettingsButton};
