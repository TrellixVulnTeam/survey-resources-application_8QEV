/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../../../chunks/tslib.es6.js";import"../../../core/has.js";import{isNone as t,unwrapOr as s,isSome as o}from"../../../core/maybe.js";import"../../../core/Logger.js";import"../../../core/accessorSupport/ensureType.js";import{property as r}from"../../../core/accessorSupport/decorators/property.js";import{subclass as i}from"../../../core/accessorSupport/decorators/subclass.js";import"../../../core/urlUtils.js";import"../../../core/uuid.js";import"../../../portal/support/resourceExtension.js";import{reactionInit as l}from"../../../core/accessorSupport/trackingUtils.js";import n from"../../../core/Accessor.js";import a from"../../../geometry/Polyline.js";import c from"../../../Color.js";import p from"../../../core/Handles.js";import{f as h}from"../../../chunks/vec4f64.js";import{throttle as m}from"../../../core/throttle.js";import{PROFILE_LINES_STYLE_3D as u}from"./constants.js";import{OutlineVisualElement as f}from"../../../views/3d/interactive/visualElements/OutlineVisualElement.js";const d=100;let _=class extends n{constructor(e){super(e),this._chartData=null,this._visualElements=[],this._handles=new p}initialize(){const e=m((e=>{this._update(e)}),d);this._handles.add([l((()=>({spatialReference:this.view.spatialReference,chartData:this._chartData})),e),e])}destroy(){this._handles.destroy(),this._destroyVisualElements()}remove(){this._destroyVisualElements()}update(e){this._chartData=e}_update(e){const{chartData:s}=e;if(t(s))return this.remove();if(!s.fullyRefined)return;const o=s.lines.filter((e=>this._shouldDisplayLine(e))),r=o.length;for(;this._visualElements.length>r;)this._visualElements.pop().destroy();const i=u;for(;this._visualElements.length<r;){const e=new f({view:this.view,elevationInfo:{mode:"absolute-height",offset:0},innerWidth:i.width-i.outlineSize,width:i.width,falloff:i.falloff,color:i.outlineColor,renderOccluded:i.renderOccluded});this._visualElements.push(e)}const l=e.spatialReference;for(let t=0;t<r;++t){const e=this._visualElements[t],s=o[r-1-t];e.geometry=this._createLineGeometry(s,l),e.innerColor=h(c.toUnitRGBA(s.color))}}_shouldDisplayLine(e){return"input"!==e.type}_createLineGeometry(e,r){const i=s(e.samples,[]),l=i.length-1,n=[];let c=[];for(let s=0;s<=l;s++){const{x:e,y:r,z:a}=i[s];o(a)&&c.push([e,r,a]),(s===l||t(a))&&c.length&&(n.push(c),c=[])}return new a({paths:n,hasZ:!0,spatialReference:r})}_destroyVisualElements(){this._visualElements.forEach((e=>e.destroy())),this._visualElements.length=0}};e([r()],_.prototype,"view",void 0),e([r()],_.prototype,"_chartData",void 0),_=e([i("esri.widgets.ElevationProfile.support.ProfileLines3D")],_);export{_ as ProfileLines3D};
