/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{abortMaybe as e,removeMaybe as i,isNone as t,isSome as s}from"../../../core/maybe.js";import{destroyHandle as l,handlesGroup as h}from"../../../core/handleUtils.js";import{createTask as r,throwIfAborted as a}from"../../../core/promiseUtils.js";import{getGraphicEffectiveElevationInfo as o}from"../../../support/elevationInfoUtils.js";import{highlightsSupported as n}from"../../../views/support/layerViewUtils.js";import{settings as m}from"../../../views/3d/interactive/editingTools/settings.js";import{OutlineVisualElement as g}from"../../../views/3d/interactive/visualElements/OutlineVisualElement.js";import{GraphicState as p}from"../../../views/3d/layers/graphics/GraphicState.js";class c{constructor(e){this._params=e,this._highlightTask=null,this._highlightHandle=null,this._visualElementHandle=null}destroy(){this.remove()}remove(){this._highlightTask=e(this._highlightTask),this._highlightHandle=i(this._highlightHandle),this._visualElementHandle=i(this._visualElementHandle)}showHighlight(e){if(this.remove(),t(e)||!d(e))return;const i=e.layer;this._highlightTask=r((async t=>{const s=await this._params.view.whenLayerView(i);a(t),n(s)&&(this._highlightHandle=s.highlight(e))}))}showReshaping(e){if(this.remove(),t(e))return;const i=this._params.view,s=new g({view:i,geometry:d(e)?e.geometry:null,attached:!1,elevationInfo:o(e),renderOccluded:8}),r=new p({graphic:e}),a=[r.watch("isDraped",(e=>{s.isDraped=e})),r.on("changed",(()=>{s.geometry=d(e)?e.geometry:null})),i.trackGraphicState(r),i.maskOccludee(e),l(s)];m.visualElements.lineGraphics.outline.apply(s),s.attached=!0,this._visualElementHandle=h(a)}}function d(e){return s(e.geometry)&&"polyline"===e.geometry.type}export{c as InputRepresentation3D};
