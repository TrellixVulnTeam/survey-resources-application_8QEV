/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import e from"../core/global.js";import{isSome as t}from"../core/maybe.js";import n from"../core/Error.js";import{normalizeMessageBundleLocale as r}from"./messages.js";import o from"../request.js";async function s(e,t,o,s){const a=t.exec(o);if(!a)throw new n("esri-intl:invalid-bundle",`Bundle id "${o}" is not compatible with the pattern "${t}"`);const c=a[1]?`${a[1]}/`:"",l=a[2],h=r(s),u=`${c}${l}.json`,w=h?`${c}${l}_${h}.json`:u;let f;try{f=await i(e(w))}catch(d){if(w===u)throw new n("intl:unknown-bundle",`Bundle "${o}" cannot be loaded`,{error:d});try{f=await i(e(u))}catch(d){throw new n("intl:unknown-bundle",`Bundle "${o}" cannot be loaded`,{error:d})}}return f}async function i(e){if(t(l.fetchBundleAsset))return l.fetchBundleAsset(e);const n=await o(e,{responseType:"text"});return JSON.parse(n.data)}class a{constructor({base:t="",pattern:n,location:r=new URL(window.location.href)}){let o;o="string"==typeof r?t=>new URL(t,new URL(r,e.location)).href:r instanceof URL?e=>new URL(e,r).href:r,this.pattern="string"==typeof n?new RegExp(`^${n}`):n,this.getAssetUrl=o,t=t?t.endsWith("/")?t:t+"/":"",this.matcher=new RegExp(`^${t}(?:(.*)/)?(.*)$`)}fetchMessageBundle(e,t){return s(this.getAssetUrl,this.matcher,e,t)}}function c(e){return new a(e)}const l={};export{a as JSONLoader,c as createJSONLoader,l as test};
