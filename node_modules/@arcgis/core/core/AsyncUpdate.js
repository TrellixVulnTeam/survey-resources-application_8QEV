/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import s from"./Logger.js";import{subclass as e}from"./accessorSupport/decorators/subclass.js";import{runTracked as a}from"./accessorSupport/tracking.js";import{SimpleTrackingTarget as r}from"./accessorSupport/tracking/SimpleTrackingTarget.js";import n from"./Accessor.js";const c=a=>{let r=class extends a{constructor(){super(...arguments),this.asyncUpdateState=new Map}autoUpdateAsync(t,s){return o((s=>this.updateAsync(t,s)),s)}async updateAsync(t,e){if(!this.startAsyncUpdate(t)){try{const s=await e();this._set(t,s)}catch(a){s.getLogger(this.declaredClass).warn(`Async update of "${t}" failed. Async update functions should not throw exceptions.`)}this.endAsyncUpdate(t)&&this.updateAsync(t,e)}}startAsyncUpdate(t){var s;const e=null!=(s=this.asyncUpdateState.get(t))?s:0;return 1&e?(this.asyncUpdateState.set(t,2|e),!0):(this.asyncUpdateState.set(t,1|e),!1)}endAsyncUpdate(t){var s;const e=-2&(null!=(s=this.asyncUpdateState.get(t))?s:0);return 2&e?(this.asyncUpdateState.set(t,-3&e),!0):(this.asyncUpdateState.set(t,e),!1)}};return r=t([e("esri.core.AsyncUpdate")],r),r};function o(t,s){const e=()=>{o&&!p&&t(n)},n=()=>{if(!o||p)return s();o.clear(),p=!0;const t=a(o,s);return p=!1,t},c=()=>{o&&(o.destroy(),o=null)};let o=new r(e),p=!1;return t(n),{remove:c}}let p=class extends(c(n)){};p=t([e("esri.core.AsyncUpdate")],p);export{p as AsyncUpdate,c as AsyncUpdateMixin};
