/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{isSome as t,isNone as e}from"../../core/maybe.js";import o from"../../Color.js";import{getVisualVariableValues as r}from"../visualVariables/support/visualVariableUtils.js";function i(e,o){if(!e||e.symbol)return null;const r=o&&o.renderer;return e&&t(r)&&r.getObservationRenderer?r.getObservationRenderer(e):r}function n(e,o){if(t(e.symbol))return e.symbol;const r=i(e,o);return t(r)&&"dot-density"!==r.type?r.getSymbol(e,o):null}function a(t,o){const a=i(t,o),l=n(t,o);if(e(l))return null;const s={renderer:a,symbol:l};if(e(a)||!("visualVariables"in a)||!a.visualVariables)return s;const u=r(a,t,o),c=["proportional","proportional","proportional"];for(const{variable:e,value:r}of u)switch(e.type){case"color":s.color=r.toRgba();break;case"size":if("outline"===e.target)s.outlineSize=r;else{const t=e.axis,o=e.useSymbolValue?"symbol-value":r;switch(t){case"width":c[0]=o;break;case"depth":c[1]=o;break;case"height":c[2]=o;break;case"width-and-depth":c[0]=c[1]=o;break;default:c[0]=c[1]=c[2]=o}}break;case"opacity":s.opacity=r;break;case"rotation":switch(e.axis){case"tilt":s.tilt=r;break;case"roll":s.roll=r;break;default:s.heading=r}}return"proportional"===c[0]&&"proportional"===c[1]&&"proportional"===c[2]||(s.size=c),s}async function l(e,o){if(t(e.symbol))return e.symbol;const r=i(e,o);return t(r)&&r.getSymbolAsync(e,{...o,abortOptions:{signal:o.signal}})}async function s(t,e){const n=i(t,e),a=await l(t,e);if(!a)return null;const s={renderer:n,symbol:a};if(!n||!("visualVariables"in n)||!n.visualVariables)return s;const u=r(n,t,e),c=["proportional","proportional","proportional"];for(const{variable:r,value:i}of u)if("color"===r.type)s.color=o.toUnitRGBA(i);else if("size"===r.type)if("outline"===r.target)s.outlineSize=i;else{const t=r.axis,e=r.useSymbolValue?"symbol-value":i;"width"===t?c[0]=e:"depth"===t?c[1]=e:"height"===t?c[2]=e:c[0]=c[1]="width-and-depth"===t?e:c[2]=e}else"opacity"===r.type?s.opacity=i:"rotation"===r.type&&"tilt"===r.axis?s.tilt=i:"rotation"===r.type&&"roll"===r.axis?s.roll=i:"rotation"===r.type&&(s.heading=i);return(isFinite(c[0])||isFinite(c[1])||isFinite(c[2]))&&(s.size=c),s}function u(t,e=0){const o=t[e];return"number"==typeof o&&isFinite(o)?o:null}function c(t){for(let e=0;e<3;e++){const o=t[e];if("number"==typeof o)return isFinite(o)?o:0}return 0}export{u as getDriverAxisSizeValue,c as getDriverAxisSizeValueAny,i as getRenderer,a as getRenderingInfo,s as getRenderingInfoAsync,l as getSymbolAsync};
