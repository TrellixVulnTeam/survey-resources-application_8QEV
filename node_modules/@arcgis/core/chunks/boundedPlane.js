/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import"../core/has.js";import s from"../core/Logger.js";import{acosClamped as i}from"../core/mathUtils.js";import{c as n,b as t,f as a}from"./vec3f64.js";import{g as o,a as r,b as e,s as c,k as u,l as g,d as b,f,m as l,i as p,n as m,o as d}from"./vec3.js";import{directionFromTo as h}from"../views/3d/support/mathUtils.js";import{a as j,b as I,r as v,i as w}from"./mat4.js";import{ObjectStack as P}from"../core/ObjectStack.js";import{a as N}from"./mat4f64.js";import{sv3d as M}from"../views/3d/support/stack.js";import{p as T}from"./vector.js";import{p as y,d as A,c as S}from"./lineSegment.js";import{d as _}from"./ray.js";import{c as x,w as V,a as k,f as E,n as O,b as U,i as q,d as B,e as F,g as Y,p as C,s as L}from"./plane.js";const R=s.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class z{constructor(){this.plane=x(),this.origin=n(),this.basis1=n(),this.basis2=n()}}function G(s=Ps){return{plane:x(s.plane),origin:t(s.origin),basis1:t(s.basis1),basis2:t(s.basis2)}}function W(s,i,n){const t=ys.get();return t.origin=s,t.basis1=i,t.basis2=n,t.plane=V(0,0,0,0),K(t),t}function D(s,i=G()){return J(s.origin,s.basis1,s.basis2,i)}function H(s,i){o(i.origin,s.origin),o(i.basis1,s.basis1),o(i.basis2,s.basis2),k(s.plane,i.plane)}function J(s,i,n,t=G()){return o(t.origin,s),o(t.basis1,i),o(t.basis2,n),K(t),vs(t,"fromValues()"),t}function K(s){E(s.basis2,s.basis1,s.origin,s.plane)}function Q(s,i,n){s!==n&&D(s,n);const t=r(M.get(),ms(s),i);return e(n.origin,n.origin,t),n.plane[3]-=i,n}function X(s,i,n){return Z(i,n),Q(n,gs(s,s.origin),n),n}function Z(s,i=G()){const n=(s[2]-s[0])/2,t=(s[3]-s[1])/2;return c(i.origin,s[0]+n,s[1]+t,0),c(i.basis1,n,0,0),c(i.basis2,0,t,0),U(0,0,1,0,i.plane),i}function $(s,i,n){return!!q(s.plane,i,n)&&hs(s,n)}function ss(s,i,n){if($(s,i,n))return n;const t=is(s,i,M.get());return e(n,i.origin,r(M.get(),i.direction,u(i.origin,t)/g(i.direction))),n}function is(s,n,t){const a=Ns.get();ws(s,n,a,Ns.get());let r=Number.POSITIVE_INFINITY;for(const e of As){const c=Is(s,e,Ms.get()),u=M.get();if(B(a,c,u)){const s=h(M.get(),n.origin,u),a=Math.abs(i(b(n.direction,s)));a<r&&(r=a,o(t,u))}}return r===Number.POSITIVE_INFINITY?ns(s,n,t):t}function ns(s,i,n){if($(s,i,n))return n;const t=Ns.get(),a=Ns.get();ws(s,i,t,a);let r=Number.POSITIVE_INFINITY;for(const e of As){const c=Is(s,e,Ms.get()),u=M.get();if(F(t,c,u)){const s=_(i,u);if(!Y(a,u))continue;s<r&&(r=s,o(n,u))}}return os(s,i.origin)<r&&ts(s,i.origin,n),n}function ts(s,i,n){const t=C(s.plane,i,M.get()),a=y(js(s,s.basis1),t,-1,1,M.get()),o=y(js(s,s.basis2),t,-1,1,M.get());return f(n,e(M.get(),a,o),s.origin),n}function as(s,i,n){const{origin:t,basis1:a,basis2:o}=s,r=f(M.get(),i,t),e=T(a,r),u=T(o,r),g=T(ms(s),r);return c(n,e,u,g)}function os(s,i){const n=as(s,i,M.get()),{basis1:t,basis2:a}=s,o=g(t),r=g(a),e=Math.max(Math.abs(n[0])-o,0),c=Math.max(Math.abs(n[1])-r,0),u=n[2];return e*e+c*c+u*u}function rs(s,i){return Math.sqrt(os(s,i))}function es(s,i){let n=Number.NEGATIVE_INFINITY;for(const t of As){const a=Is(s,t,Ms.get()),o=A(a,i);o>n&&(n=o)}return Math.sqrt(n)}function cs(s,i){return Y(s.plane,i)&&hs(s,i)}function us(s,i,n,t){return ds(s,n,t)}function gs(s,i){const n=-s.plane[3];return T(ms(s),i)-n}function bs(s,i,n,t){const a=gs(s,i),o=r(Ts,ms(s),n-a);return e(t,i,o),t}function fs(s,i){return l(s.basis1,i.basis1)&&l(s.basis2,i.basis2)&&l(s.origin,i.origin)}function ls(s,i,n){return s!==n&&D(s,n),j(Ss,i),I(Ss,Ss),p(n.basis1,s.basis1,Ss),p(n.basis2,s.basis2,Ss),p(O(n.plane),O(s.plane),Ss),p(n.origin,s.origin,i),L(n.plane,n.origin,n.plane),n}function ps(s,i,n,t){return s!==t&&D(s,t),v(_s,w(_s),i,n),p(t.basis1,s.basis1,_s),p(t.basis2,s.basis2,_s),K(t),t}function ms(s){return O(s.plane)}function ds(s,i,n){switch(i){case 0:o(n,s.basis1),m(n,n);break;case 1:o(n,s.basis2),m(n,n);break;case 2:o(n,ms(s))}return n}function hs(s,i){const n=f(M.get(),i,s.origin),t=d(s.basis1),a=d(s.basis2),o=b(s.basis1,n),r=b(s.basis2,n);return-o-t<0&&o-t<0&&-r-a<0&&r-a<0}function js(s,i){const n=Ms.get();return o(n.origin,s.origin),o(n.vector,i),n}function Is(s,i,n){const{basis1:t,basis2:a,origin:o}=s,c=r(M.get(),t,i.origin[0]),u=r(M.get(),a,i.origin[1]);e(n.origin,c,u),e(n.origin,n.origin,o);const g=r(M.get(),t,i.direction[0]),b=r(M.get(),a,i.direction[1]);return r(n.vector,e(g,g,b),2),n}function vs(s,i){Math.abs(b(s.basis1,s.basis2)/(g(s.basis1)*g(s.basis2)))>1e-6&&R.warn(i,"Provided basis vectors are not perpendicular"),Math.abs(b(s.basis1,ms(s)))>1e-6&&R.warn(i,"Basis vectors and plane normal are not perpendicular"),Math.abs(-b(ms(s),s.origin)-s.plane[3])>1e-6&&R.warn(i,"Plane offset is not consistent with plane origin")}function ws(s,i,n,t){const a=ms(s);E(a,i.direction,i.origin,n),E(O(n),a,i.origin,t)}const Ps={plane:x(),origin:a(0,0,0),basis1:a(1,0,0),basis2:a(0,1,0)},Ns=new P(x),Ms=new P(S),Ts=n(),ys=new P((()=>({origin:null,basis1:null,basis2:null,plane:null}))),As=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Ss=N(),_s=N();var xs=Object.freeze({__proto__:null,BoundedPlaneClass:z,create:G,wrap:W,copy:D,copyWithoutVerify:H,fromValues:J,updateUnboundedPlane:K,elevate:Q,setExtent:X,fromAABoundingRect:Z,intersectRay:$,intersectRayClosestSilhouette:ss,closestPointOnSilhouette:is,closestPoint:ns,projectPoint:ts,projectPointLocal:as,distance2:os,distance:rs,distanceToSilhouette:es,extrusionContainsPoint:cs,axisAt:us,altitudeAt:gs,setAltitudeAt:bs,equals:fs,transform:ls,rotate:ps,normal:ms,UP:Ps});export{ms as A,z as B,Ps as U,D as a,xs as b,G as c,H as d,cs as e,J as f,Q as g,Z as h,$ as i,ss as j,is as k,ns as l,as as m,os as n,rs as o,ts as p,es as q,us as r,X as s,gs as t,K as u,bs as v,W as w,fs as x,ls as y,ps as z};
