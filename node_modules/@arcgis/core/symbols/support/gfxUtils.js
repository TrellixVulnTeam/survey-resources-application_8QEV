/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import t from"../../Color.js";import{pt2px as e}from"../../core/screenUtils.js";import r from"../../request.js";import{getAssetUrl as o}from"../../assets.js";import n from"../../core/ItemCache.js";import{getCIMSymbolColor as i}from"./cimSymbolUtils.js";const s="picture-fill",l="simple-fill",c="simple-line",a="simple-marker",m="text",u="cim",p={left:"start",center:"middle",right:"end",justify:"start"},f={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},d=new n(1e3);function h(t){let e=t.horizontalAlignment;return e=e&&p[e.toLowerCase()]||"middle",e}function g(t){const e=t.verticalAlignment;return e&&f[e.toLowerCase()]||"alphabetic"}function y(t){return"bottom"===t.verticalAlignment?"super":null}function b(t){const r=t.style;let n=null;if(t)switch(t.type){case a:"cross"!==r&&"x"!==r&&(n=t.color);break;case l:"solid"===r?n=t.color:"none"!==r&&(n={type:"pattern",x:0,y:0,src:o(`esri/symbols/patterns/${r}.png`),width:5,height:5});break;case s:n={type:"pattern",src:t.url,width:e(t.width)*t.xscale,height:e(t.height)*t.yscale,x:e(t.xoffset),y:e(t.yoffset)};break;case m:n=t.color;break;case u:n=i(t)}return n}function w(t,e){const o=t+"-"+e;return void 0!==d.get(o)?Promise.resolve(d.get(o)):r(t,{responseType:"image"}).then((t=>{const r=t.data,n=r.naturalWidth,i=r.naturalHeight,s=document.createElement("canvas");s.width=n,s.height=i;const l=s.getContext("2d");l.fillStyle=e,l.fillRect(0,0,n,i),l.globalCompositeOperation="destination-in",l.drawImage(r,0,0);const c=s.toDataURL();return d.put(o,c),c}))}function j(t){if(!t)return null;let r;switch(t.type){case l:case s:case a:r=j(t.outline);break;case c:{const o=e(t.width);"none"!==t.style&&0!==o&&(r={color:t.color,style:x(t.style),width:o,cap:t.cap,join:"miter"===t.join?e(t.miterLimit):t.join});break}default:r=null}return r}const x=function(){const t={};return function(e){if(t[e])return t[e];const r=e.replace(/-/g,"");return t[e]=r,r}}(),k=new t([128,128,128]);export{k as defaultThematicColor,b as getFill,w as getPatternUrlWithColor,h as getSVGAlign,g as getSVGBaseline,y as getSVGBaselineShift,j as getStroke};
