/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.19/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import"../core/has.js";import"../core/Logger.js";import"../core/accessorSupport/ensureType.js";import{property as t}from"../core/accessorSupport/decorators/property.js";import{subclass as r}from"../core/accessorSupport/decorators/subclass.js";import"../core/urlUtils.js";import"../core/uuid.js";import"../portal/support/resourceExtension.js";import o from"../geometry/Extent.js";import{typeKebabDictionary as s}from"../geometry/support/typeUtils.js";import"../geometry.js";import{fixRendererFields as p,fixTimeInfoFields as i}from"./support/fieldUtils.js";import l from"../PopupTemplate.js";import n from"./Layer.js";import{ReadOnlyMultiOriginJSONMixin as u}from"../core/ReadOnlyMultiOriginJSONSupport.js";import a from"../symbols/support/ElevationInfo.js";import"../renderers/Renderer.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/UniqueValueRenderer.js";import"../renderers/DictionaryRenderer.js";import"../renderers/DotDensityRenderer.js";import"../renderers/HeatmapRenderer.js";import"../renderers/SimpleRenderer.js";import{rendererTypes as d}from"../renderers/support/types.js";import{read as y}from"../renderers/support/jsonUtils.js";import m from"./support/Field.js";import c from"./support/FieldsIndex.js";import{BlendLayer as h}from"./mixins/BlendLayer.js";import{RefreshableLayer as f}from"./mixins/RefreshableLayer.js";import{ScaleRangeLayer as v}from"./mixins/ScaleRangeLayer.js";import{TemporalLayer as g}from"./mixins/TemporalLayer.js";import j from"./support/FeatureReduction.js";import S from"./support/LabelClass.js";import R from"./support/FeatureReductionCluster.js";import F from"./support/FeatureReductionSelection.js";import b from"./support/FeatureType.js";import{createPopupTemplate as O}from"../support/popupUtils.js";import x from"../tasks/support/Query.js";import I from"./graphics/sources/OGCFeatureSource.js";let E=class extends(h(g(v(f(u(n)))))){constructor(e){super(e),this.collectionId=null,this.copyright=null,this.definitionExpression=null,this.displayField=null,this.elevationInfo=null,this.featureReduction=null,this.fullExtent=null,this.geometryType=null,this.hasZ=void 0,this.labelingInfo=null,this.labelsVisible=!0,this.legendEnabled=!0,this.objectIdField=null,this.popupEnabled=!0,this.popupTemplate=null,this.screenSizePerspectiveEnabled=!0,this.source=null,this.type="ogc-feature",this.typeIdField=null,this.types=null,this.url=null}load(e){const t=new I({layer:this});return this._set("source",t),this.addResolvingPromise(t.load(e).then((()=>{const{geometryType:e,hasZ:t,objectIdField:r}=this.source.layerDefinition;this.set({geometryType:s.fromJSON(e),hasZ:t,objectIdField:r}),p(this.renderer,this.fields),i(this.timeInfo,this.fields)}))),this.when()}get capabilities(){return{attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!!this.hasZ},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAttachments:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},query:{maxRecordCount:5e3,maxRecordCountFactor:void 0,standardMaxRecordCount:void 0,supportsCacheHint:!1,supportsCentroid:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsStandardizedQueriesOnly:!1,supportsStatistics:!1,supportsSqlExpression:!1,tileMaxRecordCount:void 0},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUploadWithItemId:!1,supportsUpdateWithoutM:!1}}}get defaultPopupTemplate(){return this.createPopupTemplate()}get description(){var e,t,r;return null!=(e=null==(t=this.source)||null==(r=t.collection)?void 0:r.description)?e:null}get fields(){var e,t,r;const o=null==(e=this.source)||null==(t=e.layerDefinition)?void 0:t.fields;return null!=(r=null==o?void 0:o.map((e=>m.fromJSON(e))))?r:null}set fields(e){e?this._override("fields",e):this._clearOverride("fields")}get fieldsIndex(){return new c(this.fields)}get renderer(){var e,t,r;const o=null==(e=this.source)||null==(t=e.layerDefinition)||null==(r=t.drawingInfo)?void 0:r.renderer;return o?y(o,null,{origin:"service"}):null}set renderer(e){e?(p(e,this.fields),this._override("renderer",e)):this._clearOverride("renderer")}get spatialReference(){return this.source.spatialReference}get title(){var e,t;return null==(e=this.source)||null==(t=e.collection)?void 0:t.title}set title(e){e?this._override("title",e):this._clearOverride("title")}on(e,t){return super.on(e,t)}createPopupTemplate(e){return O(this,e)}createQuery(){return new x}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){var r;let o,s=!1;const p=null==t||null==(r=t.feature)?void 0:r.attributes,i=this.typeIdField&&(null==p?void 0:p[this.typeIdField]);return null!=i&&this.types&&(s=this.types.some((t=>{var r,s;return t.id==i&&(o=null==(r=t.domains)?void 0:r[e],"inherited"===(null==(s=o)?void 0:s.type)&&(o=this._getLayerDomain(e)),!0)}))),s||o||(o=this._getLayerDomain(e)),o}queryFeatures(e,t){return this.load().then((()=>this.source.queryFeatures(x.from(e)||this.createQuery(),t))).then((e=>{var t;return null==e||null==(t=e.features)||t.forEach((e=>{e.layer=e.sourceLayer=this})),e}))}_getLayerDomain(e){if(!this.fields)return null;for(const t of this.fields)if(t.name===e&&t.domain)return t.domain;return null}};e([t({readOnly:!0,dependsOn:["hasZ"]})],E.prototype,"capabilities",null),e([t({type:String})],E.prototype,"collectionId",void 0),e([t({type:String})],E.prototype,"copyright",void 0),e([t({readOnly:!0})],E.prototype,"defaultPopupTemplate",null),e([t({type:String})],E.prototype,"definitionExpression",void 0),e([t({readOnly:!0,type:String})],E.prototype,"description",null),e([t({type:String})],E.prototype,"displayField",void 0),e([t({type:a})],E.prototype,"elevationInfo",void 0),e([t({types:{key:"type",base:j,typeMap:{selection:F,cluster:R}}})],E.prototype,"featureReduction",void 0),e([t({type:[m]})],E.prototype,"fields",null),e([t({readOnly:!0})],E.prototype,"fieldsIndex",null),e([t({type:o,aliasOf:"source.fullExtent"})],E.prototype,"fullExtent",void 0),e([t({type:["point","polygon","polyline","multipoint"]})],E.prototype,"geometryType",void 0),e([t({type:Boolean})],E.prototype,"hasZ",void 0),e([t({type:String})],E.prototype,"id",void 0),e([t({type:[S]})],E.prototype,"labelingInfo",void 0),e([t({type:Boolean})],E.prototype,"labelsVisible",void 0),e([t({type:Boolean})],E.prototype,"legendEnabled",void 0),e([t({type:["show","hide"]})],E.prototype,"listMode",void 0),e([t({type:String})],E.prototype,"objectIdField",void 0),e([t({type:Boolean})],E.prototype,"popupEnabled",void 0),e([t({type:l})],E.prototype,"popupTemplate",void 0),e([t({types:d})],E.prototype,"renderer",null),e([t({type:Boolean})],E.prototype,"screenSizePerspectiveEnabled",void 0),e([t({readOnly:!0})],E.prototype,"source",void 0),e([t({readOnly:!0})],E.prototype,"spatialReference",null),e([t()],E.prototype,"title",null),e([t({readOnly:!0})],E.prototype,"type",void 0),e([t({type:String,readOnly:!0})],E.prototype,"typeIdField",void 0),e([t({type:[b]})],E.prototype,"types",void 0),e([t({type:String})],E.prototype,"url",void 0),E=e([r("esri.layers.OGCFeatureLayer")],E);var T=E;export default T;
